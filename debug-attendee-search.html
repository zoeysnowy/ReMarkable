<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å‚ä¼šäººæœç´¢è°ƒè¯•å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .debug-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    
    button:hover {
      background: #45a049;
    }
    
    button.secondary {
      background: #2196F3;
    }
    
    button.danger {
      background: #f44336;
    }
    
    pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      border-left: 4px solid #4CAF50;
    }
    
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    
    .error {
      color: #f44336;
      font-weight: bold;
    }
    
    .info {
      color: #2196F3;
    }
    
    input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 300px;
      font-size: 14px;
    }
    
    .test-result {
      margin: 10px 0;
      padding: 10px;
      background: #f9f9f9;
      border-left: 4px solid #2196F3;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ å‚ä¼šäººæœç´¢åŠŸèƒ½è°ƒè¯•å·¥å…·</h1>
  
  <div class="debug-section">
    <h2>1ï¸âƒ£ æ£€æŸ¥ localStorage æ•°æ®</h2>
    <button onclick="checkLocalStorage()">æ£€æŸ¥è”ç³»äººåº“</button>
    <button onclick="checkEvents()">æ£€æŸ¥äº‹ä»¶åº“</button>
    <button class="danger" onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
    <pre id="storage-result">ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹ localStorage æ•°æ®...</pre>
  </div>
  
  <div class="debug-section">
    <h2>2ï¸âƒ£ æµ‹è¯•æœç´¢åŠŸèƒ½</h2>
    <div>
      <input 
        type="text" 
        id="search-input" 
        placeholder="è¾“å…¥æœç´¢å…³é”®è¯ï¼ˆä¾‹å¦‚ï¼šZoeyï¼‰"
        onkeyup="if(event.key==='Enter') testSearch()"
      >
      <button onclick="testSearch()">æœç´¢</button>
    </div>
    <pre id="search-result">è¾“å…¥å…³é”®è¯å¹¶ç‚¹å‡»æœç´¢...</pre>
  </div>
  
  <div class="debug-section">
    <h2>3ï¸âƒ£ æ‰‹åŠ¨æ·»åŠ æµ‹è¯•æ•°æ®</h2>
    <button onclick="addDemoContacts()">æ·»åŠ æ¼”ç¤ºè”ç³»äºº</button>
    <button onclick="addRandomContact()">æ·»åŠ éšæœºè”ç³»äºº</button>
    <pre id="add-result">ç‚¹å‡»æŒ‰é’®æ·»åŠ æµ‹è¯•æ•°æ®...</pre>
  </div>
  
  <div class="debug-section">
    <h2>4ï¸âƒ£ æ¨¡æ‹Ÿ AttendeeDisplay æœç´¢</h2>
    <p class="info">è¿™ä¸ªæµ‹è¯•ä¼šæ¨¡æ‹Ÿ AttendeeDisplay ç»„ä»¶å†…éƒ¨çš„æœç´¢é€»è¾‘</p>
    <div>
      <input 
        type="text" 
        id="component-search-input" 
        placeholder="è¾“å…¥æœç´¢å…³é”®è¯"
        onkeyup="if(event.key==='Enter') testComponentSearch()"
      >
      <button onclick="testComponentSearch()">æ¨¡æ‹Ÿç»„ä»¶æœç´¢</button>
    </div>
    <pre id="component-search-result">è¾“å…¥å…³é”®è¯å¹¶ç‚¹å‡»æœç´¢...</pre>
  </div>
  
  <div class="debug-section">
    <h2>5ï¸âƒ£ è¯Šæ–­æŠ¥å‘Š</h2>
    <button onclick="runDiagnosis()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
    <pre id="diagnosis-result">ç‚¹å‡»æŒ‰é’®è¿è¡Œè¯Šæ–­...</pre>
  </div>

  <script>
    // ========== 1. æ£€æŸ¥ localStorage ==========
    function checkLocalStorage() {
      const contacts = JSON.parse(localStorage.getItem('remarkable-contacts') || '[]');
      const result = document.getElementById('storage-result');
      
      if (contacts.length === 0) {
        result.innerHTML = '<span class="error">âŒ è”ç³»äººåº“ä¸ºç©ºï¼</span>\n\nè¯·å…ˆæ·»åŠ æµ‹è¯•æ•°æ®ã€‚';
        return;
      }
      
      result.innerHTML = `<span class="success">âœ… æ‰¾åˆ° ${contacts.length} ä¸ªè”ç³»äºº</span>\n\n`;
      result.innerHTML += JSON.stringify(contacts, null, 2);
      
      console.table(contacts.map(c => ({
        å§“å: c.name,
        é‚®ç®±: c.email,
        å…¬å¸: c.organization,
        æ¥æº: c.isReMarkable ? 'ReMarkable' : 'æœªçŸ¥'
      })));
    }
    
    function checkEvents() {
      const events = JSON.parse(localStorage.getItem('remarkable-events') || '[]');
      const result = document.getElementById('storage-result');
      
      result.innerHTML = `<span class="info">â„¹ï¸ æ‰¾åˆ° ${events.length} ä¸ªäº‹ä»¶</span>\n\n`;
      result.innerHTML += JSON.stringify(events, null, 2);
    }
    
    function clearAll() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
      
      localStorage.removeItem('remarkable-contacts');
      localStorage.removeItem('remarkable-events');
      document.getElementById('storage-result').innerHTML = '<span class="success">âœ… å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®</span>';
    }
    
    // ========== 2. æµ‹è¯•æœç´¢ ==========
    function testSearch() {
      const query = document.getElementById('search-input').value;
      const contacts = JSON.parse(localStorage.getItem('remarkable-contacts') || '[]');
      const result = document.getElementById('search-result');
      
      if (contacts.length === 0) {
        result.innerHTML = '<span class="error">âŒ è”ç³»äººåº“ä¸ºç©ºï¼Œæ— æ³•æœç´¢</span>';
        return;
      }
      
      const lowerQuery = query.toLowerCase();
      const results = contacts.filter(c => 
        c.name?.toLowerCase().includes(lowerQuery) ||
        c.email?.toLowerCase().includes(lowerQuery) ||
        c.organization?.toLowerCase().includes(lowerQuery)
      );
      
      if (results.length === 0) {
        result.innerHTML = `<span class="error">âŒ æœªæ‰¾åˆ°åŒ¹é… "${query}" çš„è”ç³»äºº</span>\n\n`;
        result.innerHTML += `æ•°æ®åº“ä¸­çš„æ‰€æœ‰è”ç³»äººï¼š\n${contacts.map(c => c.name).join(', ')}`;
        return;
      }
      
      result.innerHTML = `<span class="success">âœ… æ‰¾åˆ° ${results.length} ä¸ªåŒ¹é…ç»“æœ</span>\n\n`;
      result.innerHTML += JSON.stringify(results, null, 2);
    }
    
    // ========== 3. æ·»åŠ æµ‹è¯•æ•°æ® ==========
    function addDemoContacts() {
      const demoContacts = [
        {
          id: 'demo-1',
          name: 'Zoey Gong',
          email: 'zoey.gong@company.com',
          organization: 'äº§å“éƒ¨',
          isReMarkable: true
        },
        {
          id: 'demo-2',
          name: 'Jenny Wong',
          email: 'jenny.wong@company.com',
          organization: 'è®¾è®¡éƒ¨',
          isReMarkable: true
        },
        {
          id: 'demo-3',
          name: 'Cindy Cai',
          email: 'cindy.cai@company.com',
          organization: 'æŠ€æœ¯éƒ¨',
          isReMarkable: true
        }
      ];
      
      localStorage.setItem('remarkable-contacts', JSON.stringify(demoContacts));
      document.getElementById('add-result').innerHTML = '<span class="success">âœ… å·²æ·»åŠ  3 ä¸ªæ¼”ç¤ºè”ç³»äºº</span>\n\n' + JSON.stringify(demoContacts, null, 2);
    }
    
    function addRandomContact() {
      const contacts = JSON.parse(localStorage.getItem('remarkable-contacts') || '[]');
      const randomId = Date.now();
      const newContact = {
        id: 'test-' + randomId,
        name: `Test User ${randomId}`,
        email: `test${randomId}@example.com`,
        organization: 'Test Company',
        isReMarkable: true
      };
      
      contacts.push(newContact);
      localStorage.setItem('remarkable-contacts', JSON.stringify(contacts));
      
      document.getElementById('add-result').innerHTML = '<span class="success">âœ… å·²æ·»åŠ éšæœºè”ç³»äºº</span>\n\n' + JSON.stringify(newContact, null, 2);
    }
    
    // ========== 4. æ¨¡æ‹Ÿç»„ä»¶æœç´¢ ==========
    function testComponentSearch() {
      const query = document.getElementById('component-search-input').value;
      const result = document.getElementById('component-search-result');
      
      result.innerHTML = '<div class="info">ğŸ” æ¨¡æ‹Ÿ AttendeeDisplay æœç´¢æµç¨‹...</div>\n\n';
      
      // Step 1: searchLocalContacts
      result.innerHTML += '<strong>Step 1: searchLocalContacts()</strong>\n';
      const contacts = JSON.parse(localStorage.getItem('remarkable-contacts') || '[]');
      const lowerQuery = query.toLowerCase();
      const localResults = contacts.filter(contact => {
        if (!contact.isReMarkable) return false;
        return (
          contact.name?.toLowerCase().includes(lowerQuery) ||
          contact.email?.toLowerCase().includes(lowerQuery) ||
          contact.organization?.toLowerCase().includes(lowerQuery)
        );
      });
      result.innerHTML += `æ‰¾åˆ° ${localResults.length} ä¸ªæœ¬åœ°è”ç³»äºº\n`;
      result.innerHTML += JSON.stringify(localResults, null, 2) + '\n\n';
      
      // Step 2: searchPlatformContacts
      result.innerHTML += '<strong>Step 2: searchPlatformContacts()</strong>\n';
      result.innerHTML += 'æ‰¾åˆ° 0 ä¸ªå¹³å°è”ç³»äººï¼ˆæ¨¡æ‹Ÿç¯å¢ƒæ— å¹³å°æ•°æ®ï¼‰\n\n';
      
      // Step 3: searchHistoricalParticipants
      result.innerHTML += '<strong>Step 3: searchHistoricalParticipants()</strong>\n';
      result.innerHTML += 'æ‰¾åˆ° 0 ä¸ªå†å²å‚ä¼šäººï¼ˆæš‚æ— äº‹ä»¶æ•°æ®ï¼‰\n\n';
      
      // Step 4: åˆå¹¶å»é‡
      result.innerHTML += '<strong>Step 4: åˆå¹¶å»é‡</strong>\n';
      result.innerHTML += `<span class="success">âœ… æœ€ç»ˆç»“æœï¼š${localResults.length} ä¸ªè”ç³»äºº</span>\n`;
      result.innerHTML += JSON.stringify(localResults, null, 2);
    }
    
    // ========== 5. å®Œæ•´è¯Šæ–­ ==========
    function runDiagnosis() {
      const result = document.getElementById('diagnosis-result');
      const contacts = JSON.parse(localStorage.getItem('remarkable-contacts') || '[]');
      const events = JSON.parse(localStorage.getItem('remarkable-events') || '[]');
      
      let report = 'ğŸ“Š è¯Šæ–­æŠ¥å‘Š\n\n';
      report += '='.repeat(50) + '\n\n';
      
      // æ£€æŸ¥ 1: localStorage
      report += 'âœ“ localStorage çŠ¶æ€\n';
      report += `  - remarkable-contacts: ${contacts.length} æ¡è®°å½•\n`;
      report += `  - remarkable-events: ${events.length} æ¡è®°å½•\n\n`;
      
      // æ£€æŸ¥ 2: è”ç³»äººæ•°æ®ç»“æ„
      if (contacts.length > 0) {
        const firstContact = contacts[0];
        report += 'âœ“ è”ç³»äººæ•°æ®ç»“æ„\n';
        report += `  - å­—æ®µ: ${Object.keys(firstContact).join(', ')}\n`;
        report += `  - isReMarkable: ${firstContact.isReMarkable ? 'âœ…' : 'âŒ'}\n\n`;
      } else {
        report += 'âŒ è”ç³»äººåº“ä¸ºç©º\n\n';
      }
      
      // æ£€æŸ¥ 3: æœç´¢æµ‹è¯•
      report += 'âœ“ æœç´¢æµ‹è¯•\n';
      if (contacts.length > 0) {
        const testQuery = contacts[0].name?.substring(0, 3) || '';
        const searchResults = contacts.filter(c => 
          c.name?.toLowerCase().includes(testQuery.toLowerCase())
        );
        report += `  - æœç´¢ "${testQuery}": ${searchResults.length > 0 ? 'âœ… å¯æœç´¢' : 'âŒ æœç´¢å¤±è´¥'}\n\n`;
      } else {
        report += '  - æ— æ³•æµ‹è¯•ï¼ˆè”ç³»äººåº“ä¸ºç©ºï¼‰\n\n';
      }
      
      // æ£€æŸ¥ 4: è¯Šæ–­å»ºè®®
      report += 'ğŸ’¡ è¯Šæ–­å»ºè®®\n';
      if (contacts.length === 0) {
        report += '  âŒ è”ç³»äººåº“ä¸ºç©º\n';
        report += '     â†’ è¯·åˆ·æ–° EventEditModalV2Demo é¡µé¢\n';
        report += '     â†’ æˆ–æ‰‹åŠ¨ç‚¹å‡»"æ·»åŠ æ¼”ç¤ºè”ç³»äºº"æŒ‰é’®\n';
      } else if (contacts.every(c => !c.isReMarkable)) {
        report += '  âŒ æ‰€æœ‰è”ç³»äººéƒ½æ²¡æœ‰ isReMarkable æ ‡è®°\n';
        report += '     â†’ searchLocalContacts() ä¼šè¿‡æ»¤æ‰æ‰€æœ‰ç»“æœ\n';
      } else {
        report += '  âœ… æ•°æ®ç»“æ„æ­£å¸¸\n';
        report += '  âœ… æœç´¢åŠŸèƒ½åº”è¯¥å¯ä»¥å·¥ä½œ\n';
        report += '     â†’ å¦‚æœä»ç„¶æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥å‰ç«¯ç»„ä»¶ä»£ç \n';
      }
      
      result.innerHTML = '<pre>' + report + '</pre>';
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œè¯Šæ–­
    window.onload = function() {
      runDiagnosis();
    };
  </script>
</body>
</html>
