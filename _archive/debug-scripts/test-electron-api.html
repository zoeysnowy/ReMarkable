<!DOCTYPE html>
<html>
<head>
    <title>Electron API æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1e293b;
            color: #e2e8f0;
        }
        .section {
            background: #334155;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        pre {
            background: #1e293b;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Electron API è¯Šæ–­å·¥å…·</h1>
    
    <div class="section">
        <h2>1. ç¯å¢ƒæ£€æµ‹</h2>
        <div id="env-check"></div>
    </div>
    
    <div class="section">
        <h2>2. electronAPI å¯ç”¨æ€§</h2>
        <div id="api-check"></div>
    </div>
    
    <div class="section">
        <h2>3. invoke æ–¹æ³•æµ‹è¯•</h2>
        <button onclick="testInvoke()">æµ‹è¯• invoke æ–¹æ³•</button>
        <div id="invoke-result"></div>
    </div>
    
    <div class="section">
        <h2>4. AI ä»£ç†æ§åˆ¶æµ‹è¯•</h2>
        <button onclick="testProxyStatus()">æ£€æŸ¥ä»£ç†çŠ¶æ€</button>
        <button onclick="testProxyStart()">å¯åŠ¨ä»£ç†</button>
        <div id="proxy-result"></div>
    </div>

    <script>
        // 1. ç¯å¢ƒæ£€æµ‹
        function checkEnvironment() {
            const envDiv = document.getElementById('env-check');
            const checks = [];
            
            checks.push(`window.electronAPI å­˜åœ¨: ${!!window.electronAPI ? '<span class="success">âœ…</span>' : '<span class="error">âŒ</span>'}`);
            checks.push(`window.electron å­˜åœ¨: ${!!window.electron ? '<span class="success">âœ…</span>' : '<span class="error">âŒ</span>'}`);
            checks.push(`window.electronConstants å­˜åœ¨: ${!!window.electronConstants ? '<span class="success">âœ…</span>' : '<span class="error">âŒ</span>'}`);
            
            if (window.electronAPI) {
                checks.push(`electronAPI.isElectron: ${window.electronAPI.isElectron ? '<span class="success">âœ…</span>' : '<span class="error">âŒ</span>'}`);
                checks.push(`electronAPI.invoke å­˜åœ¨: ${typeof window.electronAPI.invoke === 'function' ? '<span class="success">âœ…</span>' : '<span class="error">âŒ</span>'}`);
            }
            
            envDiv.innerHTML = checks.join('<br>');
        }
        
        // 2. API å¯ç”¨æ€§æ£€æŸ¥
        function checkAPIAvailability() {
            const apiDiv = document.getElementById('api-check');
            const api = window.electronAPI || window.electron;
            
            if (!api) {
                apiDiv.innerHTML = '<span class="error">âŒ æœªæ£€æµ‹åˆ° Electron API</span>';
                return;
            }
            
            const methods = [
                'getVersion',
                'getPlatform',
                'invoke',
                'on',
                'send',
                'removeAllListeners'
            ];
            
            const results = methods.map(method => {
                const exists = typeof api[method] === 'function';
                return `${method}: ${exists ? '<span class="success">âœ…</span>' : '<span class="error">âŒ</span>'}`;
            });
            
            apiDiv.innerHTML = results.join('<br>');
        }
        
        // 3. æµ‹è¯• invoke æ–¹æ³•
        async function testInvoke() {
            const resultDiv = document.getElementById('invoke-result');
            const api = window.electronAPI || window.electron;
            
            if (!api || typeof api.invoke !== 'function') {
                resultDiv.innerHTML = '<span class="error">âŒ invoke æ–¹æ³•ä¸å¯ç”¨</span>';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'â³ æµ‹è¯•ä¸­...';
                const version = await api.invoke('app-version');
                resultDiv.innerHTML = `<span class="success">âœ… invoke æ–¹æ³•æ­£å¸¸å·¥ä½œ</span><br><pre>åº”ç”¨ç‰ˆæœ¬: ${version}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ è°ƒç”¨å¤±è´¥</span><br><pre>${error.message}</pre>`;
            }
        }
        
        // 4. æµ‹è¯•ä»£ç†çŠ¶æ€
        async function testProxyStatus() {
            const resultDiv = document.getElementById('proxy-result');
            const api = window.electronAPI || window.electron;
            
            if (!api || typeof api.invoke !== 'function') {
                resultDiv.innerHTML = '<span class="error">âŒ invoke æ–¹æ³•ä¸å¯ç”¨</span>';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'â³ æ£€æŸ¥ä»£ç†çŠ¶æ€...';
                const status = await api.invoke('check-ai-proxy-status');
                resultDiv.innerHTML = `<span class="success">âœ… ä»£ç†çŠ¶æ€æ£€æŸ¥æˆåŠŸ</span><br><pre>${JSON.stringify(status, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ è°ƒç”¨å¤±è´¥</span><br><pre>${error.message}</pre>`;
            }
        }
        
        // 5. æµ‹è¯•å¯åŠ¨ä»£ç†
        async function testProxyStart() {
            const resultDiv = document.getElementById('proxy-result');
            const api = window.electronAPI || window.electron;
            
            if (!api || typeof api.invoke !== 'function') {
                resultDiv.innerHTML = '<span class="error">âŒ invoke æ–¹æ³•ä¸å¯ç”¨</span>';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'â³ æ­£åœ¨å¯åŠ¨ä»£ç†...';
                const result = await api.invoke('start-ai-proxy');
                resultDiv.innerHTML = `<span class="success">âœ… ä»£ç†å¯åŠ¨æˆåŠŸ</span><br><pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ å¯åŠ¨å¤±è´¥</span><br><pre>${error.message}</pre>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ£€æŸ¥
        window.addEventListener('DOMContentLoaded', () => {
            checkEnvironment();
            checkAPIAvailability();
        });
    </script>
</body>
</html>
