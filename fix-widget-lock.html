<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ä¿®å¤ Widget é”å®šçŠ¶æ€</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 30px;
    }
    h1 { margin-top: 0; }
    button {
      background: white;
      color: #667eea;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 10px 10px 0;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .status {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
    }
    .success { color: #2ecc71; }
    .warning { color: #f39c12; }
    .error { color: #e74c3c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ Widget é”å®šçŠ¶æ€ä¿®å¤å·¥å…·</h1>
    
    <h2>å½“å‰çŠ¶æ€</h2>
    <div class="status" id="status">æ­£åœ¨æ£€æŸ¥...</div>
    
    <h2>æ“ä½œ</h2>
    <button onclick="checkStatus()">ğŸ” æ£€æŸ¥çŠ¶æ€</button>
    <button onclick="unlockWidget()">ğŸ”“ è§£é™¤é”å®š</button>
    <button onclick="clearAllSettings()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è®¾ç½®</button>
    <button onclick="location.reload()">ğŸ”„ åˆ·æ–°é¡µé¢</button>
    
    <h2>è¯´æ˜</h2>
    <ul>
      <li><strong>æ£€æŸ¥çŠ¶æ€</strong>ï¼šæŸ¥çœ‹å½“å‰ Widget çš„é”å®šçŠ¶æ€</li>
      <li><strong>è§£é™¤é”å®š</strong>ï¼šå°† isLocked è®¾ç½®ä¸º false</li>
      <li><strong>æ¸…é™¤æ‰€æœ‰è®¾ç½®</strong>ï¼šåˆ é™¤æ‰€æœ‰ä¿å­˜çš„ Widget è®¾ç½®</li>
      <li><strong>åˆ·æ–°é¡µé¢</strong>ï¼šåº”ç”¨æ›´æ”¹ååˆ·æ–°é¡µé¢</li>
    </ul>
    
    <h2>ä½¿ç”¨æ­¥éª¤</h2>
    <ol>
      <li>ç‚¹å‡»"æ£€æŸ¥çŠ¶æ€"æŸ¥çœ‹å½“å‰è®¾ç½®</li>
      <li>å¦‚æœ isLocked ä¸º trueï¼Œç‚¹å‡»"è§£é™¤é”å®š"</li>
      <li>ç‚¹å‡»"åˆ·æ–°é¡µé¢"ä½¿æ›´æ”¹ç”Ÿæ•ˆ</li>
      <li>é‡æ–°æ‰“å¼€ Widget çª—å£æµ‹è¯•æ‹–åŠ¨åŠŸèƒ½</li>
    </ol>
  </div>

  <script>
    function log(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
      statusDiv.innerHTML += `\n[${timestamp}] ${icon} ${message}`;
      statusDiv.className = `status ${type}`;
    }

    function checkStatus() {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = ''; // æ¸…ç©º
      
      log('=== æ£€æŸ¥ Widget çŠ¶æ€ ===', 'info');
      
      const settings = localStorage.getItem('desktop-calendar-widget-settings');
      if (settings) {
        try {
          const parsed = JSON.parse(settings);
          log('æ‰¾åˆ°ä¿å­˜çš„è®¾ç½®:', 'success');
          log(JSON.stringify(parsed, null, 2), 'info');
          
          if (parsed.isLocked === true) {
            log('âš ï¸ Widget å½“å‰å¤„äºé”å®šçŠ¶æ€ï¼', 'warning');
            log('æ‹–åŠ¨æ¡å°†ä¸ä¼šæ˜¾ç¤ºï¼Œçª—å£æ— æ³•æ‹–åŠ¨', 'warning');
            log('ç‚¹å‡»"è§£é™¤é”å®š"æŒ‰é’®è¿›è¡Œä¿®å¤', 'warning');
          } else {
            log('âœ… Widget æœªé”å®š', 'success');
          }
        } catch (e) {
          log('è§£æè®¾ç½®å¤±è´¥: ' + e.message, 'error');
        }
      } else {
        log('æœªæ‰¾åˆ°ä¿å­˜çš„è®¾ç½®ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰', 'info');
        log('Widget å°†ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæœªé”å®šï¼‰', 'success');
      }
      
      // æ£€æŸ¥æ˜¯å¦åœ¨ Electron ç¯å¢ƒ
      if (window.electronAPI) {
        log('âœ… æ£€æµ‹åˆ° Electron ç¯å¢ƒ', 'success');
      } else {
        log('âš ï¸ æœªæ£€æµ‹åˆ° Electron ç¯å¢ƒ', 'warning');
        log('è¯·åœ¨ Electron Widget çª—å£ä¸­æ‰“å¼€æ­¤é¡µé¢', 'warning');
      }
    }

    function unlockWidget() {
      log('\n=== è§£é™¤é”å®š ===', 'info');
      
      const settings = localStorage.getItem('desktop-calendar-widget-settings');
      if (settings) {
        try {
          const parsed = JSON.parse(settings);
          parsed.isLocked = false;
          localStorage.setItem('desktop-calendar-widget-settings', JSON.stringify(parsed));
          log('âœ… å·²å°† isLocked è®¾ç½®ä¸º false', 'success');
          log('æ–°è®¾ç½®: ' + JSON.stringify(parsed, null, 2), 'success');
          log('ğŸ“ è¯·ç‚¹å‡»"åˆ·æ–°é¡µé¢"ä½¿æ›´æ”¹ç”Ÿæ•ˆ', 'warning');
        } catch (e) {
          log('ä¿®å¤å¤±è´¥: ' + e.message, 'error');
        }
      } else {
        log('æœªæ‰¾åˆ°è®¾ç½®ï¼Œåˆ›å»ºæ–°çš„é»˜è®¤è®¾ç½®...', 'info');
        const newSettings = {
          bgOpacity: 0.95,
          bgColor: '#ffffff',
          isLocked: false
        };
        localStorage.setItem('desktop-calendar-widget-settings', JSON.stringify(newSettings));
        log('âœ… å·²åˆ›å»ºæ–°è®¾ç½®', 'success');
        log('ğŸ“ è¯·ç‚¹å‡»"åˆ·æ–°é¡µé¢"', 'warning');
      }
    }

    function clearAllSettings() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ Widget è®¾ç½®å—ï¼Ÿ\nè¿™å°†åˆ é™¤é€æ˜åº¦ã€é¢œè‰²å’Œé”å®šçŠ¶æ€ç­‰æ‰€æœ‰è‡ªå®šä¹‰è®¾ç½®ã€‚')) {
        localStorage.removeItem('desktop-calendar-widget-settings');
        log('\n=== æ¸…é™¤è®¾ç½® ===', 'info');
        log('âœ… æ‰€æœ‰è®¾ç½®å·²æ¸…é™¤', 'success');
        log('Widget å°†ä½¿ç”¨é»˜è®¤è®¾ç½®', 'info');
        log('ğŸ“ è¯·ç‚¹å‡»"åˆ·æ–°é¡µé¢"', 'warning');
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
    window.onload = () => {
      checkStatus();
    };
  </script>
</body>
</html>

