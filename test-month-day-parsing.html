<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœˆä»½+æ—¥æœŸå·è§£ææµ‹è¯• - v2.10.1</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 10px;
    }
    .version {
      color: #666;
      font-size: 14px;
      margin-top: -10px;
      margin-bottom: 20px;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
    }
    .test-input {
      margin: 15px 0;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #555;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }
    input:focus {
      outline: none;
      border-color: #4CAF50;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background: #45a049;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 6px;
      border: 2px solid #4CAF50;
    }
    .result-item {
      margin: 8px 0;
      padding: 8px;
      background: #f0f7ff;
      border-radius: 4px;
    }
    .result-label {
      font-weight: 600;
      color: #1976D2;
      display: inline-block;
      width: 150px;
    }
    .result-value {
      color: #333;
      font-family: 'Courier New', monospace;
    }
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    .error {
      color: #f44336;
      font-weight: bold;
    }
    .examples {
      background: #fff3cd;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #ffc107;
      margin-top: 20px;
    }
    .examples h3 {
      margin-top: 0;
      color: #856404;
    }
    .example-list {
      list-style: none;
      padding: 0;
    }
    .example-list li {
      padding: 8px;
      margin: 5px 0;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .example-list li:hover {
      background: #ffe69c;
    }
    .info-box {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }
    .info-box strong {
      color: #1565C0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ—“ï¸ æœˆä»½+æ—¥æœŸå·è§£ææµ‹è¯•</h1>
    <p class="version">v2.10.1 - 2025-11-17</p>

    <div class="info-box">
      <strong>æµ‹è¯•ç›®æ ‡ï¼š</strong>éªŒè¯"ä¸‹ä¸ªæœˆ3å·"ã€"æœ¬æœˆ15å·"ç­‰æœˆä»½+æ—¥æœŸå·æ¨¡å¼çš„æ­£åˆ™è§£æåŠŸèƒ½<br>
      <strong>å‚è€ƒæ—¥æœŸï¼š</strong><span id="referenceDate"></span>
    </div>

    <div class="test-section">
      <h2>ğŸ“ æ‰‹åŠ¨æµ‹è¯•</h2>
      <div class="test-input">
        <label for="testInput">è¾“å…¥è‡ªç„¶è¯­è¨€æ—¶é—´è¡¨è¾¾ï¼š</label>
        <input 
          type="text" 
          id="testInput" 
          placeholder="ä¾‹å¦‚ï¼šä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹"
          autocomplete="off"
        >
        <button onclick="parseInput()">è§£æ</button>
      </div>

      <div id="result"></div>
    </div>

    <div class="examples">
      <h3>ğŸ’¡ å¿«é€Ÿæµ‹è¯•ç¤ºä¾‹ï¼ˆç‚¹å‡»æµ‹è¯•ï¼‰</h3>
      <ul class="example-list">
        <li onclick="testExample('ä¸‹ä¸ªæœˆ3å·')">ä¸‹ä¸ªæœˆ3å·</li>
        <li onclick="testExample('ä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹')">ä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹</li>
        <li onclick="testExample('æœ¬æœˆ15å·')">æœ¬æœˆ15å·</li>
        <li onclick="testExample('æœ¬æœˆ15å·ä¸Šåˆ10ç‚¹')">æœ¬æœˆ15å·ä¸Šåˆ10ç‚¹</li>
        <li onclick="testExample('ä¸‹æœˆ20å·æ™šä¸Š8ç‚¹åŠ')">ä¸‹æœˆ20å·æ™šä¸Š8ç‚¹åŠ</li>
        <li onclick="testExample('ä¸Šä¸ªæœˆ10å·')">ä¸Šä¸ªæœˆ10å·</li>
        <li onclick="testExample('è¿™ä¸ªæœˆ25å·ä¸­åˆ12ç‚¹')">è¿™ä¸ªæœˆ25å·ä¸­åˆ12ç‚¹</li>
        <li onclick="testExample('ä¸‹ä¸ªæœˆä¸‰å·')">ä¸‹ä¸ªæœˆä¸‰å·ï¼ˆä¸­æ–‡æ•°å­—ï¼‰</li>
        <li onclick="testExample('æœ¬æœˆåäº”å·')">æœ¬æœˆåäº”å·ï¼ˆä¸­æ–‡æ•°å­—ï¼‰</li>
        <li onclick="testExample('ä¸‹æœˆäºŒåå…«å·ä¸‹åˆä¸‰ç‚¹åŠ')">ä¸‹æœˆäºŒåå…«å·ä¸‹åˆä¸‰ç‚¹åŠï¼ˆå…¨ä¸­æ–‡ï¼‰</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶</h2>
      <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
      <div id="autoTestResults"></div>
    </div>
  </div>

  <script type="module">
    import { parseNaturalLanguage } from './src/utils/naturalLanguageTimeDictionary.ts';
    import dayjs from 'dayjs';

    // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
    window.parseNaturalLanguage = parseNaturalLanguage;
    window.dayjs = dayjs;

    // æ˜¾ç¤ºå‚è€ƒæ—¥æœŸ
    document.getElementById('referenceDate').textContent = dayjs().format('YYYY-MM-DD (dddd)');

    // è§£æè¾“å…¥
    window.parseInput = function() {
      const input = document.getElementById('testInput').value;
      if (!input.trim()) {
        alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„æ–‡æœ¬');
        return;
      }

      const result = parseNaturalLanguage(input);
      displayResult(input, result);
    };

    // æµ‹è¯•ç¤ºä¾‹
    window.testExample = function(text) {
      document.getElementById('testInput').value = text;
      parseInput();
    };

    // æ˜¾ç¤ºç»“æœ
    function displayResult(input, result) {
      const resultDiv = document.getElementById('result');
      
      if (!result.matched) {
        resultDiv.innerHTML = `
          <div class="result">
            <h3 class="error">âŒ æœªåŒ¹é…</h3>
            <p>è¾“å…¥"${input}"æ— æ³•è§£æ</p>
          </div>
        `;
        return;
      }

      let html = `
        <div class="result">
          <h3 class="success">âœ… è§£ææˆåŠŸ</h3>
          <div class="result-item">
            <span class="result-label">è¾“å…¥æ–‡æœ¬ï¼š</span>
            <span class="result-value">${input}</span>
          </div>
      `;

      if (result.pointInTime) {
        html += `
          <div class="result-item">
            <span class="result-label">ç±»å‹ï¼š</span>
            <span class="result-value">ç²¾ç¡®æ—¶é—´ç‚¹ (PointInTime)</span>
          </div>
          <div class="result-item">
            <span class="result-label">æ—¥æœŸï¼š</span>
            <span class="result-value">${result.pointInTime.date.format('YYYY-MM-DD HH:mm:ss')}</span>
          </div>
          <div class="result-item">
            <span class="result-label">æ˜¾ç¤ºæç¤ºï¼š</span>
            <span class="result-value">${result.pointInTime.displayHint}</span>
          </div>
          <div class="result-item">
            <span class="result-label">æ¨¡ç³Šæ—¥æœŸï¼š</span>
            <span class="result-value">${result.pointInTime.isFuzzyDate ? 'æ˜¯' : 'å¦'}</span>
          </div>
        `;
      }

      if (result.dateRange) {
        html += `
          <div class="result-item">
            <span class="result-label">ç±»å‹ï¼š</span>
            <span class="result-value">æ—¥æœŸèŒƒå›´ (DateRange)</span>
          </div>
          <div class="result-item">
            <span class="result-label">å¼€å§‹ï¼š</span>
            <span class="result-value">${result.dateRange.start.format('YYYY-MM-DD HH:mm:ss')}</span>
          </div>
          <div class="result-item">
            <span class="result-label">ç»“æŸï¼š</span>
            <span class="result-value">${result.dateRange.end.format('YYYY-MM-DD HH:mm:ss')}</span>
          </div>
        `;
      }

      if (result.timePeriod) {
        html += `
          <div class="result-item">
            <span class="result-label">æ—¶é—´æ®µåç§°ï¼š</span>
            <span class="result-value">${result.timePeriod.name}</span>
          </div>
          <div class="result-item">
            <span class="result-label">å¼€å§‹æ—¶é—´ï¼š</span>
            <span class="result-value">${String(result.timePeriod.startHour).padStart(2, '0')}:${String(result.timePeriod.startMinute).padStart(2, '0')}</span>
          </div>
          <div class="result-item">
            <span class="result-label">ç»“æŸæ—¶é—´ï¼š</span>
            <span class="result-value">${String(result.timePeriod.endHour).padStart(2, '0')}:${String(result.timePeriod.endMinute).padStart(2, '0')}</span>
          </div>
          <div class="result-item">
            <span class="result-label">æ—¶é—´ç±»å‹ï¼š</span>
            <span class="result-value">${result.timePeriod.timeType || 'none'}</span>
          </div>
        `;
      }

      html += '</div>';
      resultDiv.innerHTML = html;
    }

    // è‡ªåŠ¨åŒ–æµ‹è¯•
    window.runAllTests = function() {
      const today = dayjs();
      const tests = [
        {
          input: 'ä¸‹ä¸ªæœˆ3å·',
          expect: {
            hasPointInTime: true,
            displayHint: 'ä¸‹æœˆ3å·',
            date: today.add(1, 'month').date(3).format('YYYY-MM-DD')
          }
        },
        {
          input: 'ä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹',
          expect: {
            hasPointInTime: true,
            hasTimePeriod: true,
            displayHint: 'ä¸‹æœˆ3å·ä¸‹åˆ5ç‚¹',
            startHour: 17,
            startMinute: 0
          }
        },
        {
          input: 'æœ¬æœˆ15å·',
          expect: {
            hasPointInTime: true,
            displayHint: 'æœ¬æœˆ15å·',
            date: today.date(15).format('YYYY-MM-DD')
          }
        },
        {
          input: 'ä¸Šæœˆ10å·',
          expect: {
            hasPointInTime: true,
            displayHint: 'ä¸Šæœˆ10å·',
            date: today.subtract(1, 'month').date(10).format('YYYY-MM-DD')
          }
        }
      ];

      let html = '<div style="margin-top: 20px;">';
      let passCount = 0;

      tests.forEach((test, index) => {
        const result = parseNaturalLanguage(test.input);
        const pass = validateResult(result, test.expect);
        
        if (pass) passCount++;

        html += `
          <div class="result-item" style="background: ${pass ? '#e8f5e9' : '#ffebee'};">
            <span class="result-label">æµ‹è¯• ${index + 1}:</span>
            <span class="result-value">"${test.input}"</span>
            <span style="float: right; font-weight: bold; color: ${pass ? '#4CAF50' : '#f44336'};">
              ${pass ? 'âœ… PASS' : 'âŒ FAIL'}
            </span>
          </div>
        `;
      });

      html += `
        <div class="result" style="margin-top: 20px;">
          <h3>æµ‹è¯•ç»“æœæ±‡æ€»</h3>
          <p>é€šè¿‡: <strong class="success">${passCount}</strong> / ${tests.length}</p>
        </div>
      `;

      document.getElementById('autoTestResults').innerHTML = html;
    };

    function validateResult(result, expect) {
      if (!result.matched) return false;
      
      if (expect.hasPointInTime && !result.pointInTime) return false;
      if (expect.hasTimePeriod && !result.timePeriod) return false;
      
      if (expect.displayHint && result.pointInTime?.displayHint !== expect.displayHint) return false;
      if (expect.date && result.pointInTime?.date.format('YYYY-MM-DD') !== expect.date) return false;
      if (expect.startHour !== undefined && result.timePeriod?.startHour !== expect.startHour) return false;
      if (expect.startMinute !== undefined && result.timePeriod?.startMinute !== expect.startMinute) return false;
      
      return true;
    }
  </script>
</body>
</html>
