name: Publish Holiday Data

# å½“æ¨é€ holidays-YYYY æ ‡ç­¾æ—¶è§¦å‘
on:
  push:
    tags:
      - 'holidays-*'

jobs:
  publish:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
      
      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: æå–å¹´ä»½
        id: version
        run: |
          YEAR=${GITHUB_REF#refs/tags/holidays-}
          echo "YEAR=$YEAR" >> $GITHUB_OUTPUT
          echo "ğŸ“… å°†å‘å¸ƒ $YEAR å¹´å‡æ—¥æ•°æ®"
      
      - name: æ„å»ºå‡æ—¥æ•°æ® JSON
        run: |
          node scripts/buildHolidayData.js ${{ steps.version.outputs.YEAR }}
      
      - name: éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶
        run: |
          if [ ! -f public/holidays/holidays-${{ steps.version.outputs.YEAR }}.json ]; then
            echo "âŒ æ–‡ä»¶æœªç”Ÿæˆ"
            exit 1
          fi
          echo "âœ… æ–‡ä»¶å·²ç”Ÿæˆ"
          cat public/holidays/holidays-${{ steps.version.outputs.YEAR }}.json
      
      - name: åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            public/holidays/holidays-${{ steps.version.outputs.YEAR }}.json
          name: ${{ steps.version.outputs.YEAR }}å¹´å‡æ—¥å®‰æ’
          body: |
            ## ğŸ‰ ${{ steps.version.outputs.YEAR }}å¹´å‡æ—¥å®‰æ’å·²å‘å¸ƒ
            
            æ ¹æ®**å›½åŠ¡é™¢åŠå…¬å…**é€šçŸ¥å‘å¸ƒ
            
            ### ğŸ“¦ åŒ…å«å†…å®¹
            - âœ… æ³•å®šèŠ‚å‡æ—¥å®‰æ’
            - âœ… è°ƒä¼‘å·¥ä½œæ—¥
            - âœ… å‡æœŸå¤©æ•°ç»Ÿè®¡
            
            ### ğŸ“¥ å¦‚ä½•ä½¿ç”¨
            
            #### æ–¹æ³• 1: è‡ªåŠ¨æ›´æ–°ï¼ˆæ¨èï¼‰
            ReMarkable åº”ç”¨ä¼šåœ¨åå°è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼Œå‘ç°æ–°ç‰ˆæœ¬åä¼šå¼¹å‡ºé€šçŸ¥ï¼Œç‚¹å‡»"ç«‹å³æ›´æ–°"å³å¯ã€‚
            
            #### æ–¹æ³• 2: æ‰‹åŠ¨ä¸‹è½½
            1. ä¸‹è½½ `holidays-${{ steps.version.outputs.YEAR }}.json` æ–‡ä»¶
            2. æ‰“å¼€ ReMarkable åº”ç”¨
            3. è¿›å…¥è®¾ç½® â†’ å‡æ—¥ç®¡ç†
            4. ç‚¹å‡»"å¯¼å…¥å‡æ—¥æ•°æ®"å¹¶é€‰æ‹©ä¸‹è½½çš„æ–‡ä»¶
            
            ### ğŸ“… æ•°æ®æ¥æº
            - **å®˜æ–¹æ¥æº**: å›½åŠ¡é™¢åŠå…¬å…
            - **å‘å¸ƒæ—¶é—´**: $(date +%Y-%m-%d)
            - **æ•°æ®ç‰ˆæœ¬**: ${{ steps.version.outputs.YEAR }}
            
            ### âš ï¸ æ³¨æ„äº‹é¡¹
            - è¯·åœ¨å›½åŠ¡é™¢æ­£å¼å‘å¸ƒå‡æ—¥å®‰æ’åä½¿ç”¨
            - å»ºè®®åœ¨æ¯å¹´12æœˆä¸‹æ—¬æ£€æŸ¥æ›´æ–°
            - æ•°æ®ä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä»¥å›½åŠ¡é™¢é€šçŸ¥ä¸ºå‡†
          tag_name: holidays-${{ steps.version.outputs.YEAR }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: å‘é€é€šçŸ¥
        run: |
          echo "ğŸ‰ ${{ steps.version.outputs.YEAR }}å¹´å‡æ—¥æ•°æ®å·²å‘å¸ƒåˆ° GitHub Release"
          echo "ğŸ“¦ ç”¨æˆ·å°†åœ¨ä¸‹æ¬¡åº”ç”¨å¯åŠ¨æ—¶æ”¶åˆ°æ›´æ–°é€šçŸ¥"
