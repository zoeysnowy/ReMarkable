<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ£€æŸ¥ localStorage ä¸­çš„ Ghost äº‹ä»¶</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .ghost { background: #ffebee; padding: 5px; margin: 5px 0; }
    .normal { background: #e8f5e9; padding: 5px; margin: 5px 0; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px 5px; }
    .danger { background: #f44336; color: white; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>ğŸ” æ£€æŸ¥ localStorage ä¸­çš„ Ghost äº‹ä»¶</h1>
  
  <button onclick="checkGhostEvents()">æ£€æŸ¥ Ghost äº‹ä»¶</button>
  <button onclick="cleanGhostEvents()" class="danger">æ¸…ç† Ghost äº‹ä»¶</button>
  <button onclick="showRawData()">æŸ¥çœ‹åŸå§‹æ•°æ®</button>
  
  <div id="results"></div>
  
  <script>
    function checkGhostEvents() {
      const eventsData = localStorage.getItem('remarkable_events');
      if (!eventsData) {
        document.getElementById('results').innerHTML = '<p>âŒ æ²¡æœ‰æ‰¾åˆ°äº‹ä»¶æ•°æ®</p>';
        return;
      }
      
      const events = JSON.parse(eventsData);
      const ghostEvents = events.filter(e => e._isDeleted || e._deletedAt);
      const normalEvents = events.filter(e => !e._isDeleted && !e._deletedAt);
      
      let html = `
        <h2>ğŸ“Š ç»Ÿè®¡ç»“æœ</h2>
        <p>æ€»äº‹ä»¶æ•°: ${events.length}</p>
        <p>æ­£å¸¸äº‹ä»¶: ${normalEvents.length}</p>
        <p style="color: red; font-weight: bold;">ğŸ‘» Ghost äº‹ä»¶: ${ghostEvents.length}</p>
        <hr>
      `;
      
      if (ghostEvents.length > 0) {
        html += '<h3>ğŸš¨ å‘ç° Ghost äº‹ä»¶ï¼</h3>';
        ghostEvents.forEach(e => {
          html += `
            <div class="ghost">
              <strong>ID:</strong> ${e.id}<br>
              <strong>æ ‡é¢˜:</strong> ${e.title || e.content || '(æ— æ ‡é¢˜)'}<br>
              <strong>_isDeleted:</strong> ${e._isDeleted}<br>
              <strong>_deletedAt:</strong> ${e._deletedAt ? new Date(e._deletedAt).toLocaleString() : 'N/A'}<br>
            </div>
          `;
        });
      } else {
        html += '<p style="color: green;">âœ… æ²¡æœ‰å‘ç° Ghost äº‹ä»¶</p>';
      }
      
      document.getElementById('results').innerHTML = html;
    }
    
    function cleanGhostEvents() {
      if (!confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ Ghost äº‹ä»¶å—ï¼Ÿè¿™ä¼šä» localStorage ä¸­åˆ é™¤æ‰€æœ‰å¸¦ _isDeleted æ ‡è®°çš„äº‹ä»¶ï¼')) {
        return;
      }
      
      const eventsData = localStorage.getItem('remarkable_events');
      if (!eventsData) {
        alert('æ²¡æœ‰æ‰¾åˆ°äº‹ä»¶æ•°æ®');
        return;
      }
      
      const events = JSON.parse(eventsData);
      const cleanEvents = events.filter(e => !e._isDeleted && !e._deletedAt);
      
      localStorage.setItem('remarkable_events', JSON.stringify(cleanEvents));
      
      alert(`æ¸…ç†å®Œæˆï¼åˆ é™¤äº† ${events.length - cleanEvents.length} ä¸ª Ghost äº‹ä»¶`);
      checkGhostEvents();
    }
    
    function showRawData() {
      const eventsData = localStorage.getItem('remarkable_events');
      if (!eventsData) {
        document.getElementById('results').innerHTML = '<p>âŒ æ²¡æœ‰æ‰¾åˆ°äº‹ä»¶æ•°æ®</p>';
        return;
      }
      
      const events = JSON.parse(eventsData);
      const sample = events.slice(0, 5);
      
      let html = `
        <h2>ğŸ“„ åŸå§‹æ•°æ®ç¤ºä¾‹ (å‰ 5 æ¡)</h2>
        <pre>${JSON.stringify(sample, null, 2)}</pre>
      `;
      
      document.getElementById('results').innerHTML = html;
    }
    
    // è‡ªåŠ¨æ£€æŸ¥
    window.onload = checkGhostEvents;
  </script>
</body>
</html>
