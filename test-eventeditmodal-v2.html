<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>EventEditModal v2 æµ‹è¯•é¡µé¢ - v20251116</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', Arial;
      background: #f3f4f6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .header p {
      font-size: 18px;
      opacity: 0.9;
    }

    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 30px;
    }

    .btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-primary {
      background: white;
      color: #667eea;
    }

    .btn-primary:hover {
      background: #f3f4f6;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid white;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .info-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      margin-bottom: 30px;
    }

    .info-card h2 {
      font-size: 24px;
      color: #1f2937;
      margin-bottom: 16px;
    }

    .info-card p {
      font-size: 16px;
      color: #6b7280;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .feature-list {
      list-style: none;
      margin-top: 16px;
    }

    .feature-list li {
      padding: 8px 0;
      padding-left: 32px;
      position: relative;
      color: #374151;
      font-size: 15px;
    }

    .feature-list li::before {
      content: "âœ…";
      position: absolute;
      left: 0;
      font-size: 18px;
    }

    .screenshot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      max-width: 1200px;
      width: 100%;
    }

    .screenshot-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s;
    }

    .screenshot-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .screenshot-card h3 {
      font-size: 18px;
      color: #1f2937;
      margin-bottom: 12px;
    }

    .screenshot-placeholder {
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      border-radius: 8px;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .screenshot-desc {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.5;
    }

    .code-block {
      background: #1f2937;
      color: #f9fafb;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', 'Microsoft YaHei', Arial;
      font-size: 14px;
      overflow-x: auto;
      margin-top: 16px;
    }

    .code-block code {
      color: #10b981;
    }

    /* EventEditModal v2 æ ·å¼ï¼ˆå†…åµŒï¼‰ */
    .event-edit-modal-v2-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .event-edit-modal-v2 {
      background: #FFF;
      display: flex;
      flex-direction: column;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 10px 10px 0 rgba(0, 0, 0, 0.10);
      transition: all 0.3s ease;
    }

    .event-edit-modal-v2.detail-view {
      border-radius: 45px;
      width: 1071px;
      height: 800px;
      border: 1px solid #E5E7EB;
    }

    .event-edit-modal-v2.compact-view {
      border-radius: 45px;
      width: 383px;
      height: 730px;
    }

    .modal-content {
      display: flex;
      flex: 1;
      overflow: hidden;
      min-height: 0;
    }

    .event-overview {
      width: 400px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      padding: 24px 48px 24px 48px;
      overflow-y: visible;
    }

    /* ä¸Š Section - äº‹ä»¶æ ‡è¯†åŒº */
    .section-identity {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px 20px;
      align-items: center;
    }

    .emoji-large {
      font-size: 42px;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: background 0.2s;
      text-align: center;
      user-select: none;
    }

    .emoji-large:hover {
      background: #f3f4f6;
    }

    .title-checkbox-row {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .custom-checkbox {
      width: 20px;
      height: 20px;
      min-width: 20px;
      border: 2px solid #d1d5db;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
    }

    .custom-checkbox:hover {
      border-color: #3b82f6;
    }

    .custom-checkbox.checked {
      border-color: #3b82f6;
      background: #3b82f6;
      position: relative;
    }

    .custom-checkbox.checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: bold;
    }

    .title-input {
      font-size: 18px;
      font-weight: 400;
      border: none;
      outline: none;
      padding: 0;
      color: #1f2937;
      line-height: 1.5;
      text-align: left;
      width: 1px;
    }

    .title-input::placeholder {
      color: #d1d5db;
    }

    .tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 280px;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .tags-row:hover {
      background: #f9fafb;
    }

    .tag-chip {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      font-size: 13px;
      color: #374151;
    }

    .tag-separator {
      color: #d1d5db;
      margin: 0 2px;
    }

    .tag-etc {
      color: #9ca3af;
      cursor: pointer;
    }

    .timer-button-start {
      background: transparent !important;
      background-color: transparent !important;
      border: 0 !important;
      border-style: none !important;
      padding: 0;
      color: #1f2937;
      font-size: 14px;
      font-weight: 400;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.2s;
      margin: 24px 0;
      outline: none;
    }

    .timer-button-start:hover {
      opacity: 0.8;
    }

    .timer-button-start img {
      width: 20px;
      height: 20px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: #1f2937;
      margin: 20px 0 12px 0;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 24px 0 12px 0;
    }

    .section-header-title {
      font-size: 15px;
      font-weight: 600;
      color: #1f2937;
    }

    .section-header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .header-text-btn {
      padding: 2px 8px;
      border: none;
      background: transparent;
      color: #93c5fd;
      font-size: 13px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .header-text-btn:hover {
      color: #3b82f6;
    }

    .header-icon-btn {
      width: 20px;
      height: 20px;
      padding: 0;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .header-icon-btn:hover {
      opacity: 1;
    }

    .header-icon-btn img {
      width: 16px;
      height: 16px;
    }

    .plan-row {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
      color: #1f2937;
    }

    .time-arrow-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0px;
      margin: 0 4px;
    }

    .duration-text {
      font-size: 10px;
      font-weight: 600;
      background: linear-gradient(135deg, #22d3ee, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
      display: inline-block;
      white-space: nowrap;
    }

    .arrow-icon {
      width: 51px;
      height: auto;
      flex-shrink: 0;
    }

    .plan-icon {
      width: 16px;
      height: 16px;
      margin-top: 2px;
      flex-shrink: 0;
    }

    /* å®é™…è¿›å±• - æ€»æ—¶é•¿ */
    .total-duration {
      font-size: 14px;
      font-weight: 500;
      color: #6b7280;
      white-space: nowrap;
    }

    /* æ—¶é—´ç‰‡æ®µåˆ—è¡¨ */
    .timer-segments-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    /* å®é™…è¿›å±•æ»šåŠ¨å®¹å™¨ */
    .progress-section-wrapper {
      max-height: 280px;
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge */
      margin-bottom: 12px;
    }

    .progress-section-wrapper::-webkit-scrollbar {
      display: none; /* Chrome/Safari/Opera */
    }

    .timer-segment {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #1f2937;
      overflow: visible;
      flex-wrap: nowrap;
      white-space: nowrap;
    }

    .timer-check-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    /* ddlå®ŒæˆçŠ¶æ€ */
    .ddl-completion {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      font-size: 14px;
      color: #6b7280;
    }

    .ddl-completion img {
      width: 16px;
      height: 16px;
    }

    .plan-content {
      flex: 1;
      line-height: 1.5;
    }

    .time-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 12px 0;
    }

    .time-row input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      font-size: 14px;
    }

    .event-log {
      flex: 1;
      min-width: 360px;
      display: flex;
      flex-direction: column;
      padding: 24px 40px 24px 0;
      background: #ffffff;
      overflow-y: auto;
    }

    .back-button {
      background: none;
      border: none;
      color: #6b7280;
      font-size: 14px;
      cursor: pointer;
      padding: 0;
      margin-bottom: 20px;
      align-self: flex-end;
    }

    /* æ ‡ç­¾åŒºåŸŸ */
    .tags-area {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .tag-mention {
      padding: 0;
      border-radius: 0;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      background: transparent;
    }

    .tag-work {
      color: #10b981;
    }

    .tag-client {
      color: #ea580c;
    }

    .detail-footer {
      display: flex;
      justify-content: space-between;
      padding: 12px 48px 40px 48px;
      width: 100%;
      flex-shrink: 0;
      margin-top: 0;
    }

    .footer-btn {
      font-size: 15px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      border-radius: 6px;
    }

    .footer-btn-cancel {
      color: #6b7280;
    }

    .footer-btn-save {
      color: #3b82f6;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ“‹ EventEditModal v2</h1>
    <p>åŒè§†å›¾äº‹ä»¶ç¼–è¾‘å™¨ - æµ‹è¯•é¡µé¢</p>
  </div>

  <div class="controls">
    <button class="btn btn-primary" onclick="openDetailView()">
      ğŸ¯ æ‰“å¼€è¯¦æƒ…è§†å›¾
    </button>
    <button class="btn btn-primary" onclick="openCompactView()">
      ğŸ“± æ‰“å¼€æ”¶ç¼©è§†å›¾
    </button>
    <button class="btn btn-secondary" onclick="location.href='src/components/EventEditModal/EventEditModalV2.tsx'">
      ğŸ“ æŸ¥çœ‹æºä»£ç 
    </button>
  </div>

  <div class="info-card">
    <h2>ğŸ¨ åŠŸèƒ½ç‰¹æ€§</h2>
    <p>EventEditModal v2 æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„åŒè§†å›¾äº‹ä»¶ç¼–è¾‘å™¨ï¼Œä¸“ä¸º ReMarkable æ—¥å†åº”ç”¨è®¾è®¡ã€‚</p>
    <ul class="feature-list">
      <li><strong>åŒè§†å›¾åˆ‡æ¢</strong>ï¼šè¯¦æƒ…è§†å›¾ï¼ˆ720px+ï¼‰å’Œæ”¶ç¼©è§†å›¾ï¼ˆ383pxï¼‰</li>
      <li><strong>æ™ºèƒ½è¡¨å•</strong>ï¼šEmoji é€‰æ‹©ã€æ ‡ç­¾ç®¡ç†ã€æ—¶é—´é€‰æ‹©å™¨</li>
      <li><strong>Timer é›†æˆ</strong>ï¼šå¼€å§‹/æš‚åœ/åœæ­¢/å–æ¶ˆè®¡æ—¶</li>
      <li><strong>è®¡åˆ’å®‰æ’</strong>ï¼šç»„ç»‡è€…ã€å‚ä¸è€…ã€åœ°ç‚¹ã€æ—¥å†åŒæ­¥</li>
      <li><strong>å®é™…è¿›å±•</strong>ï¼šè®¡æ—¶ç‰‡æ®µæ˜¾ç¤ºã€æ€»æ—¶é•¿è®¡ç®—</li>
      <li><strong>Event Log</strong>ï¼šå¯Œæ–‡æœ¬æ—¥å¿—ç¼–è¾‘ï¼ˆSlate ç¼–è¾‘å™¨é›†æˆä¸­ï¼‰</li>
    </ul>

    <div class="code-block">
      <strong>ğŸ“‚ æ–‡ä»¶ä½ç½®ï¼š</strong><br>
      <code>src/components/EventEditModal/EventEditModalV2.tsx</code> (790 è¡Œ)<br>
      <code>src/components/EventEditModal/EventEditModalV2.css</code> (å®Œæ•´æ ·å¼)<br>
      <code>docs/EVENTEDITMODAL_V2_IMPLEMENTATION.md</code> (å®ç°æ–‡æ¡£)
    </div>
  </div>

  <div class="screenshot-grid">
    <div class="screenshot-card">
      <h3>ğŸ“‹ è¯¦æƒ…è§†å›¾</h3>
      <div class="screenshot-placeholder">
        ç‚¹å‡»ä¸Šæ–¹ "æ‰“å¼€è¯¦æƒ…è§†å›¾" æŸ¥çœ‹å®é™…æ•ˆæœ
      </div>
      <p class="screenshot-desc">
        å·¦å³åˆ†æ å¸ƒå±€ï¼Œå·¦ä¾§æ˜¾ç¤ºäº‹ä»¶æ¦‚è§ˆï¼ˆæ ‡é¢˜ã€æ ‡ç­¾ã€è®¡æ—¶ã€è®¡åˆ’ï¼‰ï¼Œå³ä¾§æ˜¾ç¤º Event Logï¼ˆæ—¥å¿—ç¼–è¾‘åŒºï¼‰
      </p>
    </div>

    <div class="screenshot-card">
      <h3>ğŸ“± æ”¶ç¼©è§†å›¾</h3>
      <div class="screenshot-placeholder">
        ç‚¹å‡»ä¸Šæ–¹ "æ‰“å¼€æ”¶ç¼©è§†å›¾" æŸ¥çœ‹å®é™…æ•ˆæœ
      </div>
      <p class="screenshot-desc">
        å¡ç‰‡æ ·å¼å¸ƒå±€ï¼ˆ383px Ã— 730pxï¼‰ï¼Œä»…æ˜¾ç¤ºäº‹ä»¶æ¦‚è§ˆï¼Œä¸“æ³¨äºå¿«é€Ÿç¼–è¾‘å’Œè®¡æ—¶æ“ä½œ
      </p>
    </div>

    <div class="screenshot-card">
      <h3>âš¡ è§†å›¾åˆ‡æ¢</h3>
      <div class="screenshot-placeholder">
        è¯¦æƒ…è§†å›¾ â†” æ”¶ç¼©è§†å›¾
      </div>
      <p class="screenshot-desc">
        è¯¦æƒ…è§†å›¾ä¸­ç‚¹å‡» Event Log å¤´éƒ¨çš„ "back" æŒ‰é’®åˆ‡æ¢åˆ°æ”¶ç¼©è§†å›¾ï¼›æ”¶ç¼©è§†å›¾åº•éƒ¨ç‚¹å‡» "ğŸ“ å±•å¼€æ—¥å¿—" è¿”å›è¯¦æƒ…è§†å›¾
      </p>
    </div>

    <div class="screenshot-card">
      <h3>ğŸ¯ Section ç»„ä»¶</h3>
      <div class="screenshot-placeholder">
        4 ä¸ªæ ¸å¿ƒ Section å·²å®ç°
      </div>
      <p class="screenshot-desc">
        <strong>1.</strong> EventIdentitySection - äº‹ä»¶æ ‡è¯†<br>
        <strong>2.</strong> TimerButtonSection - è®¡æ—¶æŒ‰é’®<br>
        <strong>3.</strong> PlannedScheduleSection - è®¡åˆ’å®‰æ’<br>
        <strong>4.</strong> ActualProgressSection - å®é™…è¿›å±•
      </p>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡† HTMLï¼ˆé€šè¿‡ JS åŠ¨æ€æ’å…¥ï¼‰ -->
  <div id="modalContainer"></div>

  <script>
    // ==================== æ•°æ®æ¨¡æ‹Ÿ ====================
    const mockEvent = {
      id: 'event-1',
      title: '',
      tags: [],
      isTask: true,
      isTimer: false,
      parentEventId: null
    };
    
    console.log('ğŸš€ é¡µé¢åŠ è½½ - mockEvent:', mockEvent);
    console.log('ğŸš€ é¡µé¢åŠ è½½æ—¶é—´:', new Date().toISOString());

    const mockTags = {
      'tag-work': { id: 'tag-work', name: 'å·¥ä½œ', emoji: 'ğŸš€', color: '#10b981', parentId: null },
      'tag-doc-edit': { id: 'tag-doc-edit', name: 'æ–‡æ¡£ç¼–è¾‘', emoji: 'ğŸ“', color: '#3b82f6', parentId: 'tag-work' },
      'tag-client': { id: 'tag-client', name: 'é‡ç‚¹å®¢æˆ·', emoji: 'ğŸ“®', color: '#ea580c', parentId: null },
      'tag-tencent': { id: 'tag-tencent', name: 'è…¾è®¯', emoji: 'ğŸ¢', color: '#f59e0b', parentId: 'tag-client' }
    };

    let formData = { ...mockEvent };
    let emojiPickerVisible = false;
    let tagPickerVisible = false;

    // ==================== Emoji å¤„ç†å‡½æ•° ====================
    
    /**
     * ä»å­—ç¬¦ä¸²ä¸­æå–ç¬¬ä¸€ä¸ª emoji
     */
    function extractFirstEmoji(text) {
      if (!text) return null;
      const emojiRegex = /[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu;
      const match = text.match(emojiRegex);
      return match ? match[0] : null;
    }

    /**
     * è·å–æ˜¾ç¤ºçš„ emojiï¼ˆä¼˜å…ˆçº§ï¼šæ ‡é¢˜ > é¦–ä¸ªæ ‡ç­¾ > é»˜è®¤ï¼‰
     */
    function getDisplayEmoji(event) {
      // ä¼˜å…ˆçº§ 1: æ ‡é¢˜ä¸­çš„ emoji
      const titleEmoji = extractFirstEmoji(event.title);
      if (titleEmoji) return titleEmoji;
      
      // ä¼˜å…ˆçº§ 2: é¦–ä¸ªæ ‡ç­¾çš„ emoji
      if (event.tags && event.tags.length > 0) {
        const firstTag = mockTags[event.tags[0]];
        if (firstTag?.emoji) return firstTag.emoji;
      }
      
      // ä¼˜å…ˆçº§ 3: é»˜è®¤å›¾æ ‡
      return 'ğŸ“Œ';
    }

    /**
     * é€‰æ‹© emoji
     */
    function handleEmojiSelect(selectedEmoji) {
      // 1. ç§»é™¤æ ‡é¢˜ä¸­ç°æœ‰çš„ emoji
      let newTitle = formData.title;
      const existingEmoji = extractFirstEmoji(newTitle);
      if (existingEmoji) {
        newTitle = newTitle.replace(existingEmoji, '').trim();
      }
      
      // 2. å°†æ–° emoji æ·»åŠ åˆ°æ ‡é¢˜å¼€å¤´
      newTitle = `${selectedEmoji} ${newTitle}`;
      
      // 3. æ›´æ–°è¡¨å•æ•°æ®
      formData.title = newTitle;
      
      // 4. æ›´æ–° UI
      updateEmojiDisplay();
      updateTitleInput();
      
      // 5. å…³é—­ Picker
      emojiPickerVisible = false;
      closeEmojiPicker();
    }

    function updateEmojiDisplay() {
      const emojiElement = document.querySelector('.emoji-large');
      if (emojiElement) {
        emojiElement.textContent = getDisplayEmoji(formData);
      }
    }

    function updateTitleInput() {
      const titleInput = document.querySelector('.title-input');
      if (titleInput) {
        titleInput.value = formData.title;
        autoResizeInput(titleInput);
      }
    }

    function openEmojiPicker() {
      emojiPickerVisible = true;
      
      // åœ¨å®é™…Reacté¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šä½¿ç”¨ @emoji-mart/react çš„ Picker ç»„ä»¶
      // å‚è€ƒ: src/components/FloatingToolbar/HeadlessFloatingToolbar.tsx
      
      alert('ğŸ’¡ Emojié€‰æ‹©å™¨é›†æˆè¯´æ˜ï¼š\n\n' +
            'åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šä½¿ç”¨å·²å®‰è£…çš„ @emoji-mart/react åº“ï¼š\n\n' +
            'import Picker from \'@emoji-mart/react\';\n' +
            'import data from \'@emoji-mart/data\';\n\n' +
            '<Picker\n' +
            '  data={data}\n' +
            '  onEmojiSelect={(emoji) => handleEmojiSelect(emoji.native)}\n' +
            '  theme="light"\n' +
            '  locale="zh"\n' +
            '/>\n\n' +
            'å‚è€ƒå·²æœ‰å®ç°ï¼š\n' +
            '- FloatingToolbar/HeadlessFloatingToolbar.tsx\n' +
            '- PlanManager.tsx\n' +
            '- TagManager.tsx');
      
      emojiPickerVisible = false;
    }

    function closeEmojiPicker() {
      const overlay = document.querySelector('.emoji-picker-overlay');
      if (overlay) {
        overlay.remove();
      }
      emojiPickerVisible = false;
    }

    // ==================== æ ‡é¢˜å¤„ç†å‡½æ•° ====================
    
    function getTitlePlaceholder(tags) {
      if (!tags || tags.length === 0) return 'äº‹ä»¶æ ‡é¢˜';
      const firstTag = mockTags[tags[0]];
      return firstTag?.name ? `${firstTag.name}äº‹é¡¹` : 'äº‹ä»¶æ ‡é¢˜';
    }

    function handleTitleChange(newTitle) {
      formData.title = newTitle;
      updateEmojiDisplay(); // æ ‡é¢˜æ”¹å˜å¯èƒ½å½±å“ emoji æ˜¾ç¤º
    }

    // ==================== æ ‡ç­¾å¤„ç†å‡½æ•° ====================
    
    /**
     * æ„å»ºæ ‡ç­¾å±‚çº§è·¯å¾„
     */
    function buildTagPath(tagId) {
      const parts = [];
      let currentTag = mockTags[tagId];
      
      while (currentTag) {
        parts.unshift(`${currentTag.emoji || ''}${currentTag.name}`);
        currentTag = currentTag.parentId ? mockTags[currentTag.parentId] : null;
      }
      
      return parts.join('/');
    }

    /**
     * è·å–æ ‡ç­¾æ˜¾ç¤ºæ–‡æœ¬
     */
    function getTagsDisplayText(tags) {
      if (!tags || tags.length === 0) return 'é€‰æ‹©æ ‡ç­¾...';
      
      const firstPath = buildTagPath(tags[0]);
      
      if (tags.length > 1) {
        return `#${firstPath} ç­‰`;
      }
      return `#${firstPath}`;
    }

    /**
     * æ¸²æŸ“æ ‡ç­¾è¡Œ
     */
    function renderTagsRow() {
      const tagsRow = document.querySelector('.tags-row');
      if (!tagsRow || !formData.tags || formData.tags.length === 0) return;

      const tagChips = formData.tags.map((tagId, index) => {
        const tag = mockTags[tagId];
        if (!tag) return '';
        
        const separator = index > 0 ? '<span class="tag-separator">/</span>' : '';
        return `${separator}<span class="tag-chip">${tag.emoji || ''}${tag.name}</span>`;
      }).join('');

      const etc = formData.tags.length > 2 ? '<span class="tag-etc">ç­‰</span>' : '';
      
      tagsRow.innerHTML = tagChips + etc;
    }

    function openTagPicker() {
      tagPickerVisible = true;
      
      // åœ¨å®é™…Reacté¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šä½¿ç”¨ HierarchicalTagPicker ç»„ä»¶
      // å‚è€ƒ: src/components/HierarchicalTagPicker/
      
      alert('ğŸ’¡ æ ‡ç­¾é€‰æ‹©å™¨é›†æˆè¯´æ˜ï¼š\n\n' +
            'åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šä½¿ç”¨ HierarchicalTagPicker ç»„ä»¶ï¼š\n\n' +
            '<HierarchicalTagPicker\n' +
            '  availableTags={hierarchicalTags}\n' +
            '  selectedTagIds={formData.tags}\n' +
            '  onSelectionChange={(tags) => {\n' +
            '    formData.tags = tags;\n' +
            '    renderTagsRow();\n' +
            '  }}\n' +
            '  mode="popup"\n' +
            '  multiSelect={true}\n' +
            '/>\n\n' +
            'å‚è€ƒå·²æœ‰å®ç°ï¼š\n' +
            '- HierarchicalTagPicker/README.md\n' +
            '- FloatingToolbar/pickers/TagPicker.tsx');
      
      tagPickerVisible = false;
    }

    // ==================== Checkbox å¤„ç† ====================
    
    function handleTaskCheckboxChange(checked) {
      formData.isTask = checked;
    }

    // ==================== æ¨¡æ€æ¡†å‡½æ•° ====================
    function openDetailView() {
      showModal(true);
    }

    function openCompactView() {
      showModal(false);
    }

    function showModal(isDetailView) {
      const container = document.getElementById('modalContainer');
      
      console.log('ğŸ” showModal - formData:', formData);
      console.log('ğŸ” showModal - mockEvent:', mockEvent);
      
      const html = `
        <div class="event-edit-modal-v2-overlay" onclick="closeModal(event)">
          <div class="event-edit-modal-v2 ${isDetailView ? 'detail-view' : 'compact-view'}" onclick="event.stopPropagation()">
            <div class="modal-content">
            <!-- å·¦ä¾§ï¼šEvent Overview -->
            <div class="event-overview">
              <!-- ä¸Š Section - äº‹ä»¶æ ‡è¯†åŒº -->
              <div class="section-identity">
                <!-- Emoji (å¤§å›¾æ ‡) -->
                <div class="emoji-large" onclick="openEmojiPicker()">${getDisplayEmoji(formData)}</div>

                <!-- Checkbox + æ ‡é¢˜è¡Œ -->
                <div class="title-checkbox-row">
                  <div class="custom-checkbox ${formData.isTask ? 'checked' : ''}" 
                       onclick="this.classList.toggle('checked'); handleTaskCheckboxChange(this.classList.contains('checked'))"></div>
                  <input type="text" 
                         class="title-input" 
                         value="${formData.title}"
                         placeholder="${getTitlePlaceholder(formData.tags)}"
                         oninput="handleTitleChange(this.value)">
                </div>

                <!-- æ ‡ç­¾è¡Œ -->
                <div class="tags-row" onclick="openTagPicker()">
                  ${formData.tags.map((tagId, index) => {
                    const tag = mockTags[tagId];
                    if (!tag) return '';
                    const separator = index > 0 ? '<span class="tag-separator">/</span>' : '';
                    return `${separator}<span class="tag-chip">${tag.emoji || ''}${tag.name}</span>`;
                  }).join('')}
                  ${formData.tags.length > 2 ? '<span class="tag-etc">ç­‰</span>' : ''}
                </div>
              </div>

              <!-- Timer æŒ‰é’® -->
              <button class="timer-button-start">
                <img src="../src/assets/icons/timer_start.svg" alt="">
                å¼€å§‹ä¸“æ³¨
              </button>

              <!-- ä¸­ Section - è®¡åˆ’å®‰æ’ -->
              <div class="section-header">
                <div class="section-header-title">è®¡åˆ’å®‰æ’</div>
                <div class="section-header-buttons">
                  <button class="header-text-btn">æ¯å‘¨</button>
                  <button class="header-icon-btn">
                    <img src="../src/assets/icons/rotation_color.svg" alt="">
                  </button>
                  <button class="header-icon-btn">
                    <img src="../src/assets/icons/Add_task_color.svg" alt="">
                  </button>
                  <button class="header-icon-btn">
                    <img src="../src/assets/icons/ddl_add.svg" alt="">
                  </button>
                </div>
              </div>
              
              <!-- ç»„ç»‡è€…å’Œå‚ä¸è€… -->
              <div class="plan-row">
                <img src="../src/assets/icons/Attendee.svg" alt="" class="plan-icon">
                <div class="plan-content">Zoey Gong; Jenny Wong; Cindy Cai</div>
              </div>

              <!-- æ—¶é—´æ˜¾ç¤º -->
              <div class="plan-row">
                <img src="../src/assets/icons/datetime.svg" alt="" class="plan-icon">
                <div class="plan-content" style="display: flex; align-items: center; gap: 4px;">
                  <span>2025-10-18 (å‘¨å…­) 10:00</span>
                  <div class="time-arrow-section">
                    <span class="duration-text">2h30min</span>
                    <img src="../src/assets/icons/Arrow_blue.svg" alt="" class="arrow-icon">
                  </div>
                  <span>12:00</span>
                </div>
              </div>

              <!-- åœ°ç‚¹ -->
              <div class="plan-row">
                <img src="../src/assets/icons/Location.svg" alt="" class="plan-icon">
                <div class="plan-content">é™å®‰å˜‰é‡Œä¸­å¿ƒ2Fç¯çƒ, RMå·¥ä½œå®¤, 5å·ä¼šè®®å®¤</div>
              </div>

              <!-- æ—¥å†æ¥æºå’ŒåŒæ­¥æ¨¡å¼ -->
              <div class="plan-row" style="margin-top: 4px;">
                <span style="flex-shrink: 0; color: #6b7280;">æ¥è‡ª</span>
                <div class="plan-content" style="display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="display: inline-flex; align-items: center; gap: 4px;">
                      <span style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></span>
                      <strong style="color: #1f2937;">Outlook</strong>
                    </span>
                    <span style="color: #6b7280;">: é»˜è®¤</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 6px; color: #6b7280; font-size: 13px;">
                    <span>ğŸ“¥</span>
                    <span>åªæ¥æ”¶åŒæ­¥</span>
                  </div>
                </div>
              </div>

              <!-- ä¸‹ Section - å®é™…è¿›å±• -->
              <div class="section-header" style="margin-top: 20px;">
                <div class="section-header-title">å®é™…è¿›å±•</div>
                <span class="total-duration">æ€»æ—¶é•¿: 3å°æ—¶</span>
              </div>

              <!-- å®é™…è¿›å±•æ»šåŠ¨å®¹å™¨ -->
              <div class="progress-section-wrapper">
                <!-- æ—¶é—´ç‰‡æ®µåˆ—è¡¨ -->
                <div class="timer-segments-list">
                <!-- ç‰‡æ®µ 1 -->
                <div class="timer-segment">
                  <img src="../src/assets/icons/timer_check.svg" alt="" class="timer-check-icon">
                  <span>2025-10-18 (å‘¨å…­) 10:00</span>
                  <div class="time-arrow-section">
                    <span class="duration-text">2h30min</span>
                    <img src="../src/assets/icons/Arrow_blue.svg" alt="" class="arrow-icon">
                  </div>
                  <span>12:00</span>
                </div>
                
                <!-- ç‰‡æ®µ 2 (è·¨å¤©) -->
                <div class="timer-segment">
                  <img src="../src/assets/icons/timer_check.svg" alt="" class="timer-check-icon">
                  <span>2025-10-18 (å‘¨å…­) 23:00</span>
                  <div class="time-arrow-section">
                    <span class="duration-text">2h</span>
                    <img src="../src/assets/icons/Arrow_blue.svg" alt="" class="arrow-icon">
                  </div>
                  <span>01:00<sup style="color: #3b82f6; font-size: 10px; margin-left: 2px;">+1</sup></span>
                </div>
              </div>

              <!-- åŒæ­¥çŠ¶æ€ -->
              <div class="plan-row" style="margin-top: 12px;">
                <span style="flex-shrink: 0; color: #6b7280;">åŒæ­¥</span>
                <div class="plan-content" style="display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="display: inline-flex; align-items: center; gap: 4px;">
                      <span style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></span>
                      <strong style="color: #1f2937;">Outlook</strong>
                    </span>
                    <span style="color: #6b7280;">: å·¥ä½œç­‰</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 6px; color: #6b7280; font-size: 13px;">
                    <span>ğŸ”„</span>
                    <span>åŒå‘åŒæ­¥</span>
                  </div>
                </div>
              </div>

              <!-- ddlå®ŒæˆçŠ¶æ€ -->
              <div class="ddl-completion">
                <img src="../src/assets/icons/ddl_checked.svg" alt="">
                <span>ddlæå‰3hå®Œæˆäº2025-10-19 13:16</span>
              </div>
              </div>
              <!-- ç»“æŸå®é™…è¿›å±•æ»šåŠ¨å®¹å™¨ -->

              ${!isDetailView ? `
                <div style="display: flex; justify-content: space-between; padding: 16px 0 0 0; margin-top: auto;">
                  <button class="footer-btn footer-btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                  <button class="footer-btn" style="color: #3b82f6; font-weight: 600;" onclick="toggleView()">ğŸ“ å±•å¼€æ—¥å¿—</button>
                  <button class="footer-btn footer-btn-save">ä¿å­˜</button>
                </div>
              ` : ''}
            </div>

            ${isDetailView ? `
              <!-- å³ä¾§ï¼šEvent Log -->
              <div class="event-log">
                <button class="back-button" onclick="toggleView()">â† back</button>
                
                <!-- æ ‡ç­¾åŒºåŸŸ -->
                <div class="tags-area">
                  <span class="tag-mention tag-work">#ğŸ”—å·¥ä½œ/#ğŸ“æ–‡æ¡£ç¼–è¾‘</span>
                  <span class="tag-mention tag-client">#ğŸ“®é‡ç‚¹å®¢æˆ·/#ğŸ“®è…¾è®¯</span>
                </div>

                <!-- Plan æç¤ºåŒºåŸŸ -->
                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6b7280; margin-bottom: 12px; line-height: 26px;">
                  <img src="../src/assets/icons/task_gray.svg" style="width: 16px; height: 16px;" alt="">
                  <img src="../src/assets/icons/ddl_warn.svg" style="width: 20px; height: 20px;" alt="">
                  <span>åˆ›å»ºäº 12hå‰ï¼Œddl è¿˜æœ‰ 2h30min</span>
                </div>

                <!-- å…³è”åŒºåŸŸ -->
                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6b7280; margin-bottom: 16px; line-height: 26px;">
                  <img src="../src/assets/icons/link_color.svg" style="width: 20px; height: 20px;" alt="">
                  <span>ä¸Šçº§ä»»åŠ¡ï¼šProject Ace (5/7)</span>
                </div>

                <!-- Slate ç¼–è¾‘åŒº -->
                <div style="flex: 1; background: white; display: flex; flex-direction: column;">
                  
                  <!-- ç¬¬ä¸€æ¡æ—¥å¿— -->
                  <div style="position: relative; padding-left: 8px; margin-bottom: 24px;">
                    <!-- å·¦ä¾§ç«–çº¿ -->
                    <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: #e5e7eb;"></div>
                    
                    <!-- æ—¶é—´æˆ³ -->
                    <p style="font-size: 16px; color: #e5e7eb; line-height: 1; margin: 0 0 8px 0; padding: 0; font-family: 'Microsoft YaHei', Arial;">
                      2025-10-19 10:21:18
                    </p>

                    <p style="color: #6b7280; font-size: 14px; line-height: 1.6; margin: 0; font-family: 'Inter', 'Microsoft YaHei', Arial;">
                      å¤„ç†å®Œäº†ä¸€äº›å‡ºå·®çš„logisticsï¼Œè¿˜æœ‰æŠ¥é”€æ•´ç†ï¼Œç°åœ¨ç»ˆäºå¯ä»¥å¼€å¹²äº†ï¼<br>
                      å‡†å¤‡å…ˆä¸€ä¸ªæçº²ä¸¢ç»™GPTï¼Œçœ‹çœ‹æƒ…å†µ
                    </p>
                  </div>

                  <!-- ç¬¬äºŒæ¡æ—¥å¿— -->
                  <div style="position: relative; padding-left: 8px; margin-bottom: 24px;">
                    <!-- å·¦ä¾§ç«–çº¿ -->
                    <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: #e5e7eb;"></div>
                    
                    <!-- æ—¶é—´æˆ³ -->
                    <p style="font-size: 16px; color: #e5e7eb; line-height: 1; margin: 0 0 8px 0; padding: 0; font-family: 'Microsoft YaHei', Arial;">
                      2025-10-19 10:35:18 | 16min later
                    </p>

                    <p style="color: #6b7280; font-size: 14px; line-height: 1.6; margin: 0; font-family: 'Inter', 'Microsoft YaHei', Arial;">
                      å¤ªå¼ºäº†ï¼å±…ç„¶ç›´æ¥æˆç¨¿äº†ï¼Œé‚£ç°åœ¨å°±åªè¦åšäº›æ£€æŸ¥äº†<br>
                      æ„Ÿè§‰ä¸»è¦æ˜¯ä¸€äº›æµç¨‹å’Œé€»è¾‘é”™è¯¯ï¼Œè¯­è¨€ä¸Šæ²¡æœ‰å¤ªå¤šå¯ä»¥ä¿®ç¼®çš„ï¼Œæ–‡é‡‡æ¯”æˆ‘å¥½å¤ªå¤šäº†QUQ
                    </p>
                  </div>

                  <!-- ç¬¬ä¸‰æ¡æ—¥å¿— -->
                  <div style="position: relative; padding-left: 8px; margin-bottom: 24px;">
                    <!-- å·¦ä¾§ç«–çº¿ -->
                    <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: #e5e7eb;"></div>
                    
                    <!-- æ—¶é—´æˆ³ -->
                    <p style="font-size: 16px; color: #e5e7eb; line-height: 1; margin: 0 0 8px 0; padding: 0; font-family: 'Microsoft YaHei', Arial;">
                      2025-10-19 10:35:18 | 16min later
                    </p>

                    <!-- å¯ç¼–è¾‘åŒºåŸŸæç¤ºæ–‡å­— -->
                    <p style="color: #9ca3af; font-size: 14px; line-height: 1.6; margin: 0; font-family: 'Inter', 'Microsoft YaHei', Arial;">
                      åŒå‡»"Alt"å¬å”¤è¡¨æƒ…ã€æ ¼å¼ç­‰ï¼Œç‚¹å‡»å³ä¸‹æ–¹é—®å·æµ®çª—æŸ¥çœ‹æ›´å¤šé«˜æ•ˆå¿«æ·é”®å“¦
                    </p>
                  </div>

                  <!-- FloatingBar ç»„ä»¶å°†åœ¨è¿™é‡Œå¼•å…¥ -->
                </div>
              </div>
            ` : ''}
          </div>

          ${isDetailView ? `
          <!-- åº•éƒ¨æŒ‰é’®ï¼ˆæ•´ä¸ªæ¨¡æ€æ¡†åº•éƒ¨ï¼‰ -->
          <div class="detail-footer">
            <button class="footer-btn footer-btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="footer-btn footer-btn-save">ä¿å­˜</button>
          </div>
          ` : ''}
          </div>
        </div>
      `;

      container.innerHTML = html;
      
      // åˆå§‹åŒ–æ‰€æœ‰ title-input çš„è‡ªé€‚åº”å®½åº¦
      setTimeout(() => {
        document.querySelectorAll('.title-input').forEach(input => {
          autoResizeInput(input);
        });
      }, 0);
    }

    function closeModal(event) {
      if (event) {
        event.stopPropagation();
      }
      document.getElementById('modalContainer').innerHTML = '';
    }

    function toggleView() {
      const modal = document.querySelector('.event-edit-modal-v2');
      if (!modal) return;

      const isDetailView = modal.classList.contains('detail-view');
      closeModal();
      setTimeout(() => showModal(!isDetailView), 100);
    }

    // ESC é”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // è‡ªé€‚åº” input å®½åº¦
    function autoResizeInput(input) {
      const span = document.createElement('span');
      span.style.visibility = 'hidden';
      span.style.position = 'absolute';
      span.style.whiteSpace = 'pre';
      span.style.font = window.getComputedStyle(input).font;
      span.textContent = input.value || input.placeholder || '';
      document.body.appendChild(span);
      input.style.width = (span.offsetWidth + 10) + 'px';
      document.body.removeChild(span);
    }

    // ç›‘å¬æ‰€æœ‰ title-input çš„è¾“å…¥äº‹ä»¶
    document.addEventListener('input', (e) => {
      if (e.target.classList.contains('title-input')) {
        autoResizeInput(e.target);
      }
    });

    // é¡µé¢åŠ è½½ååˆå§‹åŒ–æ‰€æœ‰ title-input çš„å®½åº¦
    window.addEventListener('load', () => {
      document.querySelectorAll('.title-input').forEach(input => {
        autoResizeInput(input);
      });
    });
  </script>
</body>
</html>
