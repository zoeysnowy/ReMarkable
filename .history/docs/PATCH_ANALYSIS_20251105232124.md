# ReMarkable Calendar è¡¥ä¸åˆ†ææŠ¥å‘Š

## ğŸ“Š è¡¥ä¸å±‚çº§æ¶æ„

```
æœ¬åœ° TUI æºç  (src/lib/tui.calendar/)
    â†“
Calendar ç»„ä»¶ (src/components/TimeCalendar.tsx + src/styles/calendar.css)
    â†“
Desktop Widget (src/pages/DesktopCalendarWidget.tsx + src/components/DesktopCalendarWidget.css)
```

---

## ğŸ¯ ç¬¬ä¸€å±‚ï¼šTUI Calendar æºç å±‚ä¿®æ”¹ï¼ˆåº”è¯¥åœ¨æºç ä¸­å®Œæˆï¼‰

### âœ… å·²ä¿®æ”¹ï¼ˆStep 1 å®Œæˆï¼‰
| æ–‡ä»¶ | å¸¸é‡ | åŸå€¼ | æ–°å€¼ | ä½œç”¨åŸŸ |
|------|------|------|------|--------|
| `apps/calendar/src/constants/style.ts` | `MONTH_EVENT_HEIGHT` | 24 | **17** | æœˆè§†å›¾äº‹ä»¶é«˜åº¦ |
| `apps/calendar/src/constants/style.ts` | `WEEK_EVENT_HEIGHT` | 24 | **17** | å‘¨è§†å›¾äº‹ä»¶é«˜åº¦ |
| `apps/calendar/src/helpers/grid.ts` | `EVENT_HEIGHT` | 22 | **17** | æ¨ªå‘äº‹ä»¶é«˜åº¦ |

### ğŸ” å¾…è¯„ä¼°ï¼ˆéœ€è¦æºç å±‚é¢ä¿®æ”¹çš„é€šç”¨ä¼˜åŒ–ï¼‰

#### 1. **å¸ƒå±€å“åº”å¼æ”¹è¿›**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**ä½ç½®**: `calendar.css` L487-620
- âŒ **ä¸é€‚åˆæºç **ï¼šè¿™äº›æ˜¯ Flexbox å¸ƒå±€è¦†ç›–ï¼Œå±äº ReMarkable ç‰¹å®šéœ€æ±‚
- âœ… **ä¿ç•™åœ¨ calendar.css**ï¼šå‘¨/æ—¥è§†å›¾ flex å¸ƒå±€ã€æœˆè§†å›¾ grid å¸ƒå±€

**ç†ç”±**: TUI Calendar é»˜è®¤å¸ƒå±€å¯èƒ½é€‚é…å…¶ä»–ç”¨æˆ·åœºæ™¯ï¼ŒReMarkable çš„å“åº”å¼éœ€æ±‚æ˜¯ç‰¹å®šçš„ã€‚

#### 2. **å­—ä½“è®¾ç½®**ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
**ä½ç½®**: `calendar.css` L38
```css
.toastui-calendar, .toastui-calendar * {
  font-family: "Microsoft YaHei", Arial, sans-serif !important;
}
```
- âŒ **ä¸é€‚åˆæºç **ï¼šä¸­æ–‡å­—ä½“ä¼˜åŒ–æ˜¯ ReMarkable ç‰¹å®šéœ€æ±‚
- âœ… **ä¿ç•™åœ¨ calendar.css**ï¼šç»§ç»­ç”¨ CSS è¦†ç›–

#### 3. **ä¸»é¢˜è‰²ç³»ç»Ÿ**ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰
**ä½ç½®**: `calendar.css` L17-32ï¼ˆCSS å˜é‡ï¼‰
- âŒ **ä¸é€‚åˆæºç **ï¼šReMarkable å“ç‰Œè‰²ï¼ˆç´«è“æ¸å˜ï¼‰
- âœ… **ä¿ç•™åœ¨ calendar.css**ï¼šCSS å˜é‡æ˜¯æœ€ä½³å®è·µ

---

## ğŸ¨ ç¬¬äºŒå±‚ï¼šCalendar ç»„ä»¶å±‚è¡¥ä¸ï¼ˆä¿ç•™åœ¨ calendar.css + TimeCalendar.tsxï¼‰

### A. CSS æ ·å¼è¡¥ä¸ï¼ˆ`calendar.css`ï¼‰

#### âœ… åº”ä¿ç•™çš„é€šç”¨ä¼˜åŒ–ï¼ˆé€‚ç”¨äºä¸»åº”ç”¨å’Œ Widgetï¼‰

| ç±»åˆ« | é€‰æ‹©å™¨ | ä½œç”¨ | è¡Œå· | çŠ¶æ€ |
|------|--------|------|------|------|
| **å“åº”å¼å¸ƒå±€** | `.toastui-calendar-layout` | Flexbox è‡ªé€‚åº” | L487-620 | âœ… ä¿ç•™ |
| **äº‹ä»¶æ ·å¼** | `.toastui-calendar-event` | å‚ç›´å±…ä¸­ã€flex å¸ƒå±€ | L175-178 | âœ… ä¿ç•™ |
| **Task æ ·å¼** | `.remarkable-task-*` | ç´§å‡‘å¸ƒå±€ã€checkbox | L814-927 | âœ… ä¿ç•™ |
| **æ»šåŠ¨æ¡ä¼˜åŒ–** | `.toastui-calendar-panel.toastui-calendar-time::-webkit-scrollbar` | 30% é€æ˜åº¦ | L451-458 | âœ… ä¿ç•™ |
| **Grid å¸ƒå±€** | `.toastui-calendar-day-name-container` | Grid 7åˆ—å¹³å‡åˆ†é… | L533-539 | âœ… ä¿ç•™ |

#### ğŸ”§ éœ€è¦æ¸…ç†çš„é‡å¤ !important

**é—®é¢˜**: `calendar.css` ä¸­æœ‰å¤§é‡ `!important` è¦†ç›– TUI é»˜è®¤æ ·å¼ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
1. æ„å»ºæœ¬åœ° TUI åï¼Œç§»é™¤æºç ä¸­å·²ä¿®å¤çš„ `!important`
2. ä¿ç•™å¿…è¦çš„ä¸šåŠ¡é€»è¾‘ `!important`ï¼ˆå¦‚ Widget ç‰¹å®šæ ·å¼ï¼‰

**é¢„è®¡å¯ç§»é™¤çš„ !important**:
- âœ… äº‹ä»¶é«˜åº¦ç›¸å…³ï¼ˆå·²åœ¨æºç ä¿®æ”¹ï¼‰
- âœ… å¸ƒå±€ flexbox/gridï¼ˆå¦‚æœæºç æ”¯æŒå¯é…ç½®ï¼‰
- âŒ å­—ä½“ã€é¢œè‰²ã€ä¸»é¢˜ï¼ˆReMarkable ç‰¹å®šï¼Œéœ€ä¿ç•™ï¼‰

### B. JavaScript è¿è¡Œæ—¶è¡¥ä¸ï¼ˆ`TimeCalendar.tsx`ï¼‰

#### âŒ åº”ç§»é™¤çš„æ€§èƒ½æŸè€—è¡¥ä¸

| è¡¥ä¸ç±»å‹ | ä½ç½® | æ€§èƒ½å½±å“ | ç§»é™¤æ¡ä»¶ |
|---------|------|----------|----------|
| **MutationObserver** | L1156-1245 | ğŸ”´ é«˜ï¼ˆæ¯æ¬¡ DOM å˜åŒ–è§¦å‘ï¼‰ | âœ… æºç ä¿®æ”¹å®Œæˆåç«‹å³ç§»é™¤ |
| **åŠ¨æ€æ ·å¼æ³¨å…¥** | L700-750 | ğŸŸ¡ ä¸­ï¼ˆåˆå§‹åŒ–æ—¶æ‰§è¡Œï¼‰ | âœ… æ”¹ç”¨é™æ€ CSS |
| **å®šæ—¶å™¨è½®è¯¢** | L1414-1428 | ğŸŸ¡ ä¸­ï¼ˆæ¯ç§’è§¦å‘ï¼‰ | âŒ ä¿ç•™ï¼ˆå®æ—¶ Timer æ˜¾ç¤ºå¿…é¡»ï¼‰ |

**å…³é”®å‘ç°**: MutationObserver ä»£ç ï¼ˆL1156-1245ï¼‰**å¿…é¡»ç§»é™¤**ï¼
- æ¯æ¬¡ DOM å˜åŒ–éƒ½è§¦å‘ `forceTaskEventHeight()`
- é€’å½’ä¿®æ”¹ `top` å±æ€§å¯¹æŠ—æºç è®¡ç®—
- å·²åœ¨æºç ä¿®æ”¹å¸¸é‡ï¼Œæ— éœ€è¿è¡Œæ—¶æ‰“è¡¥ä¸

#### âœ… åº”ä¿ç•™çš„ä¸šåŠ¡é€»è¾‘

| åŠŸèƒ½ | ä½ç½® | ä¿ç•™ç†ç”± |
|------|------|----------|
| å®æ—¶ Timer äº‹ä»¶ç”Ÿæˆ | L1346-1540 | æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ |
| äº‹ä»¶è¿‡æ»¤ç³»ç»Ÿ | L1368-1538 | ä¸šåŠ¡è§„åˆ™ |
| CRUD æ“ä½œå¤„ç† | L1592-1820 | ä¸šåŠ¡é€»è¾‘ |
| åŒæ•°æ®æºç­–ç•¥ | L1252-1365 | Widget æ¶æ„éœ€æ±‚ |

---

## ğŸ–¥ï¸ ç¬¬ä¸‰å±‚ï¼šDesktop Widget å±‚è¡¥ä¸ï¼ˆä¿ç•™åœ¨ DesktopCalendarWidget.cssï¼‰

### Widget ç‰¹å®šæ ·å¼ï¼ˆ**ä¸åº”æ”¾å…¥æºç æˆ– Calendar å±‚**ï¼‰

| ç±»åˆ« | é€‰æ‹©å™¨ | ä½œç”¨ | ç†ç”± |
|------|--------|------|------|
| **é€æ˜åº¦é€‚é…** | `.desktop-calendar-inner .toastui-calendar` | é€æ˜èƒŒæ™¯ | Widget ç‰¹å®š |
| **è‡ªé€‚åº”é¢œè‰²** | `--adaptive-text-primary` | æ ¹æ®èƒŒæ™¯è‡ªåŠ¨è°ƒæ•´æ–‡å­—é¢œè‰² | Widget ç‰¹å®š |
| **æ‹–åŠ¨/Resize** | `.resize-handle`, `.drag-bar` | Electron çª—å£æ§åˆ¶ | Widget ç‰¹å®š |
| **æ»šåŠ¨æ¡éšè—** | `.desktop-calendar-widget ::-webkit-scrollbar` | éšè—æ»šåŠ¨æ¡ | Widget ç¾è§‚éœ€æ±‚ |

**å…³é”®åŸåˆ™**: Widget å±‚çš„æ ·å¼**ç»å¯¹ä¸èƒ½**æ”¾å…¥ TUI æºç æˆ– calendar.cssï¼Œå¦åˆ™ä¼šå½±å“ä¸»åº”ç”¨ã€‚

---

## ğŸ“‹ è¿ç§»è®¡åˆ’

### Phase 1: æºç ä¿®æ”¹ï¼ˆâœ… å·²å®Œæˆï¼‰
- [x] ä¿®æ”¹ 3 ä¸ªé«˜åº¦å¸¸é‡ï¼ˆ24â†’17, 22â†’17ï¼‰

### Phase 2: æ„å»ºæœ¬åœ° TUI Calendar
- [ ] é…ç½® package.json æŒ‡å‘æœ¬åœ°æ„å»º
- [ ] æ‰§è¡Œæ„å»ºå‘½ä»¤
- [ ] éªŒè¯æ„å»ºè¾“å‡º

### Phase 3: æ¸…ç†è¿è¡Œæ—¶è¡¥ä¸ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
- [ ] **ç§»é™¤ MutationObserver**ï¼ˆL1156-1245ï¼‰- ğŸ”´ æ€§èƒ½å…³é”®
- [ ] ç§»é™¤åŠ¨æ€æ ·å¼æ³¨å…¥ï¼ˆL700-750ï¼‰
- [ ] éªŒè¯ Task äº‹ä»¶é—´è·æ­£ç¡®ï¼ˆ17pxï¼‰

### Phase 4: ä¼˜åŒ– CSS è¡¥ä¸ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
- [ ] å®¡è®¡æ‰€æœ‰ `!important`ï¼Œç§»é™¤æºç å·²ä¿®å¤çš„
- [ ] å°† calendar.css æ‹†åˆ†ä¸ºï¼š
  - `calendar-base.css`ï¼ˆé€šç”¨ä¼˜åŒ–ï¼‰
  - `calendar-theme.css`ï¼ˆReMarkable ä¸»é¢˜ï¼‰
  - `calendar-widget.css`ï¼ˆWidget ç‰¹å®šï¼‰ - ç§»è‡³ DesktopCalendarWidget.css

### Phase 5: æ€§èƒ½æµ‹è¯•
- [ ] ä¸»åº”ç”¨æ¸²æŸ“æ€§èƒ½ï¼ˆFPSã€å†…å­˜ï¼‰
- [ ] Desktop Widget æ¸²æŸ“æ€§èƒ½
- [ ] å¯¹æ¯” MutationObserver ç§»é™¤å‰åçš„æ€§èƒ½æŒ‡æ ‡

---

## ğŸ¯ æ€§èƒ½æå‡é¢„æœŸ

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| åˆå§‹æ¸²æŸ“æ—¶é—´ | ~500ms | ~200ms | **60%** |
| DOM å˜åŒ–å“åº” | ~100ms (MutationObserver) | ~16ms | **84%** |
| å†…å­˜å ç”¨ | é«˜ï¼ˆObserver æŒç»­ç›‘å¬ï¼‰ | ä½ï¼ˆé™æ€æ ·å¼ï¼‰ | **æ˜¾è‘—é™ä½** |
| FPSï¼ˆæ‹–æ‹½ Widgetï¼‰ | ~30 FPS | ~60 FPS | **100%** |

---

## âš ï¸ é£é™©æç¤º

### 1. npm install è¦†ç›–é£é™©
**é—®é¢˜**: `npm install` ä¼šè¦†ç›– `node_modules/@toast-ui/calendar/dist/` çš„ä¿®æ”¹

**è§£å†³æ–¹æ¡ˆï¼ˆäºŒé€‰ä¸€ï¼‰**:
- **æ–¹æ¡ˆ A**: ä½¿ç”¨ `patch-package` è‡ªåŠ¨åŒ–è¡¥ä¸ï¼ˆæ¨èï¼‰
- **æ–¹æ¡ˆ B**: å®Œå…¨è¿ç§»åˆ°æœ¬åœ°æ„å»ºï¼Œä¸ä½¿ç”¨ npm åŒ…

### 2. æ„å»ºé…ç½®å¤æ‚åº¦
**é£é™©**: TUI Calendar æºç æ„å»ºå¯èƒ½éœ€è¦ç‰¹å®šç¯å¢ƒå’Œä¾èµ–

**ç¼“è§£æªæ–½**:
- å…ˆåœ¨ `src/lib/tui.calendar/` æµ‹è¯•æ„å»º
- è®°å½•å®Œæ•´æ„å»ºæ­¥éª¤
- ä¿ç•™ npm åŒ…ä½œä¸º fallback

### 3. Widget æ ·å¼éš”ç¦»
**é£é™©**: ä¿®æ”¹æºç å¯èƒ½å½±å“ä¸»åº”ç”¨æ ·å¼

**ç¼“è§£æªæ–½**:
- Widget ç‰¹å®šæ ·å¼**ä¸¥æ ¼ä¿ç•™åœ¨** `DesktopCalendarWidget.css`
- ä½¿ç”¨ `.desktop-calendar-inner` å‰ç¼€éš”ç¦»
- å……åˆ†æµ‹è¯•ä¸»åº”ç”¨å’Œ Widget åŒç¯å¢ƒ

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³è¡ŒåŠ¨**ï¼ˆæ€§èƒ½å…³é”®ï¼‰:
1. âœ… æ„å»ºæœ¬åœ° TUI Calendar
2. âœ… é…ç½®é¡¹ç›®ä½¿ç”¨æœ¬åœ°æ„å»º
3. âœ… ç§»é™¤ MutationObserver è¡¥ä¸
4. âœ… æµ‹è¯•éªŒè¯

**åç»­ä¼˜åŒ–**ï¼ˆå¯æŒ‰éœ€è¿›è¡Œï¼‰:
5. æ¸…ç† CSS `!important`
6. æ‹†åˆ† calendar.css
7. æ€§èƒ½åŸºå‡†æµ‹è¯•

---

**æ€»ç»“**: é€šè¿‡è¿ç§»åˆ°æœ¬åœ° TUI æºç ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š
- âœ… æ¶ˆé™¤è¿è¡Œæ—¶ DOM æ“ä½œè¡¥ä¸ï¼ˆMutationObserverï¼‰
- âœ… å‡å°‘ 80%+ çš„ CSS `!important` è¦†ç›–
- âœ… æå‡ 60% ä»¥ä¸Šçš„æ¸²æŸ“æ€§èƒ½
- âœ… é™ä½ç»´æŠ¤æˆæœ¬ï¼Œä»£ç æ›´æ¸…æ™°

**å…³é”®åŸåˆ™**: æºç  â†’ Calendar â†’ Widget ä¸‰å±‚æ¶æ„ï¼Œæ¯å±‚åªå¤„ç†è‡ªå·±çš„èŒè´£ï¼Œä¸¥æ ¼éš”ç¦»ã€‚
