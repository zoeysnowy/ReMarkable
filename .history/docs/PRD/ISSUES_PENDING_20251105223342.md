# ReMarkable PRD å¾…å¤„ç†é—®é¢˜æ¸…å•

> **åˆ›å»ºæ—¶é—´**: 2025-11-05  
> **çŠ¶æ€**: å¾… Cross-check å®Œæˆåç»Ÿä¸€å¤„ç†  
> **æ¥æº**: EventEditModal PRD ç¼–å†™è¿‡ç¨‹ä¸­å‘ç°çš„æ¶æ„ä¸ä½“éªŒæ”¹è¿›ç‚¹

---

## ğŸ“‹ é—®é¢˜åˆ†ç±»

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“åŠŸèƒ½æ­£ç¡®æ€§ï¼‰

#### Issue #1: EventHub.createEvent è¿”å›å€¼ä¸æ˜ç¡®

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 8.2

**é—®é¢˜æè¿°**:
- å½“å‰å®ç°ï¼š`EventEditModal.handleSave()` è°ƒç”¨ `await EventHub.createEvent(newEvent)` åï¼Œé€šè¿‡ `EventHub.getSnapshot(event.id)` æŸ¥è¯¢åˆ›å»ºç»“æœ
- é£é™©ï¼šå¦‚æœ `event.id` æ˜¯ä¸´æ—¶ IDï¼ˆ`temp-...`ï¼‰æˆ– EventHub å†…éƒ¨ç”Ÿæˆæ–° UUIDï¼Œç›´æ¥ç”¨åŸ ID æŸ¥è¯¢å¯èƒ½å¤±è´¥æˆ–è¿”å›é”™è¯¯å¯¹è±¡

**å»ºè®®æ–¹æ¡ˆ**:
```typescript
// ä¿®æ”¹å‰ï¼ˆEventHub.tsï¼‰
export const EventHub = {
  createEvent: async (eventData: Event) => {
    // ... åˆ›å»ºé€»è¾‘
    // æ— è¿”å›å€¼æˆ–è¿”å› void
  }
};

// ä¿®æ”¹å
export const EventHub = {
  createEvent: async (eventData: Event): Promise<Event> => {
    const createdEvent = await EventService.createEvent(eventData);
    return createdEvent; // è¿”å›å®Œæ•´çš„åˆ›å»ºåäº‹ä»¶ï¼ˆå«æœ€ç»ˆ IDï¼‰
  }
};

// EventEditModal.tsx è°ƒç”¨å¤„ä¿®æ”¹
const createdEvent = await EventHub.createEvent(newEvent);
onSave(createdEvent); // ç›´æ¥ä½¿ç”¨è¿”å›å€¼ï¼Œä¸å†ç”¨ getSnapshot
```

**å½±å“èŒƒå›´**:
- `src/services/EventHub.ts`
- `src/components/EventEditModal.tsx` (L322-345)
- å¯èƒ½å½±å“å…¶ä»–è°ƒç”¨ `EventHub.createEvent` çš„æ¨¡å—

**éªŒè¯æ–¹æ³•**:
1. åˆ›å»ºæ–°äº‹ä»¶ï¼ˆä¸´æ—¶ ID åœºæ™¯ï¼‰
2. ç¡®è®¤ `onSave` å›è°ƒæ”¶åˆ°çš„äº‹ä»¶å¯¹è±¡åŒ…å«æ­£ç¡®çš„æœ€ç»ˆ ID
3. æ£€æŸ¥ localStorage ä¸­äº‹ä»¶æ•°æ®ä¸€è‡´æ€§

---

#### Issue #2: syncStatus æšä¸¾å€¼ç¡¬ç¼–ç 

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 8.3

**é—®é¢˜æè¿°**:
- ä»£ç ä¸­ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡åˆ¤æ–­åŒæ­¥çŠ¶æ€ï¼š`event.syncStatus === 'local-only'`
- ç¼ºå°‘ç»Ÿä¸€çš„æšä¸¾å®šä¹‰ï¼Œå®¹æ˜“æ‹¼å†™é”™è¯¯ï¼Œä¸åŒæ¨¡å—å¯èƒ½ä½¿ç”¨ä¸åŒå€¼

**å»ºè®®æ–¹æ¡ˆ**:
```typescript
// æ–°å¢æ–‡ä»¶ï¼šsrc/types/syncStatus.ts
export enum SyncStatus {
  LOCAL_ONLY = 'local-only',   // è¿è¡Œä¸­ Timer æˆ–æœ¬åœ°è‰ç¨¿
  PENDING = 'pending',          // ç­‰å¾…åŒæ­¥
  SYNCED = 'synced',            // å·²åŒæ­¥åˆ° Outlook
  SYNC_ERROR = 'sync-error'     // åŒæ­¥å¤±è´¥
}

// å·¥å…·å‡½æ•°
export const isRunningTimer = (event: Event): boolean => {
  return event.syncStatus === SyncStatus.LOCAL_ONLY;
};

// EventEditModal.tsx ä½¿ç”¨
import { SyncStatus, isRunningTimer } from '../types/syncStatus';

const shouldSkipSync = isRunningTimer(event);
```

**å½±å“èŒƒå›´**:
- `src/types.ts` (æ·»åŠ  SyncStatus ç±»å‹å®šä¹‰)
- `src/components/EventEditModal.tsx` (L357)
- `src/components/Timer.tsx`
- `src/services/ActionBasedSyncManager.ts`

**éªŒè¯æ–¹æ³•**:
1. æœç´¢æ‰€æœ‰ `syncStatus` ç›¸å…³ä»£ç 
2. ç»Ÿä¸€æ›¿æ¢ä¸ºæšä¸¾å€¼
3. TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå½±å“ç”¨æˆ·ä½“éªŒï¼‰

#### Issue #3: onStartTimeChange å›è°ƒé«˜é¢‘è°ƒç”¨

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 9.2

**é—®é¢˜æè¿°**:
- ç”¨æˆ·åœ¨å¼€å§‹æ—¶é—´æ§ä»¶å¿«é€Ÿè¾“å…¥æ—¶ï¼Œ`onStartTimeChange(newStartTime)` è¢«é«˜é¢‘è°ƒç”¨
- å¦‚æœå›è°ƒæ¶‰åŠæŒä¹…åŒ–æˆ–å¤æ‚è®¡ç®—ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜

**å»ºè®®æ–¹æ¡ˆ**:
```typescript
// EventEditModal.tsx
import { debounce } from 'lodash'; // æˆ–è‡ªå®ç°

const debouncedStartTimeChange = useMemo(
  () => onStartTimeChange 
    ? debounce((time: number) => onStartTimeChange(time), 300)
    : undefined,
  [onStartTimeChange]
);

const handleStartTimeEdit = (newStartTimeStr: string) => {
  setFormData({ ...formData, startTime: newStartTimeStr });
  
  if (debouncedStartTimeChange && globalTimer) {
    // ... è§£ææ—¶é—´
    debouncedStartTimeChange(newStartTime);
  }
};
```

**å½±å“èŒƒå›´**:
- `src/components/EventEditModal.tsx` (L447-470)
- éœ€è¦å®‰è£… `lodash` æˆ–å®ç°è½»é‡çº§ debounce

**éªŒè¯æ–¹æ³•**:
1. åœ¨æ—¶é—´æ§ä»¶å¿«é€Ÿæ‰‹åŠ¨è¾“å…¥
2. è§‚å¯Ÿ `onStartTimeChange` è°ƒç”¨é¢‘ç‡ï¼ˆåº”ä¸º 300ms é—´éš”ï¼‰
3. æ£€æŸ¥ localStorage å†™å…¥æ¬¡æ•°

---

#### Issue #4: ä¿å­˜æŒ‰é’®ç¼ºå°‘ Loading çŠ¶æ€

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 12.4

**é—®é¢˜æè¿°**:
- ç”¨æˆ·ç‚¹å‡»ä¿å­˜åï¼Œåœ¨å¼‚æ­¥æ“ä½œå®Œæˆå‰å¯ä»¥é‡å¤ç‚¹å‡»
- å¯èƒ½å¯¼è‡´å¹¶å‘è¯·æ±‚æˆ– UI çŠ¶æ€ä¸ä¸€è‡´

**å»ºè®®æ–¹æ¡ˆ**:
```typescript
// EventEditModal.tsx
const [isSaving, setIsSaving] = useState(false);

const handleSave = async () => {
  if (isSaving) return; // é˜²æ­¢é‡å¤æäº¤
  
  setIsSaving(true);
  try {
    // ... åŸæœ‰ä¿å­˜é€»è¾‘
  } finally {
    setIsSaving(false);
  }
};

// JSX
<button 
  className="save-button" 
  onClick={handleSave} 
  disabled={!formData.title && formData.tags.length === 0 || isSaving}
>
  {isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}
</button>
```

**å½±å“èŒƒå›´**:
- `src/components/EventEditModal.tsx` (L280-420, L836-850)

**éªŒè¯æ–¹æ³•**:
1. ç‚¹å‡»ä¿å­˜åç«‹å³å†æ¬¡ç‚¹å‡»
2. ç¡®è®¤æŒ‰é’®å˜ä¸ºç¦ç”¨çŠ¶æ€å¹¶æ˜¾ç¤º "ä¿å­˜ä¸­..."
3. ä¿å­˜å®ŒæˆåæŒ‰é’®æ¢å¤

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ä¸æœªæ¥æ‰©å±•ï¼‰

#### Issue #5: å¯è®¿é—®æ€§ï¼ˆA11yï¼‰æ”¹è¿›

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 12.5

**å»ºè®®æ”¹è¿›**:
1. **ARIA å±æ€§**:
   ```tsx
   <div 
     className="event-edit-modal-overlay"
     role="dialog"
     aria-modal="true"
     aria-labelledby="event-edit-title"
   >
     <h2 id="event-edit-title">ç¼–è¾‘äº‹ä»¶</h2>
   ```

2. **Label å…³è”**:
   ```tsx
   <label htmlFor="event-title">æ ‡é¢˜</label>
   <input id="event-title" type="text" ... />
   ```

3. **é”®ç›˜å¿«æ·é”®**:
   ```typescript
   const handleKeyDown = (e: React.KeyboardEvent) => {
     if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
       handleSave();
     }
     if (e.key === 'Escape') {
       onClose();
     }
   };
   ```

**å½±å“èŒƒå›´**:
- `src/components/EventEditModal.tsx` (å¤šå¤„)

---

#### Issue #6: description å¯Œæ–‡æœ¬æ”¯æŒï¼ˆæœªæ¥ï¼‰

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 11

**æœªæ¥è§„åˆ’**:
1. **Markdown æ”¯æŒ**:
   - å®¢æˆ·ç«¯ï¼šä½¿ç”¨ `react-markdown` æˆ– `tiptap`
   - ä¿å­˜ï¼šMarkdown åŸæ–‡ + HTML é¢„è§ˆï¼ˆç”¨äº Outlook åŒæ­¥ï¼‰

2. **å›¾ç‰‡/é™„ä»¶**:
   - è®¾è®¡äº‘ç«¯å­˜å‚¨ç­–ç•¥ï¼ˆAzure Blob / OneDriveï¼‰
   - description ä¸­ä½¿ç”¨ URL å¼•ç”¨
   - Outlook åŒæ­¥æ—¶åµŒå…¥å›¾ç‰‡é“¾æ¥

3. **å˜æ›´å†å²**:
   - ä¸º description æä¾›ç®€æ˜“ç‰ˆæœ¬è®°å½•ï¼ˆæœ€è¿‘ 5 æ¬¡ï¼‰
   - æ”¯æŒæ¢å¤è¯¯åˆ å†…å®¹

**æŠ€æœ¯æŒ‘æˆ˜**:
- Outlook description å­—æ®µçš„ HTML æ ¼å¼å…¼å®¹æ€§
- ä¸åŒå®¢æˆ·ç«¯ï¼ˆWeb/Desktop/Mobileï¼‰çš„æ˜¾ç¤ºä¸€è‡´æ€§
- å›¾ç‰‡/é™„ä»¶çš„æƒé™æ§åˆ¶ä¸è¿‡æœŸç®¡ç†

---

#### Issue #7: è‡ªåŠ¨ä¿å­˜è‰ç¨¿

**æ¥æº**: `docs/PRD/EVENTEDITMODAL_MODULE_PRD.md` Section 11

**å»ºè®®æ–¹æ¡ˆ**:
```typescript
// EventEditModal.tsx
useEffect(() => {
  if (!event?.id || !isOpen) return;
  
  const saveDraft = debounce(() => {
    localStorage.setItem(`draft-${event.id}`, JSON.stringify(formData));
  }, 2000); // 2ç§’é˜²æŠ–
  
  saveDraft();
  
  return () => saveDraft.cancel();
}, [formData, event?.id, isOpen]);

// åˆå§‹åŒ–æ—¶æ¢å¤è‰ç¨¿
useEffect(() => {
  if (event && isOpen) {
    const draft = localStorage.getItem(`draft-${event.id}`);
    if (draft) {
      const confirmed = window.confirm('å‘ç°æœªä¿å­˜çš„è‰ç¨¿ï¼Œæ˜¯å¦æ¢å¤ï¼Ÿ');
      if (confirmed) {
        setFormData(JSON.parse(draft));
      }
      localStorage.removeItem(`draft-${event.id}`);
    }
  }
}, [event, isOpen]);
```

**å½±å“èŒƒå›´**:
- `src/components/EventEditModal.tsx`
- éœ€è¦è€ƒè™‘è‰ç¨¿è¿‡æœŸæ¸…ç†ç­–ç•¥

---

## ğŸ¯ å®æ–½è®¡åˆ’

### Phase 1: Cross-check åç»Ÿä¸€å¤„ç†ï¼ˆå½“å‰é˜¶æ®µï¼‰
1. âœ… å®Œæˆæ‰€æœ‰æ¨¡å— PRD ç¼–å†™
2. â³ Cross-check PRD ä¹‹é—´çš„ä¸€è‡´æ€§
3. â³ æ ¹æ® Cross-check ç»“æœè°ƒæ•´æœ¬æ¸…å•

### Phase 2: é«˜ä¼˜å…ˆçº§é—®é¢˜ä¿®å¤
- [ ] Issue #1: EventHub.createEvent è¿”å›å€¼
- [ ] Issue #2: syncStatus æšä¸¾ç»Ÿä¸€

### Phase 3: ä¸­ä¼˜å…ˆçº§ä½“éªŒä¼˜åŒ–
- [ ] Issue #3: onStartTimeChange é˜²æŠ–
- [ ] Issue #4: ä¿å­˜æŒ‰é’® Loading çŠ¶æ€

### Phase 4: ä½ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆæŒ‰éœ€ï¼‰
- [ ] Issue #5: å¯è®¿é—®æ€§æ”¹è¿›
- [ ] Issue #6: description å¯Œæ–‡æœ¬æ”¯æŒï¼ˆv2.0ï¼‰
- [ ] Issue #7: è‡ªåŠ¨ä¿å­˜è‰ç¨¿

---

## ğŸ“ è·Ÿè¸ªè§„åˆ™

- æ¯ä¸ª Issue ä¿®å¤åï¼Œåœ¨æ­¤æ–‡æ¡£æ ‡è®°ä¸º `[âœ“]`
- ä¿®å¤æ—¶åˆ›å»ºå¯¹åº”çš„ Git commitï¼Œå¼•ç”¨ Issue ç¼–å·
- ä¿®å¤åæ›´æ–°ç›¸å…³ PRD æ–‡æ¡£ï¼ˆæ ‡æ³¨å·²ä¿®å¤ï¼‰

---

**æœ€åæ›´æ–°**: 2025-11-05  
**ä¸‹ä¸€æ­¥**: ç»§ç»­ç¼–å†™ TagManager PRD â†’ PlanManager PRD â†’ Cross-check
