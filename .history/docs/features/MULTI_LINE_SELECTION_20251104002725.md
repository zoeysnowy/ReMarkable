# 多行选择与删除功能

## 功能概述

Plan 页面支持多行选择和批量删除，提升编辑效率。

## 选择方法

### 1. 鼠标拖拽选择（开发中）
- 在左侧前缀区域（Checkbox/Emoji）按住鼠标拖拽
- 选择区域会高亮显示（浅蓝色背景）

### 2. Shift + 点击选择范围
**步骤**：
1. 点击第一行（设置起点）
2. 按住 **Shift** 键
3. 点击最后一行（设置终点）
4. 起点和终点之间的所有行被选中

**示例**：
```
[ ] 任务 A     ← 点击这里（起点）
[ ] 任务 B     
[ ] 任务 C     
[ ] 任务 D     ← Shift + 点击这里（终点）
[ ] 任务 E     
```
结果：任务 A、B、C、D 被选中

### 3. Shift + 方向键选择
**步骤**：
1. 聚焦到某一行（点击或用方向键导航）
2. 按住 **Shift** 键
3. 按 **↑** 或 **↓** 扩展选择范围

**示例**：
```
[ ] 任务 A     
[ ] 任务 B     ← 当前聚焦
[ ] 任务 C     
[ ] 任务 D     
```
按 `Shift + ↓` → 任务 B 和 C 被选中  
再按 `Shift + ↓` → 任务 B、C、D 被选中

### 4. Ctrl/Cmd + 点击多选
**步骤**：
1. 点击第一行
2. 按住 **Ctrl**（Windows）或 **Cmd**（Mac）
3. 点击其他行添加到选择集
4. 再次 Ctrl/Cmd + 点击已选中的行可取消选择

**示例**：
```
[ ] 任务 A     ← 点击
[ ] 任务 B     
[ ] 任务 C     ← Ctrl + 点击
[ ] 任务 D     
[ ] 任务 E     ← Ctrl + 点击
```
结果：任务 A、C、E 被选中（不连续选择）

## 删除操作

### 方法 1：Delete 键
1. 选择多行
2. 确保焦点不在编辑器内（点击左侧区域）
3. 按 **Delete** 键
4. 选中的所有行及其描述行被删除

### 方法 2：Backspace 键
1. 选择多行
2. 确保焦点不在编辑器内
3. 按 **Backspace** 键
4. 选中的所有行及其描述行被删除

**注意**：如果光标在编辑器内（正在输入），Delete/Backspace 会正常编辑文本，不会触发多行删除。

## 取消选择

### 方法 1：Escape 键
按 **Esc** 键清除所有选择

### 方法 2：单击空白处
点击任意未选中的行（不按 Shift/Ctrl）

### 方法 3：开始编辑
点击编辑器区域开始输入

## 视觉反馈

- **选中状态**：浅蓝色背景 `rgba(59, 130, 246, 0.1)`
- **边框圆角**：4px
- **过渡动画**：0.15s 淡入淡出

## 键盘快捷键总结

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 范围选择 | `Shift + Click` | 选择起点到终点的所有行 |
| 扩展选择 | `Shift + ↑/↓` | 向上/下扩展选择范围 |
| 多选/取消 | `Ctrl/Cmd + Click` | 添加或移除单行 |
| 删除选中 | `Delete` 或 `Backspace` | 删除所有选中的行 |
| 取消选择 | `Esc` | 清除选择 |

## 技术实现

### 状态管理
```typescript
const [selectedLineIds, setSelectedLineIds] = useState<Set<string>>(new Set());
const [lastClickedLineId, setLastClickedLineId] = useState<string | null>(null);
```

### 选择逻辑
- **Shift + Click**：计算起点和终点之间的索引范围
- **Ctrl/Cmd + Click**：切换单行的选中状态
- **Shift + Arrow**：基于当前行向上/下扩展

### 删除逻辑
```typescript
// 删除选中的行及其描述行
const idsToDelete = new Set<string>();
selectedLineIds.forEach(id => {
  idsToDelete.add(id);
  idsToDelete.add(`${id}-desc`); // 同时删除描述行
});
```

### 事件处理
- 点击事件：检测 `shiftKey`、`ctrlKey`、`metaKey`
- 键盘事件：全局监听 `keydown`
- 防冲突：检测焦点是否在 `.ProseMirror` 编辑器内

## 注意事项

1. **描述行自动删除**：删除标题行时，对应的描述行（`-desc` 后缀）也会被删除
2. **焦点管理**：删除后自动聚焦到删除位置的上一行末尾
3. **编辑优先**：在编辑器内输入时，Delete/Backspace 保持正常功能
4. **性能优化**：使用 `Set` 存储选中 ID，快速查找和去重

## 未来改进

- [ ] 鼠标拖拽框选（橡皮筋选择）
- [ ] Ctrl+A 全选
- [ ] 右键菜单（复制、剪切、粘贴）
- [ ] 拖拽调整选中行的顺序
- [ ] 批量修改选中行的标签/优先级

---

*最后更新：2025-11-04*
