# Electron 启动性能测试工具使用指南

## 🎯 目标

分别测试 **React 开发服务器** 和 **Electron 启动** 的性能，找出到底是哪个环节慢。

---

## 📋 测试步骤

### 测试 1: React 开发服务器启动速度

测试 `npm start` 的启动时间（包括 TypeScript 编译、Webpack 打包等）。

#### 使用方法

1. **确保没有 React 服务器在运行**
   ```bash
   # 如果有正在运行的 npm start，按 Ctrl+C 停止
   ```

2. **运行测试**
   ```bash
   cd electron
   node test-react-startup.js
   ```

3. **查看结果**
   - 测试会自动启动 `npm start`
   - 显示编译时间、服务器就绪时间等
   - 给出性能评级和优化建议

4. **测试完成后**
   - 按 `Ctrl+C` 停止 React 服务器

#### 示例输出

```
========================================
  React Dev Server 启动性能测试
========================================

[步骤 1/3] 检查端口 3000...
  ✅ 端口可用 (5ms)

[步骤 2/3] 启动 React 开发服务器...
  命令: npm start
  📦 开始编译...
  ✅ 编译成功 (45.2s)

[步骤 3/3] 等待服务器就绪...
  ✅ React server ready (45.5s, 455 attempts)

========================================
  性能测试结果
========================================

⏱️  时间分解:
  - 端口检查:        5ms
  - npm 进程启动:    300ms
  - React 编译:      45.2s
  - 服务器就绪:      45.5s
  ─────────────────────────────────────
  总启动时间:        45.5s

✅ 性能评级: 良好 👍
   总时间 45.5s

========================================
```

---

### 测试 2: Electron 启动速度

测试 Electron 应用本身的启动速度（假设 React 服务器已就绪）。

#### 使用方法

1. **先启动 React 服务器**（在一个终端）
   ```bash
   npm start
   ```
   等待看到 "Compiled successfully!"

2. **运行 Electron 测试**（在另一个终端）
   ```bash
   cd electron
   node test-electron-startup.js
   ```

3. **查看结果**
   - 显示 Electron 各阶段的启动时间
   - 进程启动、应用初始化、窗口创建、内容加载
   - 找出最慢的阶段

4. **测试完成后**
   - 按 `Ctrl+C` 关闭 Electron

#### 示例输出

```
========================================
  Electron 启动性能测试
========================================

[前置检查] 检查 React 服务器状态...
  ✅ React 服务器已就绪

[步骤 1/4] 启动 Electron 进程...
  ✅ Electron 进程启动 (850ms)

[步骤 2/4] 初始化应用...
  ✅ 窗口创建完成 (1200ms)

[步骤 3/4] 加载内容...
  ✅ 内容加载完成 (500ms)

[步骤 4/4] 应用就绪

========================================
  Electron 启动性能分析
========================================

⏱️  时间分解:
  - 进程启动:        850ms
  - 应用初始化:      350ms
  - 窗口创建:        1200ms
  - 内容加载:        300ms
  ─────────────────────────────────────
  总启动时间:        2.5s

✅ Electron 性能评级: 优秀 ⚡
   启动时间 2.5s

========================================
```

---

## 🔍 诊断流程

### 情况 1: 总启动时间很长（> 60 秒）

**步骤：**
1. 先运行 `test-react-startup.js`
2. 查看 React 编译时间：
   - **如果 > 60 秒** → React 编译是瓶颈
   - **如果 < 30 秒** → 继续下一步

3. 运行 `test-electron-startup.js`
4. 查看 Electron 启动时间：
   - **如果 > 10 秒** → Electron 启动是瓶颈
   - **如果 < 5 秒** → 问题在 React

### 情况 2: React 编译慢（> 60 秒）

**优化方案：**

1. **增加 Node.js 内存**
   ```bash
   # PowerShell
   $env:NODE_OPTIONS="--max-old-space-size=4096"
   npm start
   ```

2. **跳过 TypeScript 类型检查**（开发时）
   创建/修改 `.env` 文件：
   ```env
   TSC_COMPILE_ON_ERROR=true
   SKIP_PREFLIGHT_CHECK=true
   ```

3. **禁用 source maps**（开发时）
   在 `.env` 添加：
   ```env
   GENERATE_SOURCEMAP=false
   ```

4. **使用 SSD**
   - 如果项目在 HDD 上，迁移到 SSD
   - 或使用 RAM Disk

### 情况 3: Electron 启动慢（> 10 秒）

**查看瓶颈分析**，测试会指出最慢的阶段：

- **进程启动慢** → 系统资源不足、杀毒软件拦截
- **应用初始化慢** → main.js 加载模块过多
- **内容加载慢** → React 首屏渲染慢

**优化方案：**

1. **进程启动慢**
   - 关闭杀毒软件实时扫描（仅限开发时）
   - 关闭不必要的后台程序
   - 检查磁盘性能

2. **应用初始化慢**
   - 延迟加载 main.js 中的非关键模块
   - 减少 IPC 处理器注册时间
   - 检查 preload.js 是否过重

3. **内容加载慢**
   - 优化首屏组件（减少初始 DOM 节点）
   - 懒加载非首屏路由
   - 减少首屏 API 请求

---

## 📊 性能基准

### React 开发服务器

| 评级 | 时间 | 说明 |
|------|------|------|
| 优秀 ⚡ | < 10s | 理想状态 |
| 良好 👍 | 10-30s | 正常 |
| 一般 ⚠️ | 30-60s | 可优化 |
| 缓慢 🐌 | > 60s | 需要优化 |

### Electron 启动

| 评级 | 时间 | 说明 |
|------|------|------|
| 优秀 ⚡ | < 2s | 理想状态 |
| 良好 👍 | 2-5s | 正常 |
| 一般 ⚠️ | 5-10s | 可优化 |
| 缓慢 🐌 | > 10s | 需要优化 |

---

## 💡 快速诊断

如果你想快速了解瓶颈，按以下顺序运行：

```bash
# 1. 测试 React（会自动启动服务器）
cd electron
node test-react-startup.js

# 等待测试完成后按 Ctrl+C

# 2. 启动 React（保持运行）
cd ..
npm start

# 等待 "Compiled successfully!" 出现

# 3. 新开一个终端，测试 Electron
cd electron
node test-electron-startup.js

# 查看结果后按 Ctrl+C
```

**结果分析：**
- React 测试总时间 - Electron 测试总时间 ≈ React 编译耗时
- 如果 React 编译 > 50 秒，那就是主要瓶颈
- 如果 Electron 启动 > 5 秒，也需要优化

---

## 🚨 常见问题

### Q: React 测试卡住不动

**A:** 可能编译过程中出错，查看输出是否有错误信息。尝试：
```bash
# 手动启动看详细输出
npm start
```

### Q: Electron 测试提示 "React 服务器未运行"

**A:** 需要先在另一个终端启动 React：
```bash
npm start
```
等待 "Compiled successfully!" 后再运行 Electron 测试。

### Q: 测试超时

**A:** 如果超过 30 秒没反应，说明启动确实很慢，查看：
- 系统资源（CPU、内存、磁盘）
- 杀毒软件是否在扫描
- 项目所在磁盘类型（HDD vs SSD）

---

## 📞 需要帮助？

运行完两个测试后，请提供：

1. `test-react-startup.js` 的完整输出
2. `test-electron-startup.js` 的完整输出
3. 系统配置（CPU、内存、磁盘类型）
4. 是否有杀毒软件在运行

这样可以精准定位问题！
