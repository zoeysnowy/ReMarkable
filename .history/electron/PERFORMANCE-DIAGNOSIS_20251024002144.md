# Electron æ€§èƒ½è¯Šæ–­æŒ‡å—

## ğŸ¯ ç›®æ ‡

å¸®åŠ©è¯Šæ–­å’Œè§£å†³ Electron åº”ç”¨å¡é¡¿é—®é¢˜ï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆã€‚

## ğŸ“‹ è¯Šæ–­æ­¥éª¤

### æ­¥éª¤ 1: æ‰“å¼€æ€§èƒ½ç›‘æ§

1. **å¯åŠ¨åº”ç”¨**
   ```bash
   cd electron
   npm run electron-dev
   ```

2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ `Ctrl + Shift + I`ï¼ˆWindows/Linuxï¼‰
   - æˆ– `Cmd + Option + I`ï¼ˆMacï¼‰

3. **åŠ è½½æ€§èƒ½å·¥å…·**
   - åœ¨ Console æ ‡ç­¾ä¸­
   - å¤åˆ¶ `electron/performance-console-tools.js` çš„å…¨éƒ¨å†…å®¹
   - ç²˜è´´åˆ°æ§åˆ¶å°å¹¶å›è½¦

### æ­¥éª¤ 2: å¿«é€Ÿè¯Šæ–­

```javascript
// 1. æŸ¥çœ‹æ€§èƒ½æ‘˜è¦
await perfTools.showSummary()

// 2. è·å–ä¼˜åŒ–å»ºè®®
await perfTools.getSuggestions()
```

### æ­¥éª¤ 3: æ·±åº¦åˆ†æ

#### ç›‘æ§ IPC è°ƒç”¨ï¼ˆæ‰¾å‡ºé¢‘ç¹è°ƒç”¨ï¼‰

```javascript
// ç›‘æ§ 30 ç§’å†…çš„æ‰€æœ‰ IPC è°ƒç”¨
await perfTools.monitorIPC(30000)

// æ“ä½œåº”ç”¨ï¼ˆæ‹–åŠ¨çª—å£ã€åŒæ­¥æ—¥å†ç­‰ï¼‰
// ç­‰å¾… 30 ç§’åæŸ¥çœ‹ç»“æœ
```

**æŸ¥çœ‹å†…å®¹ï¼š**
- è°ƒç”¨æ¬¡æ•°æœ€å¤šçš„ IPC é€šé“
- å¹³å‡è€—æ—¶æœ€é•¿çš„æ“ä½œ
- é«˜é¢‘è°ƒç”¨è­¦å‘Šï¼ˆ> 50 æ¬¡/ç§’ï¼‰

#### æ£€æµ‹å†…å­˜æ³„æ¼

```javascript
// æ¯ 5 ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œå…±é‡‡æ · 10 æ¬¡
await perfTools.checkMemoryLeak(5000, 10)

// åœ¨ç›‘æ§æœŸé—´æ­£å¸¸ä½¿ç”¨åº”ç”¨
// ç­‰å¾… 50 ç§’åæŸ¥çœ‹å†…å­˜è¶‹åŠ¿
```

**åˆ¤æ–­æ ‡å‡†ï¼š**
- âœ… å¢é•¿ < 5 MBï¼šæ­£å¸¸
- âš ï¸ å¢é•¿ 5-10 MBï¼šéœ€è§‚å¯Ÿ
- ğŸ”´ å¢é•¿ > 10 MBï¼šå¯èƒ½æ³„æ¼

### æ­¥éª¤ 4: æŸ¥çœ‹ä¸»è¿›ç¨‹æ—¥å¿—

æ€§èƒ½ç›‘æ§ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨ç»ˆç«¯è¾“å‡ºï¼š

1. **è‡ªåŠ¨æŠ¥å‘Š**ï¼ˆæ¯ 30 ç§’ï¼‰
   - æŸ¥çœ‹å¯åŠ¨ Electron çš„ç»ˆç«¯çª—å£
   - ä¼šçœ‹åˆ°è¯¦ç»†çš„æ€§èƒ½ç»Ÿè®¡

2. **æ‰‹åŠ¨è§¦å‘æŠ¥å‘Š**
   ```javascript
   await perfTools.printReport()
   ```
   ç„¶åæŸ¥çœ‹ç»ˆç«¯è¾“å‡º

## ğŸ” å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1: åº”ç”¨å¯åŠ¨æ…¢

**ç—‡çŠ¶ï¼š** æ‰“å¼€åº”ç”¨éœ€è¦ > 5 ç§’

**è¯Šæ–­ï¼š**
```bash
# ä½¿ç”¨å¯åŠ¨æ€§èƒ½æµ‹è¯•å·¥å…·
cd electron
node performance-test.js
```

**æŸ¥çœ‹ï¼š**
- React ç¼–è¯‘æ—¶é—´ï¼ˆæ­£å¸¸ < 60 ç§’ï¼‰
- Electron å¯åŠ¨æ—¶é—´ï¼ˆæ­£å¸¸ < 1 ç§’ï¼‰
- å†…å®¹åŠ è½½æ—¶é—´ï¼ˆæ­£å¸¸ < 2 ç§’ï¼‰

### é—®é¢˜ 2: æ‹–åŠ¨çª—å£å¡é¡¿

**ç—‡çŠ¶ï¼š** æ‹–åŠ¨æ¡Œé¢å°ç»„ä»¶æ—¶æ˜æ˜¾å¡é¡¿ã€æ‰å¸§

**è¯Šæ–­ï¼š**
```javascript
// 1. å¼€å§‹ç›‘æ§
await perfTools.monitorIPC(10000)

// 2. æ‹–åŠ¨å°ç»„ä»¶çª—å£ 10 ç§’

// 3. æŸ¥çœ‹ç»“æœ
```

**å…³æ³¨æŒ‡æ ‡ï¼š**
- `widget-move` è°ƒç”¨æ¬¡æ•°
  - âœ… æ­£å¸¸ï¼š10-20 æ¬¡/ç§’
  - âš ï¸ åé«˜ï¼š20-50 æ¬¡/ç§’
  - ğŸ”´ è¿‡é«˜ï¼š> 50 æ¬¡/ç§’
- `widget-move` å¹³å‡è€—æ—¶
  - âœ… æ­£å¸¸ï¼š< 5ms
  - âš ï¸ åæ…¢ï¼š5-20ms
  - ğŸ”´ å¾ˆæ…¢ï¼š> 20ms

**è§£å†³æ–¹æ¡ˆï¼š**
- å¦‚æœè°ƒç”¨é¢‘ç‡è¿‡é«˜ï¼šå¢åŠ èŠ‚æµæ—¶é—´
- å¦‚æœå•æ¬¡è€—æ—¶è¿‡é•¿ï¼šä¼˜åŒ– setBounds é€»è¾‘

### é—®é¢˜ 3: æ—¥å†åŒæ­¥æ…¢

**ç—‡çŠ¶ï¼š** åŒæ­¥æ—¥å†äº‹ä»¶éœ€è¦å¾ˆé•¿æ—¶é—´

**è¯Šæ–­ï¼š**
```javascript
// 1. é‡ç½®ç»Ÿè®¡
await perfTools.resetStats()

// 2. æ‰§è¡Œä¸€æ¬¡å®Œæ•´åŒæ­¥

// 3. æŸ¥çœ‹æŠ¥å‘Š
await perfTools.showSummary()
```

**å…³æ³¨æŒ‡æ ‡ï¼š**
- Microsoft Graph API ç›¸å…³çš„ IPC è°ƒç”¨
- ç½‘ç»œè¯·æ±‚è€—æ—¶
- æ•°æ®å¤„ç†æ—¶é—´

### é—®é¢˜ 4: å†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶ï¼š** åº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´åå†…å­˜æŒç»­å¢é•¿

**è¯Šæ–­ï¼š**
```javascript
// é•¿æœŸç›‘æ§ï¼ˆæ¯ 10 ç§’é‡‡æ ·ï¼Œå…± 20 æ¬¡ = 3 åˆ†é’Ÿï¼‰
await perfTools.checkMemoryLeak(10000, 20)

// åœ¨ç›‘æ§æœŸé—´æ­£å¸¸ä½¿ç”¨åº”ç”¨
// åŒ…æ‹¬ï¼šæ‰“å¼€å…³é—­é¡µé¢ã€åŒæ­¥æ—¥å†ã€æ“ä½œå°ç»„ä»¶ç­‰
```

**åˆ¤æ–­å†…å­˜æ³„æ¼ï¼š**
- å†…å­˜æŒç»­çº¿æ€§å¢é•¿
- ä¸æ‰§è¡Œæ“ä½œæ—¶å†…å­˜ä¹Ÿåœ¨å¢é•¿
- åƒåœ¾å›æ”¶åå†…å­˜ä¸é™ä½

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡å‚è€ƒ

### IPC è°ƒç”¨æ€§èƒ½

| æ“ä½œ | æ­£å¸¸è€—æ—¶ | è­¦å‘Šé˜ˆå€¼ | ä¸¥é‡é˜ˆå€¼ |
|------|---------|---------|---------|
| widget-move | < 5ms | 10ms | 20ms |
| widget-resize | < 10ms | 20ms | 50ms |
| get-auth-tokens | < 5ms | 10ms | 20ms |
| æ–‡ä»¶å¯¹è¯æ¡† | < 100ms | 200ms | 500ms |
| Microsoft è®¤è¯ | < 500ms | 1000ms | 3000ms |

### å†…å­˜ä½¿ç”¨

| æŒ‡æ ‡ | æ­£å¸¸ | è­¦å‘Š | ä¸¥é‡ |
|------|------|------|------|
| Heap Used | < 100 MB | 100-200 MB | > 200 MB |
| RSS | < 200 MB | 200-400 MB | > 400 MB |

### CPU ä½¿ç”¨

- **ç©ºé—²æ—¶**ï¼šUser + System < 5 ç§’
- **æ´»è·ƒæ—¶**ï¼šUser + System < 30 ç§’ï¼ˆæ¯åˆ†é’Ÿï¼‰

## ğŸ› ï¸ ä¼˜åŒ–å»ºè®®

### é«˜é¢‘ IPC è°ƒç”¨

å¦‚æœæŸä¸ª IPC è°ƒç”¨é¢‘ç‡ > 100 æ¬¡/ç§’ï¼š

```javascript
// æ·»åŠ é˜²æŠ–æˆ–èŠ‚æµ
import { throttle } from 'lodash';

const throttledMove = throttle((position) => {
  window.electronAPI.widgetMove(position);
}, 100); // é™åˆ¶ä¸ºæ¯ 100ms æœ€å¤šè°ƒç”¨ 1 æ¬¡
```

### æ…¢é€Ÿæ“ä½œ

å¦‚æœæŸä¸ªæ“ä½œè€—æ—¶ > 100msï¼š

1. **å¼‚æ­¥åŒ–**ï¼šä¸è¦é˜»å¡ UI çº¿ç¨‹
2. **æ‰¹é‡å¤„ç†**ï¼šåˆå¹¶å¤šä¸ªå°è¯·æ±‚
3. **ç¼“å­˜**ï¼šé¿å…é‡å¤è®¡ç®—

### å†…å­˜æ³„æ¼

å¦‚æœæ£€æµ‹åˆ°å†…å­˜æ³„æ¼ï¼š

1. **æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨**ï¼šç¡®ä¿æ­£ç¡®æ¸…ç†
2. **æ£€æŸ¥å®šæ—¶å™¨**ï¼šä½¿ç”¨ `clearInterval`/`clearTimeout`
3. **æ£€æŸ¥é—­åŒ…**ï¼šé¿å…å¾ªç¯å¼•ç”¨
4. **ä½¿ç”¨ Chrome DevTools Memory Profiler**

## ğŸ“ æ€§èƒ½æ—¥å¿—ç¤ºä¾‹

### æ­£å¸¸æƒ…å†µ

```
========================================
ğŸ“Š [æ€§èƒ½ç›‘æ§] æ€§èƒ½æŠ¥å‘Š
========================================
â±ï¸  è¿è¡Œæ—¶é—´: 125.34s
ğŸ’¾ å†…å­˜ä½¿ç”¨:
   - RSS: 156.23 MB
   - Heap Used: 45.67 MB
   - Heap Total: 78.91 MB
   - External: 2.34 MB
âš¡ CPU ä½¿ç”¨:
   - User: 3.45s
   - System: 1.23s
ğŸ“¡ IPC è°ƒç”¨ç»Ÿè®¡ (Top 10):
   widget-move:
      è°ƒç”¨æ¬¡æ•°: 234
      å¹³å‡è€—æ—¶: 3.21ms
      æœ€å¤§è€—æ—¶: 15ms
      æœ€å°è€—æ—¶: 1ms
   get-auth-tokens:
      è°ƒç”¨æ¬¡æ•°: 45
      å¹³å‡è€—æ—¶: 2.15ms
      æœ€å¤§è€—æ—¶: 8ms
      æœ€å°è€—æ—¶: 1ms
========================================
```

### å¼‚å¸¸æƒ…å†µ

```
========================================
ğŸ“Š [æ€§èƒ½ç›‘æ§] æ€§èƒ½æŠ¥å‘Š
========================================
â±ï¸  è¿è¡Œæ—¶é—´: 125.34s
ğŸ’¾ å†…å­˜ä½¿ç”¨:
   - RSS: 456.78 MB  âš ï¸ è¿‡é«˜
   - Heap Used: 234.56 MB  âš ï¸ è¿‡é«˜
   - Heap Total: 289.12 MB
   - External: 12.34 MB
âš¡ CPU ä½¿ç”¨:
   - User: 45.67s  âš ï¸ åé«˜
   - System: 12.34s
ğŸ“¡ IPC è°ƒç”¨ç»Ÿè®¡ (Top 10):
   widget-move:
      è°ƒç”¨æ¬¡æ•°: 12345  âš ï¸ é¢‘ç¹
      å¹³å‡è€—æ—¶: 45.67ms  âš ï¸ æ…¢
      æœ€å¤§è€—æ—¶: 234ms  âš ï¸ å¾ˆæ…¢
      æœ€å°è€—æ—¶: 5ms
   
âš ï¸ [Perf] æ…¢é€Ÿ IPC: widget-move è€—æ—¶ 234ms
âš ï¸ [Perf] æ…¢é€Ÿ IPC: widget-resize è€—æ—¶ 156ms
========================================
```

## ğŸ’¡ å®ç”¨æŠ€å·§

### æŠ€å·§ 1: å¯¹æ¯”æµ‹è¯•

```javascript
// ä¼˜åŒ–å‰
await perfTools.resetStats()
// æ‰§è¡Œæ“ä½œ...
const before = await perfTools.getReport()

// åº”ç”¨ä¼˜åŒ–
// ...

// ä¼˜åŒ–å
await perfTools.resetStats()
// æ‰§è¡Œç›¸åŒæ“ä½œ...
const after = await perfTools.getReport()

// å¯¹æ¯”ç»“æœ
console.log('ä¼˜åŒ–æ•ˆæœ:', {
  ipcè°ƒç”¨å‡å°‘: before.ipc['widget-move'].count - after.ipc['widget-move'].count,
  å¹³å‡è€—æ—¶å‡å°‘: before.ipc['widget-move'].avgTime - after.ipc['widget-move'].avgTime
})
```

### æŠ€å·§ 2: æŒç»­ç›‘æ§

åœ¨åº”ç”¨ä¸­æ·»åŠ ç›‘æ§æŒ‰é’®ï¼š

```javascript
// æ·»åŠ åˆ°è®¾ç½®é¡µé¢
<button onClick={async () => {
  const report = await window.electronAPI.performance.getReport();
  console.log('æ€§èƒ½æŠ¥å‘Š:', report);
}}>
  æŸ¥çœ‹æ€§èƒ½
</button>
```

### æŠ€å·§ 3: è‡ªåŠ¨åŒ–æµ‹è¯•

```javascript
// åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬
async function performanceTest() {
  await perfTools.resetStats();
  
  // æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ
  for (let i = 0; i < 100; i++) {
    await window.electronAPI.widgetMove({ x: 1, y: 0 });
    await new Promise(resolve => setTimeout(resolve, 50));
  }
  
  // è·å–ç»“æœ
  const report = await perfTools.getReport();
  console.assert(report.ipc['widget-move'].avgTime < 10, 'æ‹–åŠ¨æ€§èƒ½æµ‹è¯•å¤±è´¥');
}
```

## ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†

### åº”ç”¨å®Œå…¨å¡æ­»

1. æŒ‰ `Ctrl + Shift + I` æ‰“å¼€ DevTools
2. åˆ‡æ¢åˆ° Performance æ ‡ç­¾
3. ç‚¹å‡»å½•åˆ¶æŒ‰é’®
4. é‡ç°å¡æ­»æ“ä½œ
5. åœæ­¢å½•åˆ¶ï¼ŒæŸ¥çœ‹ç«ç„°å›¾

### æŸ¥çœ‹å´©æºƒæ—¥å¿—

```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
window.electronAPI.getUserDataPath().then(path => {
  console.log('ç”¨æˆ·æ•°æ®è·¯å¾„:', path);
  console.log('å´©æºƒæ—¥å¿—ä½ç½®:', path + '/crashReports/');
})
```

### å¼ºåˆ¶åƒåœ¾å›æ”¶

```javascript
// åœ¨ Chrome DevTools Memory æ ‡ç­¾
// ç‚¹å‡»åƒåœ¾æ¡¶å›¾æ ‡å¼ºåˆ¶ GC
// æˆ–åœ¨ä»£ç ä¸­ï¼ˆéœ€è¦å¯åŠ¨æ—¶æ·»åŠ  --expose-gcï¼‰
if (global.gc) {
  global.gc();
}
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœè¯Šæ–­åä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. `perfTools.showSummary()` çš„å®Œæ•´è¾“å‡º
2. `perfTools.getSuggestions()` çš„å»ºè®®
3. ä¸»è¿›ç¨‹ç»ˆç«¯çš„æ€§èƒ½æŠ¥å‘Š
4. ç³»ç»Ÿä¿¡æ¯ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç±»å‹ï¼‰
5. å…·ä½“çš„å¡é¡¿åœºæ™¯æè¿°

---

**ç¥ä½ è¯Šæ–­é¡ºåˆ©ï¼ğŸ‰**
