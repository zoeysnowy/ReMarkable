# æœˆä»½+æ—¥æœŸå·è§£æä¿®å¤ (v2.10.1)

> **ä¿®å¤æ—¥æœŸ**: 2025-11-17  
> **é—®é¢˜**: "ä¸‹ä¸ªæœˆ3å·"è¢«é”™è¯¯è§£æä¸ºæ•´ä¸ª"ä¸‹ä¸ªæœˆ"èŒƒå›´  
> **å½±å“ç»„ä»¶**: naturalLanguageTimeDictionary.ts

---

## é—®é¢˜æè¿°

ç”¨æˆ·è¾“å…¥ `@ä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹` æ—¶ï¼š
1. âŒ è§£æå™¨åªè¯†åˆ«"ä¸‹ä¸ªæœˆ"ï¼ˆæ•´ä¸ªæœˆèŒƒå›´ï¼š2025-12-01 è‡³ 2025-12-31ï¼‰
2. âŒ "3å·"å’Œ"ä¸‹åˆ5ç‚¹"è¢«å¿½ç•¥
3. âŒ UnifiedDateTimePicker æ˜¾ç¤ºé”™è¯¯çš„æ—¥æœŸèŒƒå›´

**æ ¹æœ¬åŸå› **:
- è¯å…¸ä¸­åªæœ‰"ä¸‹ä¸ªæœˆ"çš„å®šä¹‰ï¼Œè¿”å›æ•´ä¸ªæœˆçš„æ—¥æœŸèŒƒå›´
- æ²¡æœ‰æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…"æœˆä»½å‰ç¼€ + æ—¥æœŸå·"çš„ç»„åˆæ¨¡å¼
- è§£æå™¨æ— æ³•å¤„ç†ç±»ä¼¼"æœ¬å‘¨ä¸‰"ã€"ä¸‹å‘¨äº”"çš„"æœˆä»½ç‰ˆæœ¬"

---

## è§£å†³æ–¹æ¡ˆ

å‚è€ƒ"æœ¬å‘¨ä¸‰"ã€"ä¸‹å‘¨ä¸‰"çš„è§£ææ–¹å¼ï¼Œæ·»åŠ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é€»è¾‘ã€‚

### å®ç°ä»£ç 

**æ–‡ä»¶**: `src/utils/naturalLanguageTimeDictionary.ts`

```typescript
// ğŸ†• v2.10.1: ä¼˜å…ˆæ£€æµ‹"æœˆä»½+æ—¥æœŸå·"ç»„åˆï¼ˆå¦‚"ä¸‹ä¸ªæœˆ3å·"ã€"æœ¬æœˆ15å·"ï¼‰
// æ¨¡å¼ï¼š(æœ¬æœˆ|è¿™ä¸ªæœˆ|ä¸‹æœˆ|ä¸‹ä¸ªæœˆ|ä¸Šæœˆ|ä¸Šä¸ªæœˆ) + (æ•°å­—) + (å·|æ—¥)
const monthDayPattern = /(æœ¬æœˆ|è¿™ä¸ªæœˆ|ä¸‹æœˆ|ä¸‹ä¸ªæœˆ|ä¸Šæœˆ|ä¸Šä¸ªæœˆ)\s*([0-9é›¶ä¸€äºŒä¸¤ä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒä¸‡]+)\s*[å·æ—¥]/;
const monthDayMatch = trimmedInput.match(monthDayPattern);

if (monthDayMatch) {
  const [fullMatch, monthPrefix, dayStr] = monthDayMatch;
  const day = parseChineseNumber(dayStr);
  
  // éªŒè¯æ—¥æœŸæœ‰æ•ˆæ€§ï¼ˆ1-31ï¼‰
  if (day >= 1 && day <= 31) {
    const now = dayjs(referenceDate);
    let targetMonth = now;
    let displayHint = '';
    
    // æ ¹æ®æœˆä»½å‰ç¼€è®¡ç®—ç›®æ ‡æœˆä»½
    if (monthPrefix === 'æœ¬æœˆ' || monthPrefix === 'è¿™ä¸ªæœˆ') {
      targetMonth = now;
      displayHint = `æœ¬æœˆ${day}å·`;
    } else if (monthPrefix === 'ä¸‹æœˆ' || monthPrefix === 'ä¸‹ä¸ªæœˆ') {
      targetMonth = now.add(1, 'month');
      displayHint = `ä¸‹æœˆ${day}å·`;
    } else if (monthPrefix === 'ä¸Šæœˆ' || monthPrefix === 'ä¸Šä¸ªæœˆ') {
      targetMonth = now.subtract(1, 'month');
      displayHint = `ä¸Šæœˆ${day}å·`;
    }
    
    // åˆ›å»ºç›®æ ‡æ—¥æœŸï¼ˆè®¾ç½®ä¸ºè¯¥æœˆçš„æŒ‡å®šæ—¥æœŸï¼‰
    const targetDate = targetMonth.date(day).startOf('day');
    
    // æ£€æŸ¥æ˜¯å¦è¿˜åŒ…å«æ—¶é—´ï¼ˆå¦‚"ä¸‹åˆ5ç‚¹"ï¼‰
    // ... ç»§ç»­è§£ææ—¶é—´éƒ¨åˆ†
  }
}
```

---

## æ”¯æŒçš„æ¨¡å¼

### æœˆä»½å‰ç¼€

| å‰ç¼€ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| æœ¬æœˆ | å½“å‰æœˆä»½ | æœ¬æœˆ3å· |
| è¿™ä¸ªæœˆ | å½“å‰æœˆä»½ï¼ˆåŒ"æœ¬æœˆ"ï¼‰ | è¿™ä¸ªæœˆ15å· |
| ä¸‹æœˆ | ä¸‹ä¸€ä¸ªæœˆ | ä¸‹æœˆ3å· |
| ä¸‹ä¸ªæœˆ | ä¸‹ä¸€ä¸ªæœˆï¼ˆåŒ"ä¸‹æœˆ"ï¼‰ | ä¸‹ä¸ªæœˆ20å· |
| ä¸Šæœˆ | ä¸Šä¸€ä¸ªæœˆ | ä¸Šæœˆ10å· |
| ä¸Šä¸ªæœˆ | ä¸Šä¸€ä¸ªæœˆï¼ˆåŒ"ä¸Šæœˆ"ï¼‰ | ä¸Šä¸ªæœˆ25å· |

### æ—¥æœŸå·

- **é˜¿æ‹‰ä¼¯æ•°å­—**: 1-31
- **ä¸­æ–‡æ•°å­—**: ä¸€ã€ä¸‰ã€åäº”ã€äºŒåå…«ç­‰
- **åç¼€**: å·ã€æ—¥

### ç»„åˆä½¿ç”¨

| æ¨¡å¼ | ç¤ºä¾‹ | è§£æç»“æœï¼ˆå‡è®¾ä»Šå¤©æ˜¯ 2025-11-17ï¼‰ |
|------|------|----------------------------------|
| æœˆä»½å‰ç¼€ + æ—¥æœŸå· | ä¸‹ä¸ªæœˆ3å· | 2025-12-03 00:00 |
| æœˆä»½å‰ç¼€ + æ—¥æœŸå· + æ—¶é—´æ®µ + ç²¾ç¡®æ—¶é—´ | ä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹ | 2025-12-03 17:00 |
| æœˆä»½å‰ç¼€ + æ—¥æœŸå· + æ—¶é—´æ®µ + ç²¾ç¡®æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ | æœ¬æœˆ15å·ä¸Šåˆ10ç‚¹åŠ | 2025-11-15 10:30 |

---

## è§£æä¼˜å…ˆçº§

parseNaturalLanguage å‡½æ•°çš„åŒ¹é…é¡ºåºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. âœ… **æˆªæ­¢å…³é”®è¯æ£€æµ‹**ï¼ˆå¦‚"æˆªæ­¢"ã€"ddl"ï¼‰
2. ğŸ†• **æœˆä»½+æ—¥æœŸå·ç»„åˆ** â† æ–°å¢ï¼ˆv2.10.1ï¼‰
3. âœ… **æ¨¡ç³Šæ—¶é—´æ®µ+ç²¾ç¡®æ—¶é—´ç»„åˆ**ï¼ˆå¦‚"ä¸‹åˆ3ç‚¹"ï¼‰
4. âœ… **ç²¾ç¡®æ—¶é—´ç‚¹**ï¼ˆå¦‚"å¤§åå¤©"ã€"ä¸‹å‘¨äº”"ï¼‰
5. âœ… **æ—¥æœŸèŒƒå›´+æ—¶é—´æ®µç»„åˆ**ï¼ˆå¦‚"å‘¨æœ«ä¸Šåˆ"ï¼‰
6. âœ… **åªæœ‰æ—¶é—´æ®µ**ï¼ˆå¦‚"ä¸‹åˆ"ï¼‰

**ä¼˜å…ˆçº§è®¾è®¡ç†ç”±**ï¼š
- "ä¸‹ä¸ªæœˆ3å·"æ¯”"ä¸‹ä¸ªæœˆ"æ›´å…·ä½“ï¼Œåº”è¯¥ä¼˜å…ˆåŒ¹é…
- ç±»ä¼¼"ä¸‹å‘¨äº”"ä¼˜å…ˆäº"ä¸‹å‘¨"çš„è®¾è®¡

---

## æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1: åªæœ‰æ—¥æœŸ

**è¾“å…¥**: `@ä¸‹ä¸ªæœˆ3å·`  
**æœŸæœ›ç»“æœ**:
- displayHint: "ä¸‹æœˆ3å·"
- date: 2025-12-03 00:00

### æµ‹è¯• 2: æ—¥æœŸ+æ—¶é—´

**è¾“å…¥**: `@ä¸‹ä¸ªæœˆ3å·ä¸‹åˆ5ç‚¹`  
**æœŸæœ›ç»“æœ**:
- displayHint: "ä¸‹æœˆ3å·ä¸‹åˆ5ç‚¹"
- date: 2025-12-03
- startTime: 17:00

### æµ‹è¯• 3: ä¸­æ–‡æ•°å­—

**è¾“å…¥**: `@æœ¬æœˆåäº”å·ä¸Šåˆåç‚¹`  
**æœŸæœ›ç»“æœ**:
- displayHint: "æœ¬æœˆ15å·ä¸Šåˆ10ç‚¹"
- date: 2025-11-15
- startTime: 10:00

### æµ‹è¯• 4: å¤æ‚æ—¶é—´

**è¾“å…¥**: `@ä¸‹æœˆäºŒåå·æ™šä¸Šå…«ç‚¹åŠ`  
**æœŸæœ›ç»“æœ**:
- displayHint: "ä¸‹æœˆ20å·æ™šä¸Š8ç‚¹åŠ"
- date: 2025-12-20
- startTime: 20:30

---

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

1. âœ… `src/utils/naturalLanguageTimeDictionary.ts`
   - æ·»åŠ  `monthDayPattern` æ­£åˆ™è¡¨è¾¾å¼
   - åœ¨ `parseNaturalLanguage` å‡½æ•°å¼€å¤´æ·»åŠ åŒ¹é…é€»è¾‘
   - æ”¯æŒæ—¥æœŸå·è§£æï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—å’Œä¸­æ–‡æ•°å­—ï¼‰
   - æ”¯æŒæ—¥æœŸ+æ—¶é—´ç»„åˆè§£æ
   - è¿”å› `PointInTime` ç»“æ„ï¼ˆç²¾ç¡®æ—¥æœŸç‚¹ï¼‰

2. âœ… `docs/NATURAL_LANGUAGE_DICTIONARY_REFERENCE.md`
   - æ›´æ–°ç‰ˆæœ¬å·ä¸º v2.10.1
   - æ·»åŠ "æœˆä»½+æ—¥æœŸè¡¨è¾¾"ç« èŠ‚
   - æ›´æ–°ç»„åˆè¡¨è¾¾ç¤ºä¾‹

3. âœ… `docs/fixes/MONTH_DAY_PARSING_FIX_v2.10.1.md`
   - åˆ›å»ºæœ¬ä¿®å¤æ–‡æ¡£

---

## è®¾è®¡å¯¹æ¯”

### ç±»ä¼¼æ¨¡å¼: æ˜ŸæœŸè¡¨è¾¾

| æ¨¡å¼ | ç¤ºä¾‹ | å®ç°æ–¹å¼ |
|------|------|---------|
| æœ¬å‘¨ + æ˜ŸæœŸX | æœ¬å‘¨ä¸‰ | POINT_IN_TIME_DICTIONARY è¯å…¸ |
| ä¸‹å‘¨ + æ˜ŸæœŸX | ä¸‹å‘¨äº” | POINT_IN_TIME_DICTIONARY è¯å…¸ |

### æ–°å¢æ¨¡å¼: æœˆä»½è¡¨è¾¾ ğŸ†•

| æ¨¡å¼ | ç¤ºä¾‹ | å®ç°æ–¹å¼ |
|------|------|---------|
| æœ¬æœˆ + æ—¥æœŸå· | æœ¬æœˆ15å· | **æ­£åˆ™è¡¨è¾¾å¼** + åŠ¨æ€è®¡ç®— |
| ä¸‹æœˆ + æ—¥æœŸå· | ä¸‹æœˆ3å· | **æ­£åˆ™è¡¨è¾¾å¼** + åŠ¨æ€è®¡ç®— |

**ä¸ºä»€ä¹ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è€Œéè¯å…¸ï¼Ÿ**
- æ—¥æœŸå·æœ‰31ä¸ªå¯èƒ½å€¼ï¼Œè¯å…¸ä¼šæœ‰ 6 Ã— 31 = 186 ä¸ªæ¡ç›®
- æ­£åˆ™è¡¨è¾¾å¼æ›´çµæ´»ï¼Œæ”¯æŒä¸­æ–‡æ•°å­—å’Œé˜¿æ‹‰ä¼¯æ•°å­—
- ç¬¦åˆ"æœ¬å‘¨ä¸‰"ã€"ä¸‹å‘¨äº”"çš„åŠ¨æ€è®¡ç®—æ€è·¯

---

## ç‰ˆæœ¬å†å²

- **v2.10.1** (2025-11-17): æ·»åŠ æœˆä»½+æ—¥æœŸå·æ­£åˆ™è§£æ
- **v2.10** (2025-11-17): DateMention è¾“å…¥æµç¨‹ä¿®å¤
- **v2.8**: ç§»é™¤ chrono-nodeï¼Œå†…ç½®åŸºç¡€ç›¸å¯¹æ—¥æœŸ
- **v2.7.4**: æˆªæ­¢æ—¶é—´å…³é”®è¯è¯†åˆ«

---

## ç›¸å…³æ–‡æ¡£

- [NATURAL_LANGUAGE_DICTIONARY_REFERENCE.md](../NATURAL_LANGUAGE_DICTIONARY_REFERENCE.md) - è‡ªç„¶è¯­è¨€è¯å…¸å‚è€ƒ
- [DATEMENTION_INPUT_FIX_v2.10.md](./DATEMENTION_INPUT_FIX_v2.10.md) - DateMention è¾“å…¥ä¿®å¤
- [TIME_ARCHITECTURE.md](../TIME_ARCHITECTURE.md) - æ—¶é—´æ¶æ„æ–‡æ¡£
