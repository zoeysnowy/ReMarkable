# GoldenLayout å®æ–½è®¡åˆ’

> **åˆ›å»ºæ—¶é—´**: 2025-12-01  
> **å…³è”æ–‡æ¡£**: [TimeLog_&_Description_PRD.md](./TimeLog_&_Description_PRD.md)  
> **æ¶æ„å†³ç­–**: GoldenLayout ä½œä¸º ReMarkable App é€šç”¨å¸ƒå±€ç³»ç»Ÿ

---

## ğŸ“‹ æ€»è§ˆ

### æˆ˜ç•¥å®šä½

GoldenLayout ä¸ä»…æ˜¯ TimeLog çš„æ ‡ç­¾é¡µç»„ä»¶ï¼Œè€Œæ˜¯ **ReMarkable App çš„é€šç”¨å¸ƒå±€ç®¡ç†åŸºç¡€è®¾æ–½**ã€‚

**ä¸‰å¤§åº”ç”¨åœºæ™¯**:
1. **TimeLog é¡µé¢**: å¤šæ ‡ç­¾ç¼–è¾‘ã€å¼¹å‡ºçª—å£ã€åˆ†å±å¯¹æ¯”
2. **Homepage Dashboard**: è‡ªç”±é…ç½®çš„ä»ªè¡¨ç›˜
3. **Windows Desktop Widgets**: æ¡Œé¢æ‚¬æµ®å°ç»„ä»¶

### æŠ•èµ„å›æŠ¥åˆ†æ

| ç»´åº¦ | ä¼ ç»Ÿæ–¹æ¡ˆ | GoldenLayout æ–¹æ¡ˆ | ä¼˜åŠ¿ |
|------|---------|------------------|------|
| å¼€å‘æ—¶é—´ | æ¯ä¸ªåŠŸèƒ½å•ç‹¬å¼€å‘ï¼ˆ4-6å‘¨ï¼‰ | ä¸€æ¬¡å°è£…ï¼Œå¤„å¤„å¤ç”¨ï¼ˆ2-3å‘¨ï¼‰ | **èŠ‚çœ 50%+ æ—¶é—´** |
| ä»£ç é‡ | å¤šå¥—å¸ƒå±€ç®¡ç†ä»£ç  | ç»Ÿä¸€çš„å¸ƒå±€ç³»ç»Ÿ | **å‡å°‘ 60%+ ä»£ç ** |
| ç”¨æˆ·ä½“éªŒ | ä¸ä¸€è‡´ | ç»Ÿä¸€äº¤äº’æ¨¡å¼ | **é™ä½å­¦ä¹ æˆæœ¬** |
| ç»´æŠ¤æˆæœ¬ | å¤šå¤„ç»´æŠ¤ | å•ç‚¹ç»´æŠ¤ | **é™ä½ 70%+ ç»´æŠ¤æˆæœ¬** |

---

## ğŸ¯ å®æ–½è®¡åˆ’ï¼ˆ3 Phasesï¼Œ8-10 å‘¨ï¼‰

### Phase 1: TimeLog æ ‡ç­¾é¡µåŠŸèƒ½ï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡**: åœ¨ TimeLog é¡µé¢å®ç°å¤šæ ‡ç­¾ç¼–è¾‘åŠŸèƒ½

**ğŸ“ Figma è®¾è®¡è§„æ ¼åˆ†æ** (Node ID: 486-2661)

å½“å‰ TimeLog é¡µé¢å›ºå®šå¸ƒå±€ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Left    â”‚ Content      â”‚ Main Timeline            â”‚ Right FAB  â”‚
â”‚ Sidebar â”‚ Selection    â”‚ æ—¶å…‰æ—¥å¿—                   â”‚ (Floating) â”‚
â”‚ 96px    â”‚ 342px        â”‚ 905px                    â”‚ 80px       â”‚
â”‚         â”‚              â”‚                          â”‚            â”‚
â”‚ é¦–é¡µ    â”‚ ğŸ“… Calendar  â”‚ 2025.10.18ï¼ˆå‘¨å…­ï¼‰        â”‚ è®°å½•æ­¤åˆ»    â”‚
â”‚ [æ—¶å…‰]  â”‚ ğŸ” Search    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ è¯­éŸ³è®°å½•    â”‚
â”‚ æ—¥å¿—    â”‚ æ ‡ç­¾/äº‹é¡¹/   â”‚ â”‚ 10:00 - 12:00       â”‚  â”‚ å›¾ç‰‡       â”‚
â”‚ æ ‡ç­¾    â”‚ æ”¶è—/New     â”‚ â”‚ ğŸ™ï¸ è®®ç¨‹è®¨è®º          â”‚  â”‚ éŸ³é¢‘       â”‚
â”‚ è®¡åˆ’    â”‚              â”‚ â”‚ #ğŸ‘œå·¥ä½œ/#ğŸ§æ–‡æ¡£ç¼–è¾‘  â”‚  â”‚ è§†é¢‘       â”‚
â”‚ è¿½è¸ª    â”‚ #ğŸ”®Remarkableâ”‚ â”‚ Zoey Gong; Jenny... â”‚  â”‚ æ–‡æ¡£       â”‚
â”‚ åŒæ­¥    â”‚   å¼€å‘ (3/7) â”‚ â”‚ é™å®‰å˜‰é‡Œä¸­å¿ƒ2åº§...   â”‚  â”‚ é¡¹ç›®       â”‚
â”‚         â”‚ #ğŸ”®PRDæ–‡æ¡£   â”‚ â”‚ å¤ªå¼ºäº†ï¼å±…ç„¶ç›´æ¥...   â”‚  â”‚ ç½‘é¡µæ”¶è—    â”‚
â”‚         â”‚   (3/7)      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ å¯¼å‡º       â”‚
â”‚         â”‚ #ğŸ”®ç ä»£ç     â”‚                          â”‚            â”‚
â”‚         â”‚   (3/7)      â”‚ 10:00 - 12:00           â”‚            â”‚
â”‚         â”‚              â”‚ ğŸ“ å‡†å¤‡æ¼”è®²ç¨¿            â”‚            â”‚
â”‚         â”‚              â”‚ #ğŸ‘œå·¥ä½œ/#ğŸ§æ–‡æ¡£ç¼–è¾‘      â”‚            â”‚
â”‚         â”‚              â”‚ ...                     â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ æœ€ååŒæ­¥ï¼š2025-10-13 00:28:43  æ›´æ–°äº‹ä»¶3ä¸ª  â˜ï¸ğŸ”´ğŸ“§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GoldenLayout æ”¹é€ ç›®æ ‡**ï¼š
1. âœ… ä¿ç•™å›ºå®šå¸ƒå±€ä½œä¸ºé»˜è®¤è§†å›¾
2. âœ… "å†…å®¹é€‰å–"é¢æ¿å¯æ‹–æ‹½æˆæ‚¬æµ®çª—æˆ–éšè—
3. âœ… "æ—¶å…‰æ—¥å¿—"ä¸»åŒºåŸŸæ”¯æŒæ ‡ç­¾é¡µåˆ‡æ¢
4. âœ… äº‹ä»¶å¡ç‰‡å¯åŒå‡»å¼¹å‡ºç¼–è¾‘çª—å£
5. âœ… æ”¯æŒåˆ†å±å¯¹æ¯”ä¸åŒæ—¶é—´æ®µçš„æ—¥å¿—
6. âœ… å¸ƒå±€é…ç½®å¯ä¿å­˜ï¼ˆlocalStorageï¼‰

#### Week 1: å®‰è£…å’Œå°è£… GoldenLayout

**æ­¥éª¤ 1.1: å®‰è£…ä¾èµ–**

```bash
# å®‰è£… GoldenLayout v2.6.0ï¼ˆç¨³å®šç‰ˆï¼‰
npm install golden-layout@2.6.0

# å®‰è£…ç±»å‹å®šä¹‰
npm install --save-dev @types/golden-layout

# å®‰è£… React 18 ç›¸å…³ä¾èµ–ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
npm install react@18 react-dom@18
```

**æ­¥éª¤ 1.2: åˆ›å»º GoldenLayout å°è£…ç»„ä»¶**

```typescript
// src/components/layout/GoldenLayoutWrapper.tsx
import React, { useEffect, useRef, useCallback } from 'react';
import ReactDOM from 'react-dom/client';
import GoldenLayout, { ComponentContainer, ComponentConfig } from 'golden-layout';
import 'golden-layout/dist/css/goldenlayout-base.css';
import 'golden-layout/dist/css/goldenlayout-dark-theme.css';
import './GoldenLayoutWrapper.css';

// å¸ƒå±€é…ç½®æ¥å£
export interface LayoutConfig {
  content: any[];
  settings?: {
    showPopoutIcon?: boolean;     // æ˜¾ç¤ºå¼¹å‡ºå›¾æ ‡
    showMaximiseIcon?: boolean;   // æ˜¾ç¤ºæœ€å¤§åŒ–å›¾æ ‡
    showCloseIcon?: boolean;      // æ˜¾ç¤ºå…³é—­å›¾æ ‡
    constrainDragToContainer?: boolean; // é™åˆ¶æ‹–æ‹½åœ¨å®¹å™¨å†…
  };
  dimensions?: {
    borderWidth?: number;
    minItemHeight?: number;
    minItemWidth?: number;
    headerHeight?: number;
    dragProxyWidth?: number;
    dragProxyHeight?: number;
  };
}

// ç»„ä»¶æ³¨å†Œæ¥å£
export interface ComponentRegistration {
  name: string;
  component: React.ComponentType<any>;
}

// Props æ¥å£
export interface GoldenLayoutWrapperProps {
  config: LayoutConfig;
  components: ComponentRegistration[];
  onLayoutChange?: (config: any) => void;
  onComponentDestroy?: (componentName: string, state: any) => void;
  className?: string;
}

export const GoldenLayoutWrapper: React.FC<GoldenLayoutWrapperProps> = ({
  config,
  components,
  onLayoutChange,
  onComponentDestroy,
  className,
}) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const layoutRef = useRef<GoldenLayout | null>(null);
  const rootsRef = useRef<Map<string, any>>(new Map());

  useEffect(() => {
    if (!containerRef.current) return;

    // åˆ›å»º GoldenLayout å®ä¾‹
    const layout = new GoldenLayout(config, containerRef.current);

    // æ³¨å†Œæ‰€æœ‰ç»„ä»¶
    components.forEach(({ name, component: Component }) => {
      layout.registerComponent(name, (container: ComponentContainer, state: any) => {
        const element = container.getElement()[0];
        const rootId = `${name}-${Math.random().toString(36).substr(2, 9)}`;

        // ä½¿ç”¨ React 18 çš„ createRoot API
        const root = ReactDOM.createRoot(element);
        rootsRef.current.set(rootId, root);

        // æ¸²æŸ“ React ç»„ä»¶
        root.render(
          <Component 
            {...state} 
            container={container}
            onUpdate={(newState: any) => {
              // æ›´æ–°ç»„ä»¶çŠ¶æ€
              container.setState(newState);
            }}
          />
        );

        // ç›‘å¬å®¹å™¨é”€æ¯äº‹ä»¶
        container.on('destroy', () => {
          // æ¸…ç† React root
          const rootToUnmount = rootsRef.current.get(rootId);
          if (rootToUnmount) {
            rootToUnmount.unmount();
            rootsRef.current.delete(rootId);
          }

          // è§¦å‘é”€æ¯å›è°ƒ
          if (onComponentDestroy) {
            onComponentDestroy(name, container.getState());
          }
        });

        // ç›‘å¬å®¹å™¨å¤§å°å˜åŒ–
        container.on('resize', () => {
          // è§¦å‘ React ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆå¦‚æœéœ€è¦ï¼‰
          root.render(
            <Component 
              {...state} 
              container={container}
              onUpdate={(newState: any) => container.setState(newState)}
            />
          );
        });
      });
    });

    // ç›‘å¬å¸ƒå±€çŠ¶æ€å˜åŒ–
    if (onLayoutChange) {
      layout.on('stateChanged', () => {
        const currentConfig = layout.toConfig();
        onLayoutChange(currentConfig);
      });
    }

    // åˆå§‹åŒ–å¸ƒå±€
    layout.init();
    layoutRef.current = layout;

    // æ¸…ç†å‡½æ•°
    return () => {
      // æ¸…ç†æ‰€æœ‰ React roots
      rootsRef.current.forEach(root => root.unmount());
      rootsRef.current.clear();

      // é”€æ¯å¸ƒå±€
      if (layoutRef.current) {
        layoutRef.current.destroy();
        layoutRef.current = null;
      }
    };
  }, [config, components, onLayoutChange, onComponentDestroy]);

  return (
    <div 
      ref={containerRef} 
      className={`golden-layout-container ${className || ''}`}
      style={{ width: '100%', height: '100%' }}
    />
  );
};
```

**æ­¥éª¤ 1.3: åˆ›å»ºæ ·å¼æ–‡ä»¶**

```css
/* src/components/layout/GoldenLayoutWrapper.css */

/* åŸºç¡€å®¹å™¨æ ·å¼ */
.golden-layout-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

/* æ·±è‰²ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰*/
.golden-layout-container {
  --gl-color-bg: #1e1e1e;
  --gl-color-text: #e0e0e0;
  --gl-color-border: #333;
  --gl-color-tab-active: #2d2d2d;
  --gl-color-tab-hover: #252525;
  --gl-color-tab-bg: #1e1e1e;
  --gl-color-header-bg: #252525;
}

/* æµ…è‰²ä¸»é¢˜ */
.golden-layout-container.light-theme {
  --gl-color-bg: #ffffff;
  --gl-color-text: #333333;
  --gl-color-border: #ddd;
  --gl-color-tab-active: #f5f5f5;
  --gl-color-tab-hover: #e8e8e8;
  --gl-color-tab-bg: #ffffff;
  --gl-color-header-bg: #f9f9f9;
}

/* è‡ªå®šä¹‰æ ‡ç­¾é¡µæ ·å¼ */
.golden-layout-container .lm_header {
  background: var(--gl-color-header-bg);
  border-bottom: 1px solid var(--gl-color-border);
}

.golden-layout-container .lm_header .lm_tab {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13px;
  padding: 8px 12px;
  background: var(--gl-color-tab-bg);
  color: var(--gl-color-text);
  border-right: 1px solid var(--gl-color-border);
  transition: background 0.2s;
}

.golden-layout-container .lm_header .lm_tab:hover {
  background: var(--gl-color-tab-hover);
}

.golden-layout-container .lm_header .lm_tab.lm_active {
  background: var(--gl-color-tab-active);
  border-bottom: 2px solid #0078d4;
}

.golden-layout-container .lm_header .lm_tab .lm_title {
  display: flex;
  align-items: center;
  gap: 6px;
  padding-right: 4px;
}

/* å…³é—­æŒ‰é’®æ ·å¼ */
.golden-layout-container .lm_header .lm_tab .lm_close_tab {
  width: 16px;
  height: 16px;
  opacity: 0.6;
  transition: opacity 0.2s;
}

.golden-layout-container .lm_header .lm_tab:hover .lm_close_tab {
  opacity: 1;
}

/* å†…å®¹åŒºåŸŸæ ·å¼ */
.golden-layout-container .lm_content {
  background: var(--gl-color-bg);
  overflow: auto;
}

/* æ‹–æ‹½ä»£ç†æ ·å¼ */
.golden-layout-container .lm_dragProxy {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--gl-color-border);
  background: var(--gl-color-bg);
  opacity: 0.8;
}

/* åˆ†å‰²çº¿æ ·å¼ */
.golden-layout-container .lm_splitter {
  background: var(--gl-color-border);
  opacity: 0.3;
  transition: opacity 0.2s;
}

.golden-layout-container .lm_splitter:hover {
  opacity: 1;
  background: #0078d4;
}

/* å¼¹å‡ºçª—å£æ ·å¼ */
.golden-layout-container .lm_popin {
  cursor: pointer;
}

.golden-layout-container .lm_popin:hover {
  background: var(--gl-color-tab-hover);
}
```

---

#### Week 2: å®ç° TimeLog æ ‡ç­¾é¡µå®¹å™¨

**æ­¥éª¤ 2.1: åˆ›å»º EventLogEditor ç»„ä»¶**

```typescript
// src/pages/TimeLog/EventLogEditor.tsx
import React, { useState, useEffect, useCallback } from 'react';
import { ComponentContainer } from 'golden-layout';
import { EventService } from '@/services/EventService';
import { Event } from '@/types/Event';
import { SlateEditor } from '@/components/editor/SlateEditor';
import './EventLogEditor.css';

export interface EventLogEditorProps {
  eventId: string;
  container: ComponentContainer;
  onUpdate: (state: any) => void;
}

export const EventLogEditor: React.FC<EventLogEditorProps> = ({
  eventId,
  container,
  onUpdate,
}) => {
  const [event, setEvent] = useState<Event | null>(null);
  const [isDirty, setIsDirty] = useState(false);
  const [isSaving, setIsSaving] = useState(false);

  // åŠ è½½äº‹ä»¶æ•°æ®
  useEffect(() => {
    const loadEvent = async () => {
      const eventData = await EventService.getEventById(eventId);
      setEvent(eventData);
    };
    loadEvent();
  }, [eventId]);

  // ç›‘å¬å†…å®¹å˜åŒ–
  const handleChange = useCallback((newContent: any) => {
    setIsDirty(true);
    
    // æ›´æ–°æ ‡ç­¾æ ‡é¢˜ï¼ˆæ˜¾ç¤ºæœªä¿å­˜æ ‡è®°ï¼‰
    const currentTitle = container.tab?.element?.find('.lm_title')?.text() || '';
    if (!currentTitle.endsWith(' â—')) {
      container.setTitle(`${currentTitle} â—`);
    }
  }, [container]);

  // ä¿å­˜äº‹ä»¶
  const handleSave = useCallback(async () => {
    if (!event || !isDirty) return;

    setIsSaving(true);
    try {
      await EventService.updateEvent(eventId, {
        eventlog: event.eventlog,
        updatedAt: new Date(),
      });
      
      setIsDirty(false);
      
      // ç§»é™¤æœªä¿å­˜æ ‡è®°
      const currentTitle = container.tab?.element?.find('.lm_title')?.text() || '';
      container.setTitle(currentTitle.replace(' â—', ''));
      
      // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
      console.log('âœ… ä¿å­˜æˆåŠŸ');
    } catch (error) {
      console.error('âŒ ä¿å­˜å¤±è´¥', error);
    } finally {
      setIsSaving(false);
    }
  }, [event, eventId, isDirty, container]);

  // é”®ç›˜å¿«æ·é”®ï¼šCtrl+S ä¿å­˜
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        handleSave();
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [handleSave]);

  if (!event) {
    return <div className="event-log-editor-loading">åŠ è½½ä¸­...</div>;
  }

  return (
    <div className="event-log-editor">
      {/* å·¥å…·æ  */}
      <div className="event-log-editor-toolbar">
        <div className="toolbar-left">
          <span className="event-emoji">{event.emoji || 'ğŸ“'}</span>
          <h3 className="event-title">{event.title || 'Untitled Event'}</h3>
        </div>
        <div className="toolbar-right">
          {isDirty && <span className="dirty-indicator">æœªä¿å­˜</span>}
          <button 
            onClick={handleSave} 
            disabled={!isDirty || isSaving}
            className="btn-save"
          >
            {isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ (Ctrl+S)'}
          </button>
        </div>
      </div>

      {/* Slate ç¼–è¾‘å™¨ */}
      <div className="event-log-editor-content">
        <SlateEditor
          value={event.eventlog ? JSON.parse(event.eventlog) : []}
          onChange={handleChange}
          placeholder="å¼€å§‹è®°å½•..."
        />
      </div>
    </div>
  );
};
```

**æ­¥éª¤ 2.2: åˆ›å»º TimeLogTabsContainer**

```typescript
// src/pages/TimeLog/TimeLogTabsContainer.tsx
import React, { useState, useCallback, useEffect } from 'react';
import { GoldenLayoutWrapper, LayoutConfig } from '@/components/layout/GoldenLayoutWrapper';
import { EventLogEditor } from './EventLogEditor';
import { EventService } from '@/services/EventService';
import './TimeLogTabsContainer.css';

interface TimeLogTab {
  id: string;
  eventId: string;
  title: string;
  emoji?: string;
}

export const TimeLogTabsContainer: React.FC = () => {
  const [tabs, setTabs] = useState<TimeLogTab[]>([]);
  const [layoutConfig, setLayoutConfig] = useState<LayoutConfig | null>(null);

  // ä» localStorage æ¢å¤å¸ƒå±€
  useEffect(() => {
    const savedLayout = localStorage.getItem('timelog-layout');
    if (savedLayout) {
      try {
        const config = JSON.parse(savedLayout);
        setLayoutConfig(config);
      } catch (error) {
        console.error('æ¢å¤å¸ƒå±€å¤±è´¥', error);
      }
    }
  }, []);

  // æ‰“å¼€æ–°æ ‡ç­¾
  const openTab = useCallback((eventId: string) => {
    const event = EventService.getEventById(eventId);
    if (!event) {
      console.error('Event not found:', eventId);
      return;
    }

    const newTab: TimeLogTab = {
      id: `tab-${eventId}`,
      eventId,
      title: event.title || 'Untitled Event',
      emoji: event.emoji,
    };

    setTabs(prev => {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      if (prev.find(t => t.eventId === eventId)) {
        console.log('æ ‡ç­¾å·²å­˜åœ¨ï¼Œæ¿€æ´»è¯¥æ ‡ç­¾');
        return prev;
      }
      return [...prev, newTab];
    });

    // æ›´æ–°å¸ƒå±€é…ç½®
    setLayoutConfig(prev => {
      if (!prev) {
        // é¦–æ¬¡åˆ›å»ºå¸ƒå±€
        return {
          settings: {
            showPopoutIcon: true,
            showMaximiseIcon: true,
            showCloseIcon: true,
          },
          content: [{
            type: 'stack',
            content: [{
              type: 'component',
              componentName: 'eventEditor',
              componentState: { eventId, tabId: newTab.id },
              title: `${newTab.emoji || 'ğŸ“'} ${newTab.title}`,
              isClosable: true,
            }]
          }]
        };
      }

      // æ·»åŠ æ–°æ ‡ç­¾åˆ°ç°æœ‰ stack
      const newConfig = JSON.parse(JSON.stringify(prev));
      const stack = newConfig.content[0];
      
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤ï¼‰
      const exists = stack.content.some((item: any) => 
        item.componentState?.eventId === eventId
      );
      
      if (!exists) {
        stack.content.push({
          type: 'component',
          componentName: 'eventEditor',
          componentState: { eventId, tabId: newTab.id },
          title: `${newTab.emoji || 'ğŸ“'} ${newTab.title}`,
          isClosable: true,
        });
      }

      return newConfig;
    });
  }, []);

  // ä¿å­˜å¸ƒå±€é…ç½®
  const handleLayoutChange = useCallback((config: any) => {
    localStorage.setItem('timelog-layout', JSON.stringify(config));
  }, []);

  // ç›‘å¬ç»„ä»¶é”€æ¯ï¼ˆæ ‡ç­¾å…³é—­ï¼‰
  const handleComponentDestroy = useCallback((componentName: string, state: any) => {
    if (componentName === 'eventEditor' && state.eventId) {
      setTabs(prev => prev.filter(t => t.eventId !== state.eventId));
      console.log('æ ‡ç­¾å·²å…³é—­:', state.eventId);
    }
  }, []);

  // æš´éœ² openTab æ–¹æ³•ç»™å¤–éƒ¨ï¼ˆé€šè¿‡ Context æˆ– Eventï¼‰
  useEffect(() => {
    // ç›‘å¬æ‰“å¼€æ ‡ç­¾äº‹ä»¶
    const handleOpenTabEvent = (event: CustomEvent) => {
      const { eventId } = event.detail;
      openTab(eventId);
    };

    window.addEventListener('openTimeLogTab', handleOpenTabEvent as EventListener);
    return () => {
      window.removeEventListener('openTimeLogTab', handleOpenTabEvent as EventListener);
    };
  }, [openTab]);

  // ç»„ä»¶æ³¨å†Œ
  const components = [
    {
      name: 'eventEditor',
      component: EventLogEditor,
    },
  ];

  if (!layoutConfig) {
    return (
      <div className="timelog-tabs-empty">
        <div className="empty-state">
          <h2>ğŸ“ å¼€å§‹ç¼–è¾‘</h2>
          <p>ç‚¹å‡»å·¦ä¾§äº‹ä»¶å¡ç‰‡å¼€å§‹è®°å½•æ—¥å¿—</p>
          <div className="empty-tips">
            <p>ğŸ’¡ å°æç¤ºï¼š</p>
            <ul>
              <li>å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªäº‹ä»¶æ ‡ç­¾</li>
              <li>æ‹–æ‹½æ ‡ç­¾åˆ°æµè§ˆå™¨å¤–å¯ä»¥åˆ›å»ºç‹¬ç«‹çª—å£</li>
              <li>æ”¯æŒåˆ†å±å¯¹æ¯”ä¸åŒäº‹ä»¶</li>
            </ul>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="timelog-tabs-container">
      <GoldenLayoutWrapper
        config={layoutConfig}
        components={components}
        onLayoutChange={handleLayoutChange}
        onComponentDestroy={handleComponentDestroy}
      />
    </div>
  );
};
```

---

#### Week 3: é›†æˆå’Œæµ‹è¯•

**æ­¥éª¤ 3.1: é›†æˆåˆ° TimeLog é¡µé¢**

```typescript
// src/pages/TimeLog.tsx (ä¿®æ”¹)
import React, { useState, useCallback } from 'react';
import { ContentSelectionPanel } from '@/components/ContentSelectionPanel';
import { TimeLogTabsContainer } from './TimeLog/TimeLogTabsContainer';
import './TimeLog.css';

export const TimeLog: React.FC = () => {
  // å¤„ç†äº‹ä»¶å¡ç‰‡ç‚¹å‡»
  const handleEventClick = useCallback((eventId: string) => {
    // è§¦å‘æ‰“å¼€æ ‡ç­¾äº‹ä»¶
    const event = new CustomEvent('openTimeLogTab', {
      detail: { eventId }
    });
    window.dispatchEvent(event);
  }, []);

  return (
    <div className="timelog-page">
      {/* å·¦ä¾§ï¼šå†…å®¹é€‰æ‹©é¢æ¿ */}
      <div className="timelog-sidebar">
        <ContentSelectionPanel
          onEventClick={handleEventClick}
        />
      </div>

      {/* ä¸­é—´ï¼šæ ‡ç­¾é¡µå®¹å™¨ */}
      <div className="timelog-main">
        <TimeLogTabsContainer />
      </div>

      {/* å³ä¾§ï¼šæ“ä½œæŒ‰é’®ï¼ˆä¿ç•™åŸè®¾è®¡ï¼‰*/}
      <div className="timelog-actions">
        <button className="action-btn" title="æ–°å»ºäº‹ä»¶">
          <span>â•</span>
        </button>
        <button className="action-btn" title="æœç´¢">
          <span>ğŸ”</span>
        </button>
        <button className="action-btn" title="è®¾ç½®">
          <span>âš™ï¸</span>
        </button>
      </div>
    </div>
  );
};
```

**æ­¥éª¤ 3.2: æµ‹è¯•æ¸…å•**

- [ ] æ ‡ç­¾é¡µæ‰“å¼€/å…³é—­/åˆ‡æ¢
- [ ] å¤šæ ‡ç­¾åŒæ—¶ç¼–è¾‘
- [ ] æœªä¿å­˜æç¤ºï¼ˆæ ‡ç­¾æ ‡é¢˜æ˜¾ç¤º â—ï¼‰
- [ ] Ctrl+S å¿«æ·é”®ä¿å­˜
- [ ] å¸ƒå±€æŒä¹…åŒ–ï¼ˆåˆ·æ–°é¡µé¢åæ¢å¤ï¼‰
- [ ] æ‹–æ‹½æ ‡ç­¾æ’åº
- [ ] æ‹–æ‹½æ ‡ç­¾åˆ›å»ºåˆ†å±
- [ ] å¼¹å‡ºçª—å£åŠŸèƒ½
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆåŒæ—¶æ‰“å¼€ 10+ æ ‡ç­¾ï¼‰

---

### ğŸ“ Figma è®¾è®¡å®ç°æŒ‡å— (Phase 1 è¯¦ç»†è§„æ ¼)

> **Figma æ–‡ä»¶**: https://www.figma.com/design/T0WLjzvZMqEnpX79ILhSNQ/ReMarkable-0.1?node-id=486-2661  
> **è®¾è®¡ç¨¿æˆªå›¾**: å·²æå– TimeLog v1 å®Œæ•´è®¾è®¡è§„æ ¼

#### å¸ƒå±€ç»“æ„æ˜ å°„

**1. å›ºå®šå¸ƒå±€ï¼ˆé»˜è®¤è§†å›¾ï¼‰**

```typescript
// src/pages/TimeLog/TimeLogLayout.tsx
export const DEFAULT_TIMELOG_LAYOUT: LayoutConfig = {
  settings: {
    showPopoutIcon: true,
    showMaximiseIcon: true,
    showCloseIcon: true,
    constrainDragToContainer: false, // å…è®¸æ‹–æ‹½åˆ°å¤–éƒ¨åˆ›å»ºå¼¹çª—
  },
  dimensions: {
    borderWidth: 5,
    minItemHeight: 200,
    minItemWidth: 300,
    headerHeight: 32,
  },
  content: [{
    type: 'row',
    content: [
      // å·¦ä¾§ï¼šå†…å®¹é€‰å–é¢æ¿ï¼ˆå¯æ‹–æ‹½æˆæµ®çª—ï¼‰
      {
        type: 'component',
        componentName: 'contentSelectionPanel',
        componentState: {},
        title: 'å†…å®¹é€‰å–',
        isClosable: true,
        width: 25, // 342px / 1344px â‰ˆ 25%
      },
      // å³ä¾§ï¼šæ—¶å…‰æ—¥å¿—ä¸»åŒºåŸŸï¼ˆæ ‡ç­¾å®¹å™¨ï¼‰
      {
        type: 'stack',
        content: [{
          type: 'component',
          componentName: 'timelineView',
          componentState: { date: '2025-10-18' },
          title: 'æ—¶å…‰æ—¥å¿—',
          isClosable: false, // ä¸»è§†å›¾ä¸å¯å…³é—­
        }],
        width: 75, // 905px / 1344px â‰ˆ 75%
      }
    ]
  }]
};
```

**2. äº‹ä»¶å¡ç‰‡ç‚¹å‡»äº¤äº’**

```typescript
// src/components/ContentSelectionPanel/EventCard.tsx
export const EventCard: React.FC<EventCardProps> = ({ event, onClick }) => {
  const handleClick = (e: React.MouseEvent) => {
    // å•å‡»ï¼šåœ¨ä¸»åŒºåŸŸæ‰“å¼€æ ‡ç­¾ï¼ˆæˆ–æ¿€æ´»å·²æœ‰æ ‡ç­¾ï¼‰
    onClick(event.id);
  };

  const handleDoubleClick = (e: React.MouseEvent) => {
    e.preventDefault();
    
    // åŒå‡»ï¼šå¼¹å‡ºç‹¬ç«‹ç¼–è¾‘çª—å£
    const popupEvent = new CustomEvent('openEventPopup', {
      detail: { 
        eventId: event.id,
        position: { x: e.clientX, y: e.clientY }
      }
    });
    window.dispatchEvent(popupEvent);
  };

  return (
    <div 
      className="event-card"
      onClick={handleClick}
      onDoubleClick={handleDoubleClick}
      data-event-id={event.id}
    >
      {/* Figma è®¾è®¡è§„æ ¼ï¼š
          - é«˜åº¦: æ¯ä¸ªäº‹ä»¶å¡ç‰‡çº¦ 188px
          - å†…è¾¹è·: 20px
          - è¾¹æ¡†: 1px solid rgba(229, 231, 235, 0.5)
          - åœ†è§’: 10px
      */}
      <div className="event-time">
        {/* 10:00 - 12:00 æ ¼å¼ */}
        <span>{formatTime(event.startTime)}</span>
        <span className="time-divider">â€”</span>
        <span>{formatTime(event.endTime)}</span>
        <span className="event-duration">{calculateDuration(event)}</span>
      </div>
      
      <div className="event-header">
        <span className="event-emoji">{event.emoji}</span>
        <h3 className="event-title">{event.title}</h3>
        <span className="sync-indicator">
          {event.syncSource === 'outlook' && 'â˜ï¸'}
          {event.syncStatus === 'syncing' && 'ğŸ”„'}
        </span>
      </div>
      
      <div className="event-tags">
        {event.tags.map(tag => (
          <span key={tag.id} className="tag" style={{ color: tag.color }}>
            #{tag.emoji}{tag.name}
          </span>
        ))}
      </div>
      
      {event.attendees && (
        <div className="event-attendees">
          <span className="icon">ğŸ‘¥</span>
          <span className="text">{event.attendees.join('; ')}</span>
        </div>
      )}
      
      {event.location && (
        <div className="event-location">
          <span className="icon">ğŸ“</span>
          <span className="text">{event.location}</span>
        </div>
      )}
      
      <div className="event-description">
        {truncate(event.description, 120)}
      </div>
    </div>
  );
};
```

**3. æ ‡ç­¾é¡µå¸ƒå±€çŠ¶æ€**

```typescript
// çŠ¶æ€ A: å•æ ‡ç­¾é»˜è®¤è§†å›¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ—¶å…‰æ—¥å¿—]                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 2025.10.18ï¼ˆå‘¨å…­ï¼‰                  â”‚ â”‚
â”‚ â”‚ 10:00 - 12:00                      â”‚ â”‚
â”‚ â”‚ ğŸ™ï¸ è®®ç¨‹è®¨è®º                        â”‚ â”‚
â”‚ â”‚ ...                                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// çŠ¶æ€ B: å¤šæ ‡ç­¾ç¼–è¾‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [2025.10.18] [2025.10.19 â—] [ğŸ“ ä¼šè®®çºªè¦] â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ å‡†å¤‡æ¼”è®²ç¨¿                       â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ [Slate Editor ç¼–è¾‘åŒº]       â”‚   â”‚ â”‚
â”‚ â”‚ â”‚ å…‰æ ‡ä½ç½®                     â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// çŠ¶æ€ C: åˆ†å±å¯¹æ¯”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [2025.10.18] [2025.10.19]              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è®®ç¨‹è®¨è®º         â”‚ å‡†å¤‡æ¼”è®²ç¨¿        â”‚ â”‚
â”‚ â”‚ 10:00-12:00     â”‚ 10:00-12:00      â”‚ â”‚
â”‚ â”‚ ...             â”‚ ...              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// çŠ¶æ€ D: å¼¹å‡ºçª—å£
[æµè§ˆå™¨ä¸»çª—å£]          [ç‹¬ç«‹å¼¹çª—]
TimeLog Page         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ ğŸ“ ä¼šè®®çºªè¦   â”‚
                     â”‚ [Slate Editor]â”‚
                     â”‚ ...          â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**4. æ ·å¼è§„æ ¼ï¼ˆCSS Variablesï¼‰**

```css
/* src/pages/TimeLog/TimeLog.css */
:root {
  /* Figma è®¾è®¡ Token */
  --timelog-sidebar-width: 342px;
  --timelog-main-width: 905px;
  --timelog-left-nav-width: 96px;
  --timelog-right-fab-width: 80px;
  
  /* äº‹ä»¶å¡ç‰‡ */
  --event-card-padding: 20px;
  --event-card-gap: 12px;
  --event-card-border: 1px solid rgba(229, 231, 235, 0.5);
  --event-card-radius: 10px;
  --event-card-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
  
  /* æ ‡ç­¾é¢œè‰²æ˜ å°„ */
  --tag-work: #a855f7; /* #ğŸ‘œå·¥ä½œ */
  --tag-doc: #3b82f6;  /* #ğŸ§æ–‡æ¡£ç¼–è¾‘ */
  --tag-code: #10b981; /* #ğŸ”®ç ä»£ç  */
  
  /* GoldenLayout ä¸»é¢˜è¦†ç›– */
  --gl-tab-height: 32px;
  --gl-border-color: #e5e7eb;
  --gl-selected-tab-bg: linear-gradient(to right, #a855f7, #3b82f6);
  --gl-selected-tab-color: #ffffff;
}

.timelog-page {
  display: grid;
  grid-template-columns: var(--timelog-left-nav-width) var(--timelog-sidebar-width) 1fr var(--timelog-right-fab-width);
  height: 100vh;
  background: #f3f4f6;
}

/* GoldenLayout å®¹å™¨æ ·å¼è¦†ç›– */
.timelog-tabs-container .lm_goldenlayout {
  background: white;
  border-radius: 20px;
  box-shadow: 0px 10px 10px 32px rgba(0, 0, 0, 0.1);
}

.timelog-tabs-container .lm_header {
  background: linear-gradient(to right, #a855f7, #3b82f6);
  border-radius: 20px 20px 0 0;
}

.timelog-tabs-container .lm_tab.lm_active {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  font-weight: 600;
}

.timelog-tabs-container .lm_content {
  background: white;
  overflow: auto;
}
```

**5. åŠ¨ç”»å’Œäº¤äº’**

```typescript
// src/pages/TimeLog/animations.ts
export const TIMELOG_ANIMATIONS = {
  // æ ‡ç­¾åˆ‡æ¢åŠ¨ç”»
  tabSwitch: {
    duration: 200,
    easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
  },
  
  // æ‹–æ‹½åé¦ˆ
  dragStart: {
    scale: 1.05,
    opacity: 0.8,
    cursor: 'grabbing',
  },
  
  // å¼¹å‡ºçª—å£åŠ¨ç”»
  popupOpen: {
    duration: 300,
    easing: 'cubic-bezier(0.16, 1, 0.3, 1)', // ease-out-expo
    transform: 'scale(0.9) translateY(20px)',
  },
  
  // ä¿å­˜æˆåŠŸæç¤º
  saveSuccess: {
    duration: 2000,
    fadeIn: 200,
    fadeOut: 500,
  },
};
```

**6. æ€§èƒ½ä¼˜åŒ–ç‚¹**

```typescript
// src/pages/TimeLog/optimization.ts
export const TIMELOG_PERFORMANCE = {
  // è™šæ‹Ÿæ»šåŠ¨é…ç½®ï¼ˆå¤„ç†å¤§é‡äº‹ä»¶ï¼‰
  virtualScroll: {
    itemHeight: 188, // äº‹ä»¶å¡ç‰‡é«˜åº¦
    overscanCount: 3, // é¢„æ¸²æŸ“3ä¸ªå¡ç‰‡
    threshold: 20,    // è¶…è¿‡20ä¸ªäº‹ä»¶å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
  },
  
  // æ ‡ç­¾é™åˆ¶
  maxTabs: 10, // æœ€å¤šåŒæ—¶æ‰“å¼€10ä¸ªæ ‡ç­¾
  warnThreshold: 7, // 7ä¸ªæ ‡ç­¾æ—¶æç¤ºæ€§èƒ½å½±å“
  
  // è‡ªåŠ¨ä¿å­˜
  autoSaveDelay: 2000, // 2ç§’é˜²æŠ–
  batchSize: 50, // æ‰¹é‡ä¿å­˜æœ€å¤š50ä¸ªå˜æ›´
  
  // å¸ƒå±€ç¼“å­˜
  layoutCacheKey: 'timelog-layout-v1',
  layoutCacheTTL: 7 * 24 * 60 * 60 * 1000, // 7å¤©
};
```

---

### Phase 2: Homepage Dashboardï¼ˆ3-4 å‘¨ï¼‰

**ç›®æ ‡**: å®ç°å¯è‡ªç”±é…ç½®çš„ä»ªè¡¨ç›˜

#### Week 1: è®¾è®¡ç»„ä»¶åº“

**åˆ›å»º Dashboard ç»„ä»¶**

```typescript
// src/components/dashboard/TimeStatsWidget.tsx
import React from 'react';
import { ComponentContainer } from 'golden-layout';
import './TimeStatsWidget.css';

export interface TimeStatsWidgetProps {
  container: ComponentContainer;
}

export const TimeStatsWidget: React.FC<TimeStatsWidgetProps> = ({ container }) => {
  return (
    <div className="widget time-stats">
      <div className="widget-header">
        <h3>ğŸ“Š æ—¶é—´ç»Ÿè®¡</h3>
        <button className="widget-settings">âš™ï¸</button>
      </div>
      
      <div className="widget-content">
        <div className="stats-grid">
          <div className="stat-item">
            <span className="stat-label">ä»Šæ—¥å·¥ä½œæ—¶é•¿</span>
            <span className="stat-value">5h 23m</span>
            <span className="stat-trend">+15%</span>
          </div>
          
          <div className="stat-item">
            <span className="stat-label">æœ¬å‘¨ä¸“æ³¨æ—¶é•¿</span>
            <span className="stat-value">32h 15m</span>
            <span className="stat-trend">+8%</span>
          </div>
          
          <div className="stat-item">
            <span className="stat-label">æœ¬æœˆå®Œæˆäº‹ä»¶</span>
            <span className="stat-value">47</span>
            <span className="stat-trend">+22%</span>
          </div>
        </div>
        
        <div className="stats-chart">
          {/* å¯ä»¥é›†æˆ recharts æˆ– Chart.js */}
        </div>
      </div>
    </div>
  );
};
```

```typescript
// src/components/dashboard/TaskReminderWidget.tsx
export const TaskReminderWidget: React.FC = () => {
  return (
    <div className="widget task-reminder">
      <div className="widget-header">
        <h3>âœ… ä»»åŠ¡æé†’</h3>
        <span className="badge">5</span>
      </div>
      
      <div className="widget-content">
        <ul className="task-list">
          <li className="task-item urgent">
            <span className="task-checkbox">â˜</span>
            <span className="task-title">å‡†å¤‡æ¼”è®²ç¨¿</span>
            <span className="task-deadline">è¿˜å‰© 2h</span>
          </li>
          <li className="task-item">
            <span className="task-checkbox">â˜</span>
            <span className="task-title">Review PR #123</span>
            <span className="task-deadline">ä»Šå¤©</span>
          </li>
          <li className="task-item">
            <span className="task-checkbox">â˜</span>
            <span className="task-title">æ›´æ–°æ–‡æ¡£</span>
            <span className="task-deadline">æ˜å¤©</span>
          </li>
        </ul>
      </div>
    </div>
  );
};
```

#### Week 2-3: å®ç° Dashboard é…ç½®å™¨

```typescript
// src/pages/Homepage/DashboardManager.tsx
import React, { useState, useCallback } from 'react';
import { GoldenLayoutWrapper, LayoutConfig } from '@/components/layout/GoldenLayoutWrapper';
import * as Widgets from '@/components/dashboard';
import './DashboardManager.css';

interface DashboardPreset {
  name: string;
  config: LayoutConfig;
}

export const DashboardManager: React.FC = () => {
  const [presets, setPresets] = useState<DashboardPreset[]>([
    {
      name: 'default',
      config: {
        content: [{
          type: 'row',
          content: [
            {
              type: 'component',
              componentName: 'timeStats',
              title: 'ğŸ“Š æ—¶é—´ç»Ÿè®¡',
              width: 33,
            },
            {
              type: 'component',
              componentName: 'taskReminder',
              title: 'âœ… ä»»åŠ¡æé†’',
              width: 33,
            },
            {
              type: 'component',
              componentName: 'countdown',
              title: 'â±ï¸ å€’è®¡æ—¶',
              width: 34,
            },
          ]
        }]
      }
    },
  ]);
  
  const [activePreset, setActivePreset] = useState('default');
  
  const currentConfig = presets.find(p => p.name === activePreset)?.config || null;
  
  // ç»„ä»¶æ³¨å†Œ
  const components = [
    { name: 'timeStats', component: Widgets.TimeStatsWidget },
    { name: 'taskReminder', component: Widgets.TaskReminderWidget },
    { name: 'countdown', component: Widgets.CountdownWidget },
    { name: 'eventTree', component: Widgets.EventTreeWidget },
    { name: 'calendar', component: Widgets.CalendarWidget },
    { name: 'report', component: Widgets.ReportWidget },
  ];
  
  // ä¿å­˜å¸ƒå±€
  const handleLayoutChange = useCallback((config: any) => {
    setPresets(prev => {
      const index = prev.findIndex(p => p.name === activePreset);
      if (index >= 0) {
        prev[index].config = config;
        return [...prev];
      }
      return prev;
    });
    
    localStorage.setItem('dashboard-presets', JSON.stringify(presets));
  }, [activePreset, presets]);
  
  return (
    <div className="dashboard-manager">
      <div className="dashboard-toolbar">
        <select 
          value={activePreset} 
          onChange={(e) => setActivePreset(e.target.value)}
        >
          <option value="default">é»˜è®¤å¸ƒå±€</option>
          <option value="work">å·¥ä½œæ¨¡å¼</option>
          <option value="review">å›é¡¾æ¨¡å¼</option>
        </select>
        
        <button onClick={() => {/* æ–°å»ºå¸ƒå±€ */}}>æ–°å»ºå¸ƒå±€</button>
        <button onClick={() => {/* é‡ç½®å¸ƒå±€ */}}>é‡ç½®</button>
      </div>
      
      {currentConfig && (
        <GoldenLayoutWrapper
          config={currentConfig}
          components={components}
          onLayoutChange={handleLayoutChange}
        />
      )}
    </div>
  );
};
```

#### Week 4: ç»„ä»¶å¸‚åœº

**å®ç°ç»„ä»¶æ‹–æ‹½æ·»åŠ åŠŸèƒ½**

```typescript
// src/pages/Homepage/ComponentMarket.tsx
export const ComponentMarket: React.FC = () => {
  const availableComponents = [
    { id: 'timeStats', name: 'æ—¶é—´ç»Ÿè®¡', icon: 'ğŸ“Š' },
    { id: 'taskReminder', name: 'ä»»åŠ¡æé†’', icon: 'âœ…' },
    { id: 'countdown', name: 'å€’è®¡æ—¶', icon: 'â±ï¸' },
    { id: 'eventTree', name: 'é¡¹ç›®æ ‘', icon: 'ğŸŒ²' },
    { id: 'calendar', name: 'æ—¥å†', icon: 'ğŸ“…' },
    { id: 'report', name: 'æŠ¥è¡¨', icon: 'ğŸ“ˆ' },
  ];
  
  return (
    <div className="component-market">
      <h3>ç»„ä»¶åº“</h3>
      <div className="component-grid">
        {availableComponents.map(comp => (
          <div 
            key={comp.id}
            className="component-card"
            draggable
            onDragStart={(e) => {
              e.dataTransfer.setData('component', comp.id);
            }}
          >
            <span className="component-icon">{comp.icon}</span>
            <span className="component-name">{comp.name}</span>
          </div>
        ))}
      </div>
    </div>
  );
};
```

---

### Phase 3: Windows Desktop Widgetsï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡**: æ”¯æŒæ¡Œé¢æ‚¬æµ®å°ç»„ä»¶

#### Week 1-2: Electron çª—å£é›†æˆ

**ä¿®æ”¹ Electron ä¸»è¿›ç¨‹**

```typescript
// electron/main.ts
import { app, BrowserWindow, ipcMain, screen } from 'electron';

let widgetWindows: Map<string, BrowserWindow> = new Map();

// åˆ›å»ºæ¡Œé¢ Widget
function createWidget(widgetId: string, config: any) {
  const { width = 300, height = 200, x, y } = config;
  
  // è·å–å±å¹•å°ºå¯¸
  const { width: screenWidth, height: screenHeight } = screen.getPrimaryDisplay().workAreaSize;
  
  const win = new BrowserWindow({
    width,
    height,
    x: x || screenWidth - width - 20,
    y: y || 20,
    frame: false,              // æ— è¾¹æ¡†
    transparent: true,         // é€æ˜èƒŒæ™¯
    alwaysOnTop: true,         // å§‹ç»ˆç½®é¡¶
    skipTaskbar: true,         // ä¸æ˜¾ç¤ºåœ¨ä»»åŠ¡æ 
    resizable: true,           // å¯è°ƒæ•´å¤§å°
    webPreferences: {
      nodeIntegration: true,
      contextIsolation: false,
    },
  });

  win.loadURL(`${process.env.VITE_DEV_SERVER_URL}/widget?id=${widgetId}`);
  
  // ä¿å­˜çª—å£å¼•ç”¨
  widgetWindows.set(widgetId, win);
  
  // ç›‘å¬çª—å£å…³é—­
  win.on('closed', () => {
    widgetWindows.delete(widgetId);
    
    // ä¿å­˜çª—å£ä½ç½®
    const bounds = win.getBounds();
    saveWidgetPosition(widgetId, bounds);
  });
  
  // ç›‘å¬çª—å£ç§»åŠ¨
  win.on('move', () => {
    const bounds = win.getBounds();
    saveWidgetPosition(widgetId, bounds);
  });
}

// ä¿å­˜ Widget ä½ç½®
function saveWidgetPosition(widgetId: string, bounds: any) {
  const positions = JSON.parse(localStorage.getItem('widget-positions') || '{}');
  positions[widgetId] = bounds;
  localStorage.setItem('widget-positions', JSON.stringify(positions));
}

// IPC é€šä¿¡
ipcMain.on('create-widget', (event, widgetId, config) => {
  // æ¢å¤ä¿å­˜çš„ä½ç½®
  const positions = JSON.parse(localStorage.getItem('widget-positions') || '{}');
  const savedPosition = positions[widgetId];
  
  createWidget(widgetId, {
    ...config,
    ...savedPosition,
  });
});

ipcMain.on('close-widget', (event, widgetId) => {
  const win = widgetWindows.get(widgetId);
  if (win) {
    win.close();
  }
});

ipcMain.on('toggle-widget', (event, widgetId) => {
  const win = widgetWindows.get(widgetId);
  if (win) {
    if (win.isVisible()) {
      win.hide();
    } else {
      win.show();
    }
  }
});
```

#### Week 2: Widget è·¯ç”±å’Œæ¸²æŸ“

```typescript
// src/pages/Widget.tsx
import React from 'react';
import { useSearchParams } from 'react-router-dom';
import * as Widgets from '@/components/dashboard';
import './Widget.css';

export const WidgetPage: React.FC = () => {
  const [searchParams] = useSearchParams();
  const widgetId = searchParams.get('id');

  const renderWidget = () => {
    switch (widgetId) {
      case 'timer':
        return <Widgets.TimerWidget />;
      case 'quick-note':
        return <Widgets.QuickNoteWidget />;
      case 'stats':
        return <Widgets.TimeStatsWidget />;
      default:
        return <div>Unknown widget: {widgetId}</div>;
    }
  };

  return (
    <div className="desktop-widget">
      {/* æ‹–æ‹½å¥æŸ„ */}
      <div className="widget-handle" data-draggable>
        <span className="widget-dots">â‹®â‹®</span>
      </div>
      
      {/* Widget å†…å®¹ */}
      <div className="widget-body">
        {renderWidget()}
      </div>
    </div>
  );
};
```

#### Week 3: ç³»ç»Ÿæ‰˜ç›˜ç®¡ç†

```typescript
// electron/tray.ts
import { Tray, Menu, nativeImage } from 'electron';
import path from 'path';

let tray: Tray | null = null;

export function createTray() {
  const icon = nativeImage.createFromPath(
    path.join(__dirname, '../assets/tray-icon.png')
  );
  
  tray = new Tray(icon);
  
  const contextMenu = Menu.buildFromTemplate([
    {
      label: 'æ˜¾ç¤º/éšè— Widgets',
      type: 'submenu',
      submenu: [
        {
          label: 'â±ï¸ ä¸“æ³¨è®¡æ—¶å™¨',
          type: 'checkbox',
          checked: false,
          click: (menuItem) => {
            if (menuItem.checked) {
              createWidget('timer', { width: 300, height: 150 });
            } else {
              closeWidget('timer');
            }
          }
        },
        {
          label: 'ğŸ“‹ å¿«é€Ÿç¬”è®°',
          type: 'checkbox',
          checked: false,
          click: (menuItem) => {
            if (menuItem.checked) {
              createWidget('quick-note', { width: 400, height: 300 });
            } else {
              closeWidget('quick-note');
            }
          }
        },
        {
          label: 'ğŸ“Š ä»Šæ—¥ç»Ÿè®¡',
          type: 'checkbox',
          checked: false,
          click: (menuItem) => {
            if (menuItem.checked) {
              createWidget('stats', { width: 350, height: 200 });
            } else {
              closeWidget('stats');
            }
          }
        },
      ]
    },
    { type: 'separator' },
    {
      label: 'æ‰“å¼€ä¸»çª—å£',
      click: () => {
        // æ‰“å¼€ä¸»çª—å£
      }
    },
    { type: 'separator' },
    {
      label: 'é€€å‡º',
      click: () => {
        app.quit();
      }
    }
  ]);
  
  tray.setToolTip('ReMarkable');
  tray.setContextMenu(contextMenu);
}
```

---

## ğŸ“Š é£é™©è¯„ä¼°å’Œç¼“è§£ç­–ç•¥

### é£é™© 1: å­¦ä¹ æ›²çº¿é™¡å³­

**å½±å“**: å¼€å‘æ—¶é—´å¯èƒ½è¶…å‡ºé¢„æœŸï¼ˆ+1-2 å‘¨ï¼‰

**ç¼“è§£æªæ–½**:
1. Week 0: å›¢é˜Ÿæˆå‘˜é˜…è¯» GoldenLayout å®˜æ–¹æ–‡æ¡£
2. æ„å»ºç®€å• Demo ç†Ÿæ‚‰ API
3. å‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼šhttps://github.com/golden-layout/golden-layout/tree/master/examples
4. å®‰æ’æŠ€æœ¯åˆ†äº«ä¼šï¼Œé›†ä½“å­¦ä¹ 

### é£é™© 2: React é›†æˆå¤æ‚

**å½±å“**: ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†å›°éš¾ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

**ç¼“è§£æªæ–½**:
1. ä½¿ç”¨ React 18 çš„ `createRoot` API
2. ä¸¥æ ¼ç®¡ç†æ¸…ç†å‡½æ•°ï¼ˆ`container.on('destroy')`ï¼‰
3. ä½¿ç”¨ React DevTools ç›‘æ§ç»„ä»¶æŒ‚è½½/å¸è½½
4. ç¼–å†™å•å…ƒæµ‹è¯•ç¡®ä¿ç»„ä»¶æ­£ç¡®æ¸…ç†

### é£é™© 3: ç‰ˆæœ¬å‡çº§é—®é¢˜

**å½±å“**: v3.0 ä¸å‘åå…¼å®¹ï¼Œæœªæ¥å‡çº§å›°éš¾

**ç¼“è§£æªæ–½**:
1. é”å®šç‰ˆæœ¬ä¸º `2.6.0`ï¼ˆåœ¨ package.json ä¸­ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬ï¼‰
2. ä¸è¦ç›²ç›®å‡çº§åˆ° v3.0ï¼ˆç­‰ç¨³å®šåè¯„ä¼°ï¼‰
3. å…³æ³¨ GitHub Issues è·å–æœ€æ–°ä¿¡æ¯
4. åˆ›å»ºå‡çº§è¯„ä¼°æ–‡æ¡£

### é£é™© 4: Bundle ä½“ç§¯å¢å¤§

**å½±å“**: é¦–å±åŠ è½½å˜æ…¢ï¼ˆ+50KB gzippedï¼‰

**ç¼“è§£æªæ–½**:
1. ä½¿ç”¨ Lazy Loading
```typescript
const GoldenLayoutWrapper = lazy(() => 
  import('@/components/layout/GoldenLayoutWrapper')
);
```
2. Code Splittingï¼ˆæŒ‰é¡µé¢æ‹†åˆ†ï¼‰
3. åªåœ¨éœ€è¦æ—¶åŠ è½½ GoldenLayout
4. ä½¿ç”¨ Webpack Bundle Analyzer åˆ†æä¼˜åŒ–

### é£é™© 5: æ€§èƒ½é—®é¢˜

**å½±å“**: åŒæ—¶æ‰“å¼€å¤šä¸ªæ ‡ç­¾/ç»„ä»¶æ—¶å¡é¡¿

**ç¼“è§£æªæ–½**:
1. ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆreact-windowï¼‰
2. é˜²æŠ–å¸ƒå±€ä¿å­˜ï¼ˆdebounce 1sï¼‰
3. æ‡’åŠ è½½ç»„ä»¶å†…å®¹
4. é™åˆ¶åŒæ—¶æ‰“å¼€çš„æ ‡ç­¾æ•°é‡ï¼ˆæœ€å¤š 20 ä¸ªï¼‰

---

## âœ… æˆåŠŸæŒ‡æ ‡

### Phase 1 (TimeLog)
- âœ… ç”¨æˆ·å¯ä»¥åŒæ—¶ç¼–è¾‘ â‰¥3 ä¸ªäº‹ä»¶
- âœ… æ ‡ç­¾æ‹–æ‹½æ’åºæµç•…ï¼ˆ60fpsï¼‰
- âœ… å¸ƒå±€é…ç½®è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤
- âœ… å¼¹å‡ºçª—å£åŠŸèƒ½å¯ç”¨
- âœ… æœªä¿å­˜æç¤ºå‡†ç¡®
- âœ… æ€§èƒ½ï¼šæ‰“å¼€ 10 ä¸ªæ ‡ç­¾æ— æ˜æ˜¾å¡é¡¿

### Phase 2 (Homepage)
- âœ… æ”¯æŒ â‰¥6 ç§é¢„è®¾ç»„ä»¶
- âœ… ç”¨æˆ·å¯è‡ªå®šä¹‰ â‰¥3 å¥—å¸ƒå±€
- âœ… ç»„ä»¶æ‹–æ‹½è°ƒæ•´å¤§å°æ— å¡é¡¿
- âœ… å¸ƒå±€æŒä¹…åŒ–å‡†ç¡®
- âœ… ç»„ä»¶å¸‚åœºæ˜“ç”¨æ€§è¯„åˆ† â‰¥4.5/5

### Phase 3 (Desktop Widgets)
- âœ… æ”¯æŒ â‰¥3 ç§æ¡Œé¢å°ç»„ä»¶
- âœ… Widget ä½ç½®è®°å¿†å‡†ç¡®ç‡ 100%
- âœ… ç³»ç»Ÿæ‰˜ç›˜äº¤äº’æµç•…
- âœ… å¤šæ˜¾ç¤ºå™¨æ”¯æŒæ­£å¸¸
- âœ… Widget å¯åŠ¨æ—¶é—´ <500ms

---

## ğŸ“š æŠ€æœ¯å‚è€ƒ

### GoldenLayout å®˜æ–¹èµ„æº
- GitHub: https://github.com/golden-layout/golden-layout
- æ–‡æ¡£: https://golden-layout.com/docs/
- ç¤ºä¾‹: https://github.com/golden-layout/golden-layout/tree/master/examples

### React é›†æˆå‚è€ƒ
- React 18 createRoot: https://react.dev/reference/react-dom/client/createRoot
- React ç”Ÿå‘½å‘¨æœŸ: https://react.dev/learn/lifecycle-of-reactive-effects

### æ€§èƒ½ä¼˜åŒ–å‚è€ƒ
- react-window: https://github.com/bvaughn/react-window
- Code Splitting: https://react.dev/reference/react/lazy
- Bundle Analysis: https://github.com/webpack-contrib/webpack-bundle-analyzer

---

## ğŸ“… æ—¶é—´çº¿æ€»ç»“

| Phase | å‘¨æ•° | é‡Œç¨‹ç¢‘ |
|-------|------|--------|
| Phase 1 | Week 1-3 | TimeLog æ ‡ç­¾é¡µåŠŸèƒ½å®Œæˆ |
| Phase 2 | Week 4-7 | Homepage Dashboard å®Œæˆ |
| Phase 3 | Week 8-10 | Desktop Widgets å®Œæˆ |

**æ€»è®¡**: 8-10 å‘¨

---

## ğŸ‘¥ å›¢é˜Ÿåˆ†å·¥å»ºè®®

| è§’è‰² | èŒè´£ | æ—¶é—´æŠ•å…¥ |
|------|------|---------|
| å‰ç«¯å·¥ç¨‹å¸ˆ A | GoldenLayout å°è£…ã€TimeLog é›†æˆ | 3 å‘¨ |
| å‰ç«¯å·¥ç¨‹å¸ˆ B | Dashboard ç»„ä»¶å¼€å‘ | 4 å‘¨ |
| Electron å·¥ç¨‹å¸ˆ | Desktop Widgetsã€ç³»ç»Ÿæ‰˜ç›˜ | 3 å‘¨ |
| UI/UX è®¾è®¡å¸ˆ | ç»„ä»¶è®¾è®¡ã€äº¤äº’ä¼˜åŒ– | æŒç»­ |
| QA æµ‹è¯•å·¥ç¨‹å¸ˆ | åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯• | æŒç»­ |

---

**æ–‡æ¡£ç»“æŸ**
