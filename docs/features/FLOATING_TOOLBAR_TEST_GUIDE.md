# FloatingToolbar 快捷键测试指南

## 🎯 测试目标

验证 FloatingToolbar 的新快捷键 (Alt+1-5) 是否正常工作，以及编辑状态检查是否有效。

## 📋 前置条件

1. 启动 ReMarkable 应用
2. 导航到 PlanManager 组件
3. 确保有至少一个计划项可以编辑

## ✅ 测试用例

### 测试用例 1: 编辑器内快捷键 - 显示工具栏

**步骤**:
1. 点击任意计划项，进入编辑状态（光标在输入框内闪烁）
2. 按下 `Alt+1`

**预期结果**:
- ✅ FloatingToolbar 在光标位置显示
- ✅ 标签选择器（Tag Picker）打开
- ✅ 没有报错

---

### 测试用例 2: 切换不同功能

**步骤**:
1. 在编辑状态下，依次按下 `Alt+1`, `Alt+2`, `Alt+3`, `Alt+4`, `Alt+5`

**预期结果**:
- ✅ Alt+1: 显示标签选择器（#）
- ✅ Alt+2: 显示表情选择器（😊）
- ✅ Alt+3: 显示日期选择器（📅）
- ✅ Alt+4: 显示优先级选择器（⚡）
- ✅ Alt+5: 显示颜色选择器（🎨）

---

### 测试用例 3: 关闭工具栏

**步骤**:
1. 在编辑状态下，按 `Alt+1` 打开工具栏
2. 再次按 `Alt+1`

**预期结果**:
- ✅ 工具栏关闭
- ✅ 光标仍在编辑器内

---

### 测试用例 4: 编辑器外快捷键 - 不响应

**步骤**:
1. 点击编辑器外的任意区域（侧边栏、标题栏等）
2. 按下 `Alt+1` 到 `Alt+5`

**预期结果**:
- ✅ 工具栏不显示
- ✅ 没有任何反应
- ✅ 不影响其他功能

---

### 测试用例 5: 失去焦点后快捷键失效

**步骤**:
1. 在编辑状态下，按 `Alt+1` 打开工具栏
2. 点击编辑器外的区域（失去焦点）
3. 按 `Alt+2`

**预期结果**:
- ✅ 工具栏关闭（点击外部时）
- ✅ Alt+2 不响应
- ✅ 需要重新聚焦编辑器才能使用快捷键

---

### 测试用例 6: 选中文本时使用快捷键

**步骤**:
1. 在编辑状态下，选中一段文本
2. 按 `Alt+1`

**预期结果**:
- ✅ 工具栏显示在选中文本上方
- ✅ 标签选择器打开
- ✅ 选中状态保持

---

### 测试用例 7: 快速切换功能

**步骤**:
1. 在编辑状态下，按 `Alt+1` 打开标签选择器
2. 不选择任何标签，直接按 `Alt+3` 切换到日期选择器

**预期结果**:
- ✅ 标签选择器关闭
- ✅ 日期选择器打开
- ✅ 工具栏位置正确

---

## 🐛 常见问题排查

### 问题 1: 快捷键不响应

**可能原因**:
- 编辑器没有焦点
- `editorRef` 未正确绑定
- 浏览器或系统拦截了 Alt 键

**解决方法**:
1. 确保光标在编辑器内
2. 检查控制台是否有错误
3. 尝试在不同浏览器中测试

---

### 问题 2: 工具栏位置不正确

**可能原因**:
- 滚动位置计算错误
- CSS 样式冲突

**解决方法**:
1. 检查 `calculatePosition` 函数
2. 查看 `window.scrollY` 和 `window.scrollX` 是否正确

---

### 问题 3: Alt 键与系统菜单栏冲突

**可能原因**:
- 某些操作系统（如 Linux）的 Alt 键会激活菜单栏

**解决方法**:
1. 在 Windows/macOS 上测试
2. 考虑改用其他组合键（如 Ctrl+Shift+数字）

---

## 📊 测试结果记录表

| 测试用例 | 通过 | 失败 | 备注 |
|---------|------|------|------|
| 1. 编辑器内显示工具栏 | ☐ | ☐ | |
| 2. 切换不同功能 | ☐ | ☐ | |
| 3. 关闭工具栏 | ☐ | ☐ | |
| 4. 编辑器外不响应 | ☐ | ☐ | |
| 5. 失去焦点后失效 | ☐ | ☐ | |
| 6. 选中文本时使用 | ☐ | ☐ | |
| 7. 快速切换功能 | ☐ | ☐ | |

---

## 🔍 调试技巧

### 1. 开启控制台日志

在 `useFloatingToolbar.ts` 中添加调试日志：

```typescript
console.log('🎹 Key pressed:', event.key, 'Alt:', event.altKey);
console.log('📍 In editor:', isInEditor);
console.log('🎯 Toolbar show:', position.show);
```

### 2. 检查事件监听

```javascript
// 在浏览器控制台运行
document.addEventListener('keydown', (e) => {
  console.log('Key:', e.key, 'Alt:', e.altKey, 'Target:', e.target);
}, true);
```

### 3. 验证编辑器引用

```javascript
// 在 PlanManager 组件中添加
useEffect(() => {
  console.log('Editor ref:', editorContainerRef.current);
}, []);
```

---

**测试日期**: _______________  
**测试人**: _______________  
**测试环境**: OS: _______ / Browser: _______  
**测试结果**: ☐ 通过 / ☐ 失败
